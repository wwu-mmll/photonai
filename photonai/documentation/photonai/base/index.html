<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>photonai.base API documentation</title>
    <meta name="description" content="PHOTON Base Classes enabling the nested-cross-validated hyperparameter search." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.Hyperpipe">Hyperpipe</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.Hyperpipe.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.add">add</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.config_to_dict">config_to_dict</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.copy_me">copy_me</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.fit">fit</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.inverse_transform_pipeline">inverse_transform_pipeline</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.load_optimum_pipe">load_optimum_pipe</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.predict">predict</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.predict_proba">predict_proba</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.prettify_config_output">prettify_config_output</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.save_optimum_pipe">save_optimum_pipe</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.set_params">set_params</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.transform">transform</a></li>
    <li class="mono"><a href="#photonai.base.Hyperpipe.update_mother_inner_fold_nr">update_mother_inner_fold_nr</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.ImbalancedDataTransform">ImbalancedDataTransform</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.ImbalancedDataTransform.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.ImbalancedDataTransform.fit_sample">fit_sample</a></li>
    <li class="mono"><a href="#photonai.base.ImbalancedDataTransform.fit_transform">fit_transform</a></li>
    <li class="mono"><a href="#photonai.base.ImbalancedDataTransform.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.ImbalancedDataTransform.set_params">set_params</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.PersistOptions">OutputSettings</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.PersistOptions.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.PipelineBranch">PipelineBranch</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.PipelineBranch.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.add">add</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.copy_me">copy_me</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.fit">fit</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.generate_config_grid">generate_config_grid</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.generate_sklearn_hyperparameters">generate_sklearn_hyperparameters</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.inverse_transform">inverse_transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.predict">predict</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.predict_proba">predict_proba</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.prettify_config_output">prettify_config_output</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.score">score</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.set_params">set_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.transform">transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineBranch.create">create</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.PipelineElement">PipelineElement</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.PipelineElement.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.copy_me">copy_me</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.fit">fit</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.generate_config_grid">generate_config_grid</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.generate_sklearn_hyperparameters">generate_sklearn_hyperparameters</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.inverse_transform">inverse_transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.predict">predict</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.predict_proba">predict_proba</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.prettify_config_output">prettify_config_output</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.score">score</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.set_params">set_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.transform">transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineElement.create">create</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.PipelineStacking">PipelineStacking</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.PipelineStacking.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.add">add</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.copy_me">copy_me</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.fit">fit</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.generate_config_grid">generate_config_grid</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.generate_sklearn_hyperparameters">generate_sklearn_hyperparameters</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.inverse_transform">inverse_transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.predict">predict</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.predict_proba">predict_proba</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.prettify_config_output">prettify_config_output</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.score">score</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.set_params">set_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.transform">transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.create">create</a></li>
    <li class="mono"><a href="#photonai.base.PipelineStacking.stack_data">stack_data</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#photonai.base.PipelineSwitch">PipelineSwitch</a></span>
        
          
  <ul>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.__init__">__init__</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.add">add</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.copy_me">copy_me</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.fit">fit</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.generate_config_grid">generate_config_grid</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.generate_private_config_grid">generate_private_config_grid</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.generate_sklearn_hyperparameters">generate_sklearn_hyperparameters</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.get_params">get_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.inverse_transform">inverse_transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.predict">predict</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.predict_proba">predict_proba</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.prettify_config_output">prettify_config_output</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.score">score</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.set_params">set_params</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.transform">transform</a></li>
    <li class="mono"><a href="#photonai.base.PipelineSwitch.create">create</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">photonai.base</span> module</h1>
  <p>PHOTON Base Classes enabling the nested-cross-validated hyperparameter search.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot; PHOTON Base Classes enabling the nested-cross-validated hyperparameter search.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">.PhotonBase</span> <span class="kn">import</span> <span class="n">Hyperpipe</span><span class="p">,</span> <span class="n">PipelineElement</span><span class="p">,</span> <span class="n">PipelineSwitch</span><span class="p">,</span> <span class="n">PipelineStacking</span><span class="p">,</span> <span class="n">PipelineBranch</span><span class="p">,</span> <span class="n">OutputSettings</span>
<span class="kn">from</span> <span class="nn">.ImbalancedWrapper</span> <span class="kn">import</span> <span class="n">ImbalancedDataTransform</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Hyperpipe&quot;</span><span class="p">,</span>
           <span class="s2">&quot;PipelineElement&quot;</span><span class="p">,</span>
           <span class="s2">&quot;PipelineSwitch&quot;</span><span class="p">,</span>
           <span class="s2">&quot;PipelineStacking&quot;</span><span class="p">,</span>
           <span class="s2">&quot;PipelineBranch&quot;</span><span class="p">,</span>
           <span class="s2">&quot;OutputSettings&quot;</span><span class="p">,</span>
           <span class="s2">&quot;ImbalancedDataTransform&quot;</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="photonai.base.Hyperpipe" class="name">class <span class="ident">Hyperpipe</span></p>
      
  
    <div class="desc"><p>Wrapper class for machine learning pipeline, holding all pipeline elements
and managing the optimization of the hyperparameters</p>
<h2>Parameters</h2>
<ul>
<li>
<p>'name' [str]:
    Name of hyperpipe instance</p>
</li>
<li>
<p>'inner_cv' [BaseCrossValidator]:
    Cross validation strategy to test hyperparameter configurations, generates the validation set</p>
</li>
<li>
<p>'outer_cv' [BaseCrossValidator]:
    Cross validation strategy to use for the hyperparameter search itself, generates the test set</p>
</li>
<li>
<p>'optimizer' [str or object, default="grid_search"]:
    Hyperparameter optimization algorithm</p>
<ul>
<li>
<p>In case a string literal is given:</p>
<ul>
<li>"grid_search": optimizer that iteratively tests all possible hyperparameter combinations</li>
<li>"random_grid_search": a variation of the grid search optimization that randomly picks hyperparameter
   combinations from all possible hyperparameter combinations</li>
<li>"timeboxed_random_grid_search": randomly chooses hyperparameter combinations from the set of all
   possible hyperparameter combinations and tests until the given time limit is reached</li>
<li>'limit_in_minutes': int</li>
</ul>
</li>
<li>
<p>In case an object is given:
  expects the object to have the following methods:</p>
</li>
<li>'next_config_generator': returns a hyperparameter configuration in form of an dictionary containing
      key-&gt;value pairs in the sklearn parameter encoding 'model_name__parameter_name: parameter_value'</li>
<li>'prepare': takes a list of pipeline elements and their particular hyperparameters to test</li>
<li>'evaluate_recent_performance': gets a tested config and the respective performance in order to
      calculate a smart next configuration to process</li>
</ul>
</li>
<li>
<p>'metrics' [list of metric names as str]:
    Metrics that should be calculated for both training, validation and test set
    Use the preimported metrics from sklearn and photonai, or register your own</p>
<ul>
<li>Metrics for 'classification':<ul>
<li>'accuracy': sklearn.metrics.accuracy_score</li>
<li>'matthews_corrcoef': sklearn.metrics.matthews_corrcoef</li>
<li>'confusion_matrix': sklearn.metrics.confusion_matrix,</li>
<li>'f1_score': sklearn.metrics.f1_score</li>
<li>'hamming_loss': sklearn.metrics.hamming_loss</li>
<li>'log_loss': sklearn.metrics.log_loss</li>
<li>'precision': sklearn.metrics.precision_score</li>
<li>'recall': sklearn.metrics.recall_score</li>
</ul>
</li>
<li>Metrics for 'regression':<ul>
<li>'mean_squared_error': sklearn.metrics.mean_squared_error</li>
<li>'mean_absolute_error': sklearn.metrics.mean_absolute_error</li>
<li>'explained_variance': sklearn.metrics.explained_variance_score</li>
<li>'r2': sklearn.metrics.r2_score</li>
</ul>
</li>
<li>Other metrics<ul>
<li>'pearson_correlation': photon_core.framework.Metrics.pearson_correlation</li>
<li>'variance_explained':  photon_core.framework.Metrics.variance_explained_score</li>
<li>'categorical_accuracy': photon_core.framework.Metrics.categorical_accuracy_score</li>
</ul>
</li>
</ul>
</li>
<li>
<p>'best_config_metric' [str]:
    The metric that should be maximized or minimized in order to choose the best hyperparameter configuration</p>
</li>
<li>
<p>'eval_final_performance' [bool, default=True]:
    If the metrics should be calculated for the test set, otherwise the test set is seperated but not used</p>
</li>
<li>
<p>'test_size' [float, default=0.2]:
    the amount of the data that should be left out if no outer_cv is given and
    eval_final_perfomance is set to True</p>
</li>
<li>
<p>'set_random_seed' [bool, default=False]:
    If True sets the random seed to 42</p>
</li>
<li>
<p>'verbosity' [int, default=0]:
    The level of verbosity, 0 is least talkative and gives only warn and error, 1 gives adds info and 2 adds debug</p>
</li>
<li>
<p>'groups' [array-like, default=None]:
    Info for advanced cross validation strategies, such as LeaveOneSiteOut-CV about the affiliation
    of the rows in the data</p>
</li>
<li>
<p>'filter_element' [SourceFilter, default=None]:
    Instance of SourceFilter Class that transforms the input data, e.g. extracts certain columns</p>
</li>
<li>
<p>'imbalanced_data_strategy_filter' [str, default=None]:
    Uses the imblearn package to handle imbalanced class distributions in the data
    A strategy is used to transform the data into more balanced distributions before the hyperparameter search
    is started.
    Strategies to choose from are:</p>
<ul>
<li>imbalance_type = OVERSAMPLING:<ul>
<li>RandomOverSampler</li>
<li>SMOTE</li>
<li>ADASYN</li>
</ul>
</li>
</ul>
<p>-imbalance_type = UNDERSAMPLING:
    - ClusterCentroids,
    - RandomUnderSampler,
    - NearMiss,
    - InstanceHardnessThreshold,
    - CondensedNearestNeighbour,
    - EditedNearestNeighbours,
    - RepeatedEditedNearestNeighbours,
    - AllKNN,
    - NeighbourhoodCleaningRule,
    - OneSidedSelection</p>
<ul>
<li>imbalance_type = COMBINE:<ul>
<li>SMOTEENN,</li>
<li>SMOTETomek</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Attributes</h2>
<ul>
<li>
<p>'optimum_pipe' [Pipeline]:
    An sklearn pipeline object that is fitted to the training data according to the best hyperparameter
    configuration found. Currently, we don't create an ensemble of all best hyperparameter configs over all folds.
    We find the best config by comparing the test error across outer folds. The hyperparameter config of the best
    fold is used as the optimal model and is then trained on the complete set.</p>
</li>
<li>
<p>'best_config' [dict]:
    Dictionary containing the hyperparameters of the best configuration.
    Contains the parameters in the sklearn interface of model_name__parameter_name: parameter value</p>
</li>
<li>
<p>'result_tree' [MDBHyperpipe]:
    Object containing all information about the for the performed hyperparameter search.
    Holds the training and test metrics for all outer folds, inner folds and configurations, as well as
    additional information.</p>
</li>
<li>
<p>'pipeline_elements' [list]:
    Contains all PipelineElement or Hyperpipe objects that are added to the pipeline.</p>
</li>
</ul>
<h2>Example</h2>
<div class="codehilite"><pre><span></span>manager = Hyperpipe(&#39;test_manager&#39;,
                    optimizer=&#39;timeboxed_random_grid_search&#39;, optimizer_params={&#39;limit_in_minutes&#39;: 1},
                    outer_cv=ShuffleSplit(test_size=0.2, n_splits=1),
                    inner_cv=KFold(n_splits=10, shuffle=True),
                    metrics=[&#39;accuracy&#39;, &#39;precision&#39;, &#39;recall&#39;, &quot;f1_score&quot;],
                    best_config_metric=&#39;accuracy&#39;, eval_final_performance=True,
                    verbose=2)
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Hyperpipe</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper class for machine learning pipeline, holding all pipeline elements</span>
<span class="sd">    and managing the optimization of the hyperparameters</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;name&#39; [str]:</span>
<span class="sd">        Name of hyperpipe instance</span>

<span class="sd">    * &#39;inner_cv&#39; [BaseCrossValidator]:</span>
<span class="sd">        Cross validation strategy to test hyperparameter configurations, generates the validation set</span>

<span class="sd">    * &#39;outer_cv&#39; [BaseCrossValidator]:</span>
<span class="sd">        Cross validation strategy to use for the hyperparameter search itself, generates the test set</span>

<span class="sd">    * &#39;optimizer&#39; [str or object, default=&quot;grid_search&quot;]:</span>
<span class="sd">        Hyperparameter optimization algorithm</span>

<span class="sd">        - In case a string literal is given:</span>
<span class="sd">            - &quot;grid_search&quot;: optimizer that iteratively tests all possible hyperparameter combinations</span>
<span class="sd">            - &quot;random_grid_search&quot;: a variation of the grid search optimization that randomly picks hyperparameter</span>
<span class="sd">               combinations from all possible hyperparameter combinations</span>
<span class="sd">            - &quot;timeboxed_random_grid_search&quot;: randomly chooses hyperparameter combinations from the set of all</span>
<span class="sd">               possible hyperparameter combinations and tests until the given time limit is reached</span>
<span class="sd">               - &#39;limit_in_minutes&#39;: int</span>

<span class="sd">        - In case an object is given:</span>
<span class="sd">          expects the object to have the following methods:</span>
<span class="sd">           - &#39;next_config_generator&#39;: returns a hyperparameter configuration in form of an dictionary containing</span>
<span class="sd">              key-&gt;value pairs in the sklearn parameter encoding &#39;model_name__parameter_name: parameter_value&#39;</span>
<span class="sd">           - &#39;prepare&#39;: takes a list of pipeline elements and their particular hyperparameters to test</span>
<span class="sd">           - &#39;evaluate_recent_performance&#39;: gets a tested config and the respective performance in order to</span>
<span class="sd">              calculate a smart next configuration to process</span>

<span class="sd">    * &#39;metrics&#39; [list of metric names as str]:</span>
<span class="sd">        Metrics that should be calculated for both training, validation and test set</span>
<span class="sd">        Use the preimported metrics from sklearn and photonai, or register your own</span>

<span class="sd">        - Metrics for &#39;classification&#39;:</span>
<span class="sd">            - &#39;accuracy&#39;: sklearn.metrics.accuracy_score</span>
<span class="sd">            - &#39;matthews_corrcoef&#39;: sklearn.metrics.matthews_corrcoef</span>
<span class="sd">            - &#39;confusion_matrix&#39;: sklearn.metrics.confusion_matrix,</span>
<span class="sd">            - &#39;f1_score&#39;: sklearn.metrics.f1_score</span>
<span class="sd">            - &#39;hamming_loss&#39;: sklearn.metrics.hamming_loss</span>
<span class="sd">            - &#39;log_loss&#39;: sklearn.metrics.log_loss</span>
<span class="sd">            - &#39;precision&#39;: sklearn.metrics.precision_score</span>
<span class="sd">            - &#39;recall&#39;: sklearn.metrics.recall_score</span>
<span class="sd">        - Metrics for &#39;regression&#39;:</span>
<span class="sd">            - &#39;mean_squared_error&#39;: sklearn.metrics.mean_squared_error</span>
<span class="sd">            - &#39;mean_absolute_error&#39;: sklearn.metrics.mean_absolute_error</span>
<span class="sd">            - &#39;explained_variance&#39;: sklearn.metrics.explained_variance_score</span>
<span class="sd">            - &#39;r2&#39;: sklearn.metrics.r2_score</span>
<span class="sd">        - Other metrics</span>
<span class="sd">            - &#39;pearson_correlation&#39;: photon_core.framework.Metrics.pearson_correlation</span>
<span class="sd">            - &#39;variance_explained&#39;:  photon_core.framework.Metrics.variance_explained_score</span>
<span class="sd">            - &#39;categorical_accuracy&#39;: photon_core.framework.Metrics.categorical_accuracy_score</span>

<span class="sd">    * &#39;best_config_metric&#39; [str]:</span>
<span class="sd">        The metric that should be maximized or minimized in order to choose the best hyperparameter configuration</span>

<span class="sd">    * &#39;eval_final_performance&#39; [bool, default=True]:</span>
<span class="sd">        If the metrics should be calculated for the test set, otherwise the test set is seperated but not used</span>

<span class="sd">    * &#39;test_size&#39; [float, default=0.2]:</span>
<span class="sd">        the amount of the data that should be left out if no outer_cv is given and</span>
<span class="sd">        eval_final_perfomance is set to True</span>

<span class="sd">    * &#39;set_random_seed&#39; [bool, default=False]:</span>
<span class="sd">        If True sets the random seed to 42</span>

<span class="sd">    * &#39;verbosity&#39; [int, default=0]:</span>
<span class="sd">        The level of verbosity, 0 is least talkative and gives only warn and error, 1 gives adds info and 2 adds debug</span>

<span class="sd">    * &#39;groups&#39; [array-like, default=None]:</span>
<span class="sd">        Info for advanced cross validation strategies, such as LeaveOneSiteOut-CV about the affiliation</span>
<span class="sd">        of the rows in the data</span>

<span class="sd">    * &#39;filter_element&#39; [SourceFilter, default=None]:</span>
<span class="sd">        Instance of SourceFilter Class that transforms the input data, e.g. extracts certain columns</span>

<span class="sd">    * &#39;imbalanced_data_strategy_filter&#39; [str, default=None]:</span>
<span class="sd">        Uses the imblearn package to handle imbalanced class distributions in the data</span>
<span class="sd">        A strategy is used to transform the data into more balanced distributions before the hyperparameter search</span>
<span class="sd">        is started.</span>
<span class="sd">        Strategies to choose from are:</span>
<span class="sd">        - imbalance_type = OVERSAMPLING:</span>
<span class="sd">            - RandomOverSampler</span>
<span class="sd">            - SMOTE</span>
<span class="sd">            - ADASYN</span>

<span class="sd">        -imbalance_type = UNDERSAMPLING:</span>
<span class="sd">            - ClusterCentroids,</span>
<span class="sd">            - RandomUnderSampler,</span>
<span class="sd">            - NearMiss,</span>
<span class="sd">            - InstanceHardnessThreshold,</span>
<span class="sd">            - CondensedNearestNeighbour,</span>
<span class="sd">            - EditedNearestNeighbours,</span>
<span class="sd">            - RepeatedEditedNearestNeighbours,</span>
<span class="sd">            - AllKNN,</span>
<span class="sd">            - NeighbourhoodCleaningRule,</span>
<span class="sd">            - OneSidedSelection</span>

<span class="sd">        - imbalance_type = COMBINE:</span>
<span class="sd">            - SMOTEENN,</span>
<span class="sd">            - SMOTETomek</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;optimum_pipe&#39; [Pipeline]:</span>
<span class="sd">        An sklearn pipeline object that is fitted to the training data according to the best hyperparameter</span>
<span class="sd">        configuration found. Currently, we don&#39;t create an ensemble of all best hyperparameter configs over all folds.</span>
<span class="sd">        We find the best config by comparing the test error across outer folds. The hyperparameter config of the best</span>
<span class="sd">        fold is used as the optimal model and is then trained on the complete set.</span>

<span class="sd">    * &#39;best_config&#39; [dict]:</span>
<span class="sd">        Dictionary containing the hyperparameters of the best configuration.</span>
<span class="sd">        Contains the parameters in the sklearn interface of model_name__parameter_name: parameter value</span>

<span class="sd">    * &#39;result_tree&#39; [MDBHyperpipe]:</span>
<span class="sd">        Object containing all information about the for the performed hyperparameter search.</span>
<span class="sd">        Holds the training and test metrics for all outer folds, inner folds and configurations, as well as</span>
<span class="sd">        additional information.</span>

<span class="sd">    * &#39;pipeline_elements&#39; [list]:</span>
<span class="sd">        Contains all PipelineElement or Hyperpipe objects that are added to the pipeline.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">        manager = Hyperpipe(&#39;test_manager&#39;,</span>
<span class="sd">                            optimizer=&#39;timeboxed_random_grid_search&#39;, optimizer_params={&#39;limit_in_minutes&#39;: 1},</span>
<span class="sd">                            outer_cv=ShuffleSplit(test_size=0.2, n_splits=1),</span>
<span class="sd">                            inner_cv=KFold(n_splits=10, shuffle=True),</span>
<span class="sd">                            metrics=[&#39;accuracy&#39;, &#39;precision&#39;, &#39;recall&#39;, &quot;f1_score&quot;],</span>
<span class="sd">                            best_config_metric=&#39;accuracy&#39;, eval_final_performance=True,</span>
<span class="sd">                            verbose=2)</span>

<span class="sd">   &quot;&quot;&quot;</span>

    <span class="n">OPTIMIZER_DICTIONARY</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;grid_search&#39;</span><span class="p">:</span> <span class="n">GridSearchOptimizer</span><span class="p">,</span>
                            <span class="s1">&#39;random_grid_search&#39;</span><span class="p">:</span> <span class="n">RandomGridSearchOptimizer</span><span class="p">,</span>
                            <span class="s1">&#39;timeboxed_random_grid_search&#39;</span><span class="p">:</span> <span class="n">TimeBoxedRandomGridSearchOptimizer</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">inner_cv</span><span class="p">:</span> <span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">outer_cv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;grid_search&#39;</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">metrics</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">best_config_metric</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">eval_final_performance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">calculate_metrics_per_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">calculate_metrics_across_folds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">groups</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">set_random_seed</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">filter_element</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">persist_options</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">performance_constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c1"># Re eval_final_performance:</span>
        <span class="c1"># set eval_final_performance to False because</span>
        <span class="c1"># 1. if no cv-object is given, no split is performed --&gt; seems more logical</span>
        <span class="c1">#    than passing nothing, passing no cv-object but getting</span>
        <span class="c1">#    an 80/20 split by default</span>
        <span class="c1"># 2. if cv-object is given, split is performed but we don&#39;t peek</span>
        <span class="c1">#    into the test set --&gt; thus we can evaluate more hp configs</span>
        <span class="c1">#    later without double dipping</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_cv</span> <span class="o">=</span> <span class="n">inner_cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_cv</span> <span class="o">=</span> <span class="n">outer_cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span> <span class="o">=</span> <span class="n">eval_final_performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_iter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_per_fold</span> <span class="o">=</span> <span class="n">calculate_metrics_per_fold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_across_folds</span> <span class="o">=</span> <span class="n">calculate_metrics_across_folds</span>

        <span class="c1"># Todo: if self.outer_cv is LeaveOneOut: Set calculate metrics across folds to True -&gt; Print</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span> <span class="o">=</span> <span class="n">filter_element</span>
        <span class="k">if</span> <span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span> <span class="o">=</span> <span class="n">ImbalancedDataTransform</span><span class="p">(</span><span class="n">imbalanced_data_strategy_filter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_duration</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">set_random_seed</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">random</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;set random seed to 42&#39;</span><span class="p">)</span>

        <span class="c1"># set verbosity level</span>
        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="c1"># MongoDBWriter setup</span>
        <span class="k">if</span> <span class="n">persist_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span> <span class="o">=</span> <span class="n">persist_options</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_custom_log_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span> <span class="o">=</span> <span class="n">MongoDBWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="c1">#  Todo: raise error or warning if metrics and best config_metric is None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span> <span class="o">=</span> <span class="n">best_config_metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_children_config</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_performance</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__mother_outer_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mother_inner_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mother_config_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># containers for optimization history and logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_performance_history_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># instantiate optimizer from string</span>
            <span class="c1">#  Todo: check if optimizer strategy is already implemented</span>
            <span class="n">optimizer_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTIMIZER_DICTIONARY</span><span class="p">[</span><span class="n">optimizer</span><span class="p">]</span>
            <span class="n">optimizer_instance</span> <span class="o">=</span> <span class="n">optimizer_class</span><span class="p">(</span><span class="o">**</span><span class="n">optimizer_params</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer_instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Todo: check if correct object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_fit_data_hash</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mother_pipe</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inner_cv_callback_function</span> <span class="o">=</span> <span class="n">performance_constraints</span>

    <span class="k">def</span> <span class="nf">_set_verbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set verbosity level manually</span>
<span class="sd">        Returns None</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;verbosity&#39; [Integer]:</span>
<span class="sd">            Verbosity level can be 0, 1, or 2.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_persist_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">persist_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set persist options manually</span>
<span class="sd">        Returns None</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * persist_options&#39; [OutputSettings]:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span> <span class="o">=</span> <span class="n">persist_options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_custom_log_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span> <span class="o">=</span> <span class="n">MongoDBWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an element to the machine learning pipeline</span>
<span class="sd">        Returns self</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;pipe_element&#39; [PipelineElement or Hyperpipe]:</span>
<span class="sd">            The object to add to the machine learning pipeline, being either a transformer or an estimator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if isinstance(pipe_element, PipelineElement):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
        <span class="c1"># Todo: is repeated each time element is added....</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_pipeline</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
        <span class="c1"># else:</span>
        <span class="c1">#     Todo: raise error</span>
        <span class="c1"># raise TypeError(&quot;Element must be of type Pipeline Element&quot;)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__yield_all_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function that iteratively returns the data stored in self.X</span>
<span class="sd">        Returns an iterable version of self.X</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))),</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_generate_outer_cv_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the training and  test set indices for the hyperparameter search</span>
<span class="sd">        Returns a tuple of training and test indices</span>

<span class="sd">        - If there is a strategy given for the outer cross validation the strategy is called to split the data</span>
<span class="sd">        - If no strategy is given and eval_final_performance is True, all data is used for training</span>
<span class="sd">        - If no strategy is given and eval_final_performance is False: a test set is seperated from the</span>
<span class="sd">          training and validation set by the parameter test_size with ShuffleSplit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if there is a CV Object for cross validating the hyperparameter search</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer_cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c1"># in case we do not want to divide between validation and test set</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yield_all_data</span><span class="p">()</span>
        <span class="c1"># the default is dividing one time into a validation and test set</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">train_test_cv_object</span> <span class="o">=</span> <span class="n">ShuffleSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span> <span class="o">=</span> <span class="n">train_test_cv_object</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reset_final_fit</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">outer_fold_counter</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inner_fold_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                                  <span class="n">num_of_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">config_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Informs all elements of the pipeline that are of type hyperpipe (hyperpipe children)</span>
<span class="sd">        about the mother&#39;s configuration or current state</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;num_of_folds&#39; [int]:</span>
<span class="sd">            how many inner folds the mother hyperpipe has</span>

<span class="sd">        * &#39;outer_fold_counter&#39; [int]:</span>
<span class="sd">            in which outer fold the mother hyerpipe currently is</span>

<span class="sd">        * &#39;inner_fold_counter&#39; [int]:</span>
<span class="sd">            in which inner fold the mother hyperpipe currently is</span>

<span class="sd">        * &#39;config_counter&#39; [int]:</span>
<span class="sd">            in which config_nr the mother hyperpipe actually is</span>

<span class="sd">        * &#39;reset&#39; [bool, default = False]:</span>
<span class="sd">            if the hyperparameter search starts anew</span>

<span class="sd">        * &#39;reset_final_fit&#39; [bool, default = False]:</span>
<span class="sd">            reset the is_final_fit parameter so that children hyperpipe train anew for outer fold of mother pipe</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_distribute_info_to_object</span><span class="p">(</span><span class="n">pipe_object</span><span class="p">,</span> <span class="n">number_of_folds</span><span class="p">,</span> <span class="n">reset_folds</span><span class="p">,</span> <span class="n">reset_final_fit</span><span class="p">,</span>
                                      <span class="n">outer_fold_counter</span><span class="p">,</span> <span class="n">inner_fold_counter</span><span class="p">,</span> <span class="n">config_counter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pipe_object</span><span class="o">.</span><span class="n">local_search</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number_of_folds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">num_of_folds</span> <span class="o">=</span> <span class="n">number_of_folds</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">is_mother_pipe</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">reset_folds</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">current_fold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">outer_fold_counter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">mother_outer_fold_counter</span> <span class="o">=</span> <span class="n">outer_fold_counter</span>
                <span class="k">if</span> <span class="n">inner_fold_counter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">mother_inner_fold_counter</span> <span class="o">=</span> <span class="n">inner_fold_counter</span>
                <span class="k">if</span> <span class="n">config_counter</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">mother_config_counter</span> <span class="o">=</span> <span class="n">config_counter</span>
                <span class="k">if</span> <span class="n">reset_final_fit</span><span class="p">:</span>
                    <span class="n">pipe_object</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># walk through all children of pipeline, if its a hyperpipe distribute the information</span>
        <span class="k">for</span> <span class="n">element_tuple</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
            <span class="n">element_object</span> <span class="o">=</span> <span class="n">element_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element_object</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                <span class="n">_distribute_info_to_object</span><span class="p">(</span><span class="n">element_object</span><span class="p">,</span> <span class="n">num_of_folds</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">reset_final_fit</span><span class="p">,</span>
                                          <span class="n">outer_fold_counter</span><span class="p">,</span> <span class="n">inner_fold_counter</span><span class="p">,</span> <span class="n">config_counter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element_object</span><span class="p">,</span> <span class="n">PipelineStacking</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child_pipe_name</span><span class="p">,</span> <span class="n">child_pipe_object</span> <span class="ow">in</span> <span class="n">element_object</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child_pipe_object</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                        <span class="n">_distribute_info_to_object</span><span class="p">(</span><span class="n">child_pipe_object</span><span class="p">,</span> <span class="n">num_of_folds</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">reset_final_fit</span><span class="p">,</span>
                                                  <span class="n">outer_fold_counter</span><span class="p">,</span> <span class="n">inner_fold_counter</span><span class="p">,</span> <span class="n">config_counter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_mother_inner_fold_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_inner_fold_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function handle so that the TestPipeline class from Photon&#39;s validation module can pass the information to hyperpipe children</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;new_inner_fold_nr&#39; [int]:</span>
<span class="sd">            in which inner_fold the mother hyperpipe currently is</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">inner_fold_counter</span><span class="o">=</span><span class="n">new_inner_fold_nr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the hyperparameter search and/or fits the pipeline to the data and targets</span>

<span class="sd">        Manages the nested cross validated hyperparameter search:</span>

<span class="sd">        1. Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</span>
<span class="sd">        2. requests new configurations from the hyperparameter search strategy, the optimizer,</span>
<span class="sd">        3. initializes the testing of a specific configuration,</span>
<span class="sd">        4. communicates the result to the optimizer,</span>
<span class="sd">        5. repeats 2-4 until optimizer delivers no more configurations to test</span>
<span class="sd">        6. finally searches for the best config in all tested configs,</span>
<span class="sd">        7. trains the pipeline with the best config and evaluates the performance on the test set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">         * `data` [array-like, shape=[N, D]]:</span>
<span class="sd">            the training and test data, where N is the number of samples and D is the number of features.</span>

<span class="sd">         * `targets` [array-like, shape=[N]]:</span>
<span class="sd">            the truth values, where N is the number of samples.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         * &#39;self&#39;</span>
<span class="sd">            Returns self</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># in case we want to inject some data from outside the pipeline</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">targets</span>


        <span class="c1"># !!!!!!!!!!!!!!!! FIT ONLY IF DATA CHANGED !!!!!!!!!!!!!!!!!!!</span>
        <span class="c1"># -------------------------------------------------------------</span>

        <span class="c1"># in case we need to reduce the dimension of the data due to parallelity of the outer pipe, lets do it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># if the groups are imbalanced, and a strategy is chosen, apply it here</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># be compatible to list of (image-) files</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># handle neuro Imge paths as data</span>
        <span class="c1"># ToDo: Need to check the DATA, not the img paths for neuro</span>
        <span class="n">new_data_hash</span> <span class="o">=</span> <span class="n">sha1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># fit</span>
        <span class="c1"># 1. if it is first time ever or</span>
        <span class="c1"># 2. the data did change for that fold or</span>
        <span class="c1"># 3. if it is the mother pipe (then number_of_folds = 0)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">]</span> <span class="o">!=</span> <span class="n">new_data_hash</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># save data hash for that fold</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data_hash</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data_hash</span>

            <span class="c1"># optimize: iterate through configs and save results</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span><span class="p">:</span>

                <span class="c1"># first check if correct optimizer metric has been chosen</span>
                <span class="c1"># pass pipeline_elements so that OptimizerMetric can look for last</span>
                <span class="c1"># element and use the corresponding score method</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span> <span class="o">=</span> <span class="n">OptimizerMetric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">check_metrics</span><span class="p">()</span>

                <span class="k">if</span> <span class="s1">&#39;score&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Attention: Scoring with default score function of estimator can slow down calculations!&#39;</span><span class="p">)</span>

                <span class="c1"># generate OUTER ! cross validation splits to iterate over</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_outer_cv_indices</span><span class="p">()</span>

                <span class="n">outer_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_mother_pipe</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_outer_fold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mother_outer_fold_counter</span><span class="p">)</span>  \
                                            <span class="o">+</span> <span class="s1">&#39;_inner_fold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mother_inner_fold_counter</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># initialize result logging with hyperpipe class</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span> <span class="o">=</span> <span class="n">MDBHyperpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">eval_final_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">best_config_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span>

                <span class="c1"># loop over outer cross validation</span>
                <span class="k">for</span> <span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span><span class="p">:</span>

                    <span class="c1"># give the optimizer the chance to inform about elements</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">)</span>

                    <span class="n">outer_fold_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">outer_fold_fit_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;HYPERPARAMETER SEARCH OF {0}, Outer Cross validation Fold {1}&#39;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outer_fold_counter</span><span class="p">))</span>

                    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

                    <span class="c1"># Prepare Train and validation set data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">train_indices</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">train_indices</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">test_indices</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">test_indices</span><span class="p">]</span>

                    <span class="c1"># Prepare inner cross validation</span>
                    <span class="n">cv_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">))</span>
                    <span class="n">num_folds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_iter</span><span class="p">)</span>
                    <span class="n">num_samples_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>
                    <span class="n">num_samples_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span><span class="p">)</span>

                    <span class="c1"># distribute number of folds to encapsulated child hyperpipes</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">num_of_folds</span><span class="o">=</span><span class="n">num_folds</span><span class="p">,</span>
                                                                   <span class="n">outer_fold_counter</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>

                    <span class="n">tested_config_counter</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="c1"># add outer fold info object to result tree</span>
                    <span class="n">outer_fold</span> <span class="o">=</span> <span class="n">MDBOuterFold</span><span class="p">(</span><span class="n">fold_nr</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>
                    <span class="n">outer_fold</span><span class="o">.</span><span class="n">tested_config_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_fold</span><span class="p">)</span>

                    <span class="c1"># do the optimizing</span>
                    <span class="k">for</span> <span class="n">current_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">next_config</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">config_counter</span><span class="o">=</span><span class="n">tested_config_counter</span><span class="p">)</span>
                        <span class="n">hp</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">,</span> <span class="n">current_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_mother_inner_fold_nr</span><span class="p">,</span>
                                          <span class="n">mongo_db_settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="p">,</span>
                                          <span class="n">callback_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_cv_callback_function</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;optimizing of:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">current_config</span><span class="p">))</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calculating...&#39;</span><span class="p">)</span>

                        <span class="c1"># Test the configuration cross validated by inner_cv object</span>
                        <span class="n">current_config_mdb</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">calculate_cv_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">,</span> <span class="n">cv_iter</span><span class="p">,</span>
                                                            <span class="n">calculate_metrics_per_fold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_per_fold</span><span class="p">,</span>
                                                            <span class="n">calculate_metrics_across_folds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_across_folds</span><span class="p">)</span>

                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_nr</span> <span class="o">=</span> <span class="n">tested_config_counter</span>
                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_dict</span> <span class="o">=</span> <span class="n">current_config</span>
                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">pipe_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="n">tested_config_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">human_readable_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_to_dict</span><span class="p">(</span><span class="n">current_config</span><span class="p">)</span>

                        <span class="c1"># save the configuration of all children pipelines</span>
                        <span class="n">children_config</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">children_config_ref_list</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">pipe_step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
                            <span class="n">item</span> <span class="o">=</span> <span class="n">pipe_step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">local_search</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">best_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                    <span class="n">children_config</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">best_config</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">PipelineStacking</span><span class="p">):</span>
                                <span class="k">for</span> <span class="n">subhyperpipe_name</span><span class="p">,</span> <span class="n">hyperpipe</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hyperpipe</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                                        <span class="k">if</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">local_search</span> <span class="ow">and</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">best_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                            <span class="c1"># special case: we need to access pipe over pipeline_stacking element</span>
                                            <span class="n">children_config</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">subhyperpipe_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span>
                                        <span class="c1"># children_config_ref_list.append(hyperpipe.best_config_outer_fold._id)</span>
                        <span class="n">specific_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
                        <span class="c1">#current_config_mdb.full_model_spec = specific_parameters</span>

                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">children_config_dict</span> <span class="o">=</span> <span class="n">children_config</span>
                        <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">children_config_ref</span> <span class="o">=</span> <span class="n">children_config_ref_list</span>

                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">current_config</span><span class="p">))</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_failed</span><span class="p">:</span>
                            <span class="c1"># get optimizer_metric and forward to optimizer</span>
                            <span class="c1"># todo: also pass greater_is_better=True/False to optimizer</span>
                            <span class="n">metric_train</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">get_metric</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">,</span> <span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
                            <span class="n">metric_test</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">get_metric</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">,</span> <span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                            <span class="c1">#</span>
                            <span class="c1"># if not metric_train or metric_test:</span>
                            <span class="c1">#     raise Exception(&quot;Config did not fail, but did not get any metrics either....!!?&quot;)</span>
                            <span class="n">config_performance</span> <span class="o">=</span> <span class="p">(</span><span class="n">metric_train</span><span class="p">,</span> <span class="n">metric_test</span><span class="p">)</span>

                            <span class="c1"># Print Result for config</span>
                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;...done:&#39;</span><span class="p">)</span>
                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_performance</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                             <span class="n">config_performance</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                             <span class="c1"># Print Result for config</span>
                             <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;...failed:&#39;</span><span class="p">)</span>
                             <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_error</span><span class="p">)</span>

                        <span class="c1"># add config to result tree and do intermediate saving</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tested_config_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">)</span>
                        <span class="c1"># Todo: add try catch in case config cannot be written</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>

                        <span class="c1"># 3. inform optimizer about performance</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">evaluate_recent_performance</span><span class="p">(</span><span class="n">current_config</span><span class="p">,</span> <span class="n">config_performance</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">tested_config_counter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">best_config_outer_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">get_optimum_config</span><span class="p">(</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">tested_config_list</span><span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">best_config_outer_fold</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No best config was found!&quot;</span><span class="p">)</span>
                        <span class="n">best_config_outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBConfig</span><span class="p">()</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">children_config_dict</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">pipe_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_ref</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">children_config_ref</span>
                        <span class="c1"># best_config_outer_fold_mdb.best_config_ref_to_train_item = best_config_outer_fold._id</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">config_dict</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">human_readable_config</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">human_readable_config</span>


                        <span class="c1"># inform user</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;finished optimization of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Result&#39;</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Number of tested configurations:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tested_config_counter</span><span class="p">))</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Optimizer metric: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                                         <span class="s1">&#39;   --&gt; Greater is better: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">greater_is_better</span><span class="p">))</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Best config: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">+</span>
                                      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;... with children config: &#39;</span>
                                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span><span class="p">))</span>


                        <span class="c1"># ... and create optimal pipeline</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
                        <span class="c1"># set self to best config</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>

                        <span class="c1"># set all children to best config and inform to NOT optimize again, ONLY fit</span>
                        <span class="k">for</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">child_config</span> <span class="ow">in</span> <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">child_config</span><span class="p">:</span>
                                <span class="c1"># in case we have a pipeline stacking we need to identify the particular subhyperpipe</span>
                                <span class="n">splitted_name</span> <span class="o">=</span> <span class="n">child_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitted_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">stacking_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">splitted_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                    <span class="n">pipe_element</span> <span class="o">=</span> <span class="n">stacking_element</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">[</span><span class="n">splitted_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">pipe_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">child_name</span><span class="p">]</span>
                                <span class="n">pipe_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">child_config</span><span class="p">)</span>
                                <span class="n">pipe_element</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="bp">True</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now fitting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; with optimum configuration&#39;</span><span class="p">)</span>
                        <span class="n">fit_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>
                        <span class="n">final_fit_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">fit_time_start</span>

                        <span class="c1">#self.best_config_outer_fold.full_model_spec = self.optimum_pipe.get_params()</span>
                        <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">fit_duration_minutes</span> <span class="o">=</span> <span class="n">final_fit_duration</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="n">best_config_outer_fold_mdb</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span><span class="p">:</span>
                            <span class="c1"># Todo: generate mean and std over outer folds as well. move this items to the top</span>
                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now predicting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; unseen data&#39;</span><span class="p">)</span>

                            <span class="n">test_score_mdb</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span><span class="p">,</span>
                                                                <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                                                                <span class="n">save_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_predictions</span><span class="p">,</span>
                                                                <span class="n">save_feature_importances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_feature_importances</span><span class="p">)</span>

                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;.. calculating metrics for test set (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now predicting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; final model with training data&#39;</span><span class="p">)</span>

                            <span class="n">train_score_mdb</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                                                                 <span class="n">save_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_predictions</span><span class="p">,</span>
                                                                 <span class="n">save_feature_importances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_feature_importances</span><span class="p">)</span>

                            <span class="c1"># save test fold</span>
                            <span class="n">outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBInnerFold</span><span class="p">()</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">fold_nr</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_training</span> <span class="o">=</span> <span class="n">num_samples_train</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_validation</span> <span class="o">=</span> <span class="n">num_samples_test</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="n">train_score_mdb</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">test_score_mdb</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_fold_mdb</span><span class="p">]</span>

                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PERFORMANCE TRAIN:&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">m_key</span><span class="p">,</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">train_score_mdb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_value</span><span class="p">))</span>

                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PERFORMANCE TEST:&#39;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">m_key</span><span class="p">,</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">test_score_mdb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_value</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>

                            <span class="c1"># save test fold</span>
                            <span class="n">outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBInnerFold</span><span class="p">()</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">fold_nr</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_training</span> <span class="o">=</span> <span class="n">num_samples_train</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_validation</span> <span class="o">=</span> <span class="n">num_samples_test</span>

                            <span class="k">def</span> <span class="nf">_copy_inner_fold_means</span><span class="p">(</span><span class="n">metric_dict</span><span class="p">):</span>
                                <span class="c1"># We copy all mean values from validation to the best config</span>
                                <span class="c1"># training</span>
                                <span class="n">train_item_metrics</span> <span class="o">=</span> <span class="p">{}</span>
                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metric_dict</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">):</span>
                                        <span class="n">train_item_metrics</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">value</span>
                                <span class="n">train_item</span> <span class="o">=</span> <span class="n">MDBScoreInformation</span><span class="p">()</span>
                                <span class="n">train_item</span><span class="o">.</span><span class="n">metrics_copied_from_inner</span> <span class="o">=</span> <span class="bp">True</span>
                                <span class="n">train_item</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">train_item_metrics</span>
                                <span class="k">return</span> <span class="n">train_item</span>

                            <span class="c1"># training</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="n">_copy_inner_fold_means</span><span class="p">(</span><span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">)</span>
                            <span class="c1"># validation</span>
                            <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">_copy_inner_fold_means</span><span class="p">(</span><span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">metrics_test</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_fold_mdb</span><span class="p">]</span>

                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;This took {} minutes.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">time_of_results</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset_final_fit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outer_fold_counter</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>

                <span class="c1"># Compute all final metrics</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">metrics_test</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">aggregate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">,</span>
                                                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
                <span class="c1"># save result tree to db or file or both</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saved result tree to database&quot;</span><span class="p">)</span>

                <span class="c1"># Find best config across outer folds</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">get_optimum_config_outer_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;OVERALL BEST CONFIGURATION&#39;</span><span class="p">)</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;--------------------------&#39;</span><span class="p">)</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;... with children config: &#39;</span>
                              <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">children_config_dict</span><span class="p">))</span>
                <span class="c1"># set self to best config</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>

                <span class="c1"># save results again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saved overall best config to database&quot;</span><span class="p">)</span>
            <span class="c1">###############################################################################################</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Avoided fitting of &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; on fold &quot;</span>
                             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; because data did not change&quot;</span><span class="p">)</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Best config of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to predict the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            predicted targets</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Todo: if local_search = true then use optimized pipe here?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict probabilities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        predicted probabilities</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to transform the data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve parameters from sklearn pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give parameter values to the pipeline elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_prepare_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        build sklearn pipeline from PipelineElements and</span>
<span class="sd">        calculate parameter grid for all combinations of pipeline element hyperparameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prepare pipeline</span>
        <span class="n">pipeline_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="c1"># pipeline_steps.append((item.name, item.base_element))</span>
            <span class="n">pipeline_steps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

        <span class="c1"># build pipeline...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to copy all pipeline elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item_list</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">copy_me</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">item_list</span>

    <span class="k">def</span> <span class="nf">_copy_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy Pipeline by building a new sklearn Pipeline with Pipeline Elements</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new sklearn Pipeline object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline_steps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="n">cpy</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpy</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">new_step</span> <span class="ow">in</span> <span class="n">cpy</span><span class="p">:</span>
                    <span class="n">pipeline_steps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pipeline_steps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cpy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cpy</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_optimum_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save optimal pipeline only. Complete hyperpipe will no not be saved.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;file&#39; [str]:</span>
<span class="sd">            File path as string specifying file to save pipeline to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">element_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">element_identifier</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.photon&#39;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FileExistsError</span><span class="p">(</span><span class="s1">&#39;Trying to save optimum pipe: The file you specified already exists as a folder.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">wrapper_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_optimum_pipe_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">element_name</span>
            <span class="n">element_identifier</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;element_name&#39;</span><span class="p">:</span> <span class="n">element_name</span><span class="p">,</span>
                                       <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">})</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;save&#39;</span><span class="p">):</span>
                <span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;wrapper_script&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
                <span class="n">wrapper_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;test_disabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">test_disabled</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">disabled</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;hyperparameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">hyperparameters</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Custom pipeline element must implement .save() method or &quot;</span>
                                              <span class="s2">&quot;allow pickle.&quot;</span><span class="p">)</span>
            <span class="n">element_number</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># save pipeline blueprint to make loading of pipeline easier</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_blueprint.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">element_identifier</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="c1"># get all files</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_*&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myzip</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">myzip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">wrapper_files</span><span class="p">:</span>
                <span class="n">myzip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">removedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_optimum_pipe</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load optimal pipeline.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;file&#39; [str]:</span>
<span class="sd">            File path specifying .photon file to load optimal pipeline from</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sklearn Pipeline with all trained photon_pipelines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.photon&#39;</span><span class="p">):</span>
            <span class="n">archive_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">archive_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
            <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
            <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Specify .photon file that holds PHOTON optimum pipe.&#39;</span><span class="p">)</span>

        <span class="n">setup_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_blueprint.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="n">element_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element_info</span> <span class="ow">in</span> <span class="n">setup_info</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
                <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span>
                                                              <span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;wrapper_script&#39;</span><span class="p">])</span>
                <span class="n">imported_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">imported_module</span><span class="p">)</span>
                <span class="n">base_element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">])</span>
                <span class="n">custom_element</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">(),</span>
                                                 <span class="n">hyperparameters</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;hyperparameters&#39;</span><span class="p">],</span>
                                                 <span class="n">test_disabled</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;test_disabled&#39;</span><span class="p">],</span>
                                                 <span class="n">disabled</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">])</span>
                <span class="n">custom_element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
                <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">custom_element</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">inverse_transform_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_to_inverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse transform data for a pipeline with specific hyperparameter configuration</span>

<span class="sd">        1. Copy Sklearn Pipeline,</span>
<span class="sd">        2. Set Parameters</span>
<span class="sd">        3. Fit Pipeline to data and targets</span>
<span class="sd">        4. Inverse transform data with that pipeline</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;hyperparameters&#39; [dict]:</span>
<span class="sd">            The concrete configuration settings for the pipeline elements</span>
<span class="sd">        * &#39;data&#39; [array-like]:</span>
<span class="sd">            The training data to which the pipeline is fitted</span>
<span class="sd">        * &#39;targets&#39; [array-like]:</span>
<span class="sd">            The truth values for training</span>
<span class="sd">        * &#39;data_to_inverse&#39; [array-like]:</span>
<span class="sd">            The data that should be inversed after training</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Inversed data as array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copied_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_pipeline</span><span class="p">()</span>
        <span class="n">copied_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">hyperparameters</span><span class="p">)</span>
        <span class="n">copied_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copied_pipe</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data_to_inverse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_optimize_printing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make the sklearn config syntax prettily readable for humans</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prettified_config</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">el_key</span><span class="p">,</span> <span class="n">el_value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">el_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">:</span>
                <span class="n">new_pretty_key</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-&gt;&#39;</span>
                <span class="n">prettified_config</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_pretty_key</span> <span class="o">+</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">prettify_config_output</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">el_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ValueError: Item is not contained in pipeline:&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Item is not contained in pipeline:&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prettified_config</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the disabled = False as Enabled = True for better human reading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">config_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specific_config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">specific_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">prettify_config_output</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
                <span class="c1">#config[name] = value</span>
        <span class="k">return</span> <span class="n">config</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.Hyperpipe">Hyperpipe</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.Hyperpipe.OPTIMIZER_DICTIONARY" class="name">var <span class="ident">OPTIMIZER_DICTIONARY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, inner_cv, outer_cv=None, optimizer=&#39;grid_search&#39;, optimizer_params={}, metrics=None, best_config_metric=None, eval_final_performance=True, test_size=0.2, calculate_metrics_per_fold=True, calculate_metrics_across_folds=False, groups=None, set_random_seed=False, filter_element=None, imbalanced_data_strategy_filter=&#39;&#39;, verbosity=0, persist_options=None, performance_constraints=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">inner_cv</span><span class="p">:</span> <span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">outer_cv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;grid_search&#39;</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">metrics</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">best_config_metric</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">eval_final_performance</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
             <span class="n">calculate_metrics_per_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">calculate_metrics_across_folds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
             <span class="n">groups</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">set_random_seed</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">filter_element</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">persist_options</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">performance_constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># Re eval_final_performance:</span>
    <span class="c1"># set eval_final_performance to False because</span>
    <span class="c1"># 1. if no cv-object is given, no split is performed --&gt; seems more logical</span>
    <span class="c1">#    than passing nothing, passing no cv-object but getting</span>
    <span class="c1">#    an 80/20 split by default</span>
    <span class="c1"># 2. if cv-object is given, split is performed but we don&#39;t peek</span>
    <span class="c1">#    into the test set --&gt; thus we can evaluate more hp configs</span>
    <span class="c1">#    later without double dipping</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inner_cv</span> <span class="o">=</span> <span class="n">inner_cv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outer_cv</span> <span class="o">=</span> <span class="n">outer_cv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span> <span class="o">=</span> <span class="n">eval_final_performance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cv_iter</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_per_fold</span> <span class="o">=</span> <span class="n">calculate_metrics_per_fold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_across_folds</span> <span class="o">=</span> <span class="n">calculate_metrics_across_folds</span>
    <span class="c1"># Todo: if self.outer_cv is LeaveOneOut: Set calculate metrics across folds to True -&gt; Print</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="n">groups</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span> <span class="o">=</span> <span class="n">filter_element</span>
    <span class="k">if</span> <span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span> <span class="o">=</span> <span class="n">ImbalancedDataTransform</span><span class="p">(</span><span class="n">imbalanced_data_strategy_filter</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_duration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">set_random_seed</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">random</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;set random seed to 42&#39;</span><span class="p">)</span>
    <span class="c1"># set verbosity level</span>
    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
    <span class="c1"># MongoDBWriter setup</span>
    <span class="k">if</span> <span class="n">persist_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span> <span class="o">=</span> <span class="n">persist_options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">set_custom_log_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">log_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span> <span class="o">=</span> <span class="n">MongoDBWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
    <span class="c1">#  Todo: raise error or warning if metrics and best config_metric is None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span> <span class="o">=</span> <span class="n">best_config_metric</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_children_config</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_performance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__mother_outer_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__mother_inner_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__mother_config_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># containers for optimization history and logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_performance_history_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># instantiate optimizer from string</span>
        <span class="c1">#  Todo: check if optimizer strategy is already implemented</span>
        <span class="n">optimizer_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OPTIMIZER_DICTIONARY</span><span class="p">[</span><span class="n">optimizer</span><span class="p">]</span>
        <span class="n">optimizer_instance</span> <span class="o">=</span> <span class="n">optimizer_class</span><span class="p">(</span><span class="o">**</span><span class="n">optimizer_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer_instance</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Todo: check if correct object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_last_fit_data_hash</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_mother_pipe</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inner_cv_callback_function</span> <span class="o">=</span> <span class="n">performance_constraints</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.add">
    <p>def <span class="ident">add</span>(</p><p>self, pipe_element)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.add', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.add" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.config_to_dict">
    <p>def <span class="ident">config_to_dict</span>(</p><p>self, specific_config)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.config_to_dict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.config_to_dict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">config_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specific_config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">specific_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">prettify_config_output</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
            <span class="c1">#config[name] = value</span>
    <span class="k">return</span> <span class="n">config</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.copy_me">
    <p>def <span class="ident">copy_me</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Helper function to copy all pipeline elements</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.copy_me', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.copy_me" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to copy all pipeline elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item_list</span> <span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
        <span class="n">item_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">copy_me</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">item_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, data, targets, **fit_params)</p>
    </div>
    

    
  
    <div class="desc"><p>Starts the hyperparameter search and/or fits the pipeline to the data and targets</p>
<p>Manages the nested cross validated hyperparameter search:</p>
<ol>
<li>Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</li>
<li>requests new configurations from the hyperparameter search strategy, the optimizer,</li>
<li>initializes the testing of a specific configuration,</li>
<li>communicates the result to the optimizer,</li>
<li>repeats 2-4 until optimizer delivers no more configurations to test</li>
<li>finally searches for the best config in all tested configs,</li>
<li>trains the pipeline with the best config and evaluates the performance on the test set</li>
</ol>
<h2>Parameters</h2>
<ul>
<li>
<p><code>data</code> [array-like, shape=[N, D]]:
    the training and test data, where N is the number of samples and D is the number of features.</p>
</li>
<li>
<p><code>targets</code> [array-like, shape=[N]]:
    the truth values, where N is the number of samples.</p>
</li>
</ul>
<h2>Returns</h2>
<ul>
<li>'self'
    Returns self</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.fit', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts the hyperparameter search and/or fits the pipeline to the data and targets</span>
<span class="sd">    Manages the nested cross validated hyperparameter search:</span>
<span class="sd">    1. Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</span>
<span class="sd">    2. requests new configurations from the hyperparameter search strategy, the optimizer,</span>
<span class="sd">    3. initializes the testing of a specific configuration,</span>
<span class="sd">    4. communicates the result to the optimizer,</span>
<span class="sd">    5. repeats 2-4 until optimizer delivers no more configurations to test</span>
<span class="sd">    6. finally searches for the best config in all tested configs,</span>
<span class="sd">    7. trains the pipeline with the best config and evaluates the performance on the test set</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">     * `data` [array-like, shape=[N, D]]:</span>
<span class="sd">        the training and test data, where N is the number of samples and D is the number of features.</span>
<span class="sd">     * `targets` [array-like, shape=[N]]:</span>
<span class="sd">        the truth values, where N is the number of samples.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">     * &#39;self&#39;</span>
<span class="sd">        Returns self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># in case we want to inject some data from outside the pipeline</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">targets</span>
    <span class="c1"># !!!!!!!!!!!!!!!! FIT ONLY IF DATA CHANGED !!!!!!!!!!!!!!!!!!!</span>
    <span class="c1"># -------------------------------------------------------------</span>
    <span class="c1"># in case we need to reduce the dimension of the data due to parallelity of the outer pipe, lets do it.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># if the groups are imbalanced, and a strategy is chosen, apply it here</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imbalanced_data_strategy_filter</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># be compatible to list of (image-) files</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="c1"># handle neuro Imge paths as data</span>
    <span class="c1"># ToDo: Need to check the DATA, not the img paths for neuro</span>
    <span class="n">new_data_hash</span> <span class="o">=</span> <span class="n">sha1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="c1"># fit</span>
    <span class="c1"># 1. if it is first time ever or</span>
    <span class="c1"># 2. the data did change for that fold or</span>
    <span class="c1"># 3. if it is the mother pipe (then number_of_folds = 0)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">]</span> <span class="o">!=</span> <span class="n">new_data_hash</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># save data hash for that fold</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_of_folds</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data_hash</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fold_data_hashes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data_hash</span>
        <span class="c1"># optimize: iterate through configs and save results</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span><span class="p">:</span>
            <span class="c1"># first check if correct optimizer metric has been chosen</span>
            <span class="c1"># pass pipeline_elements so that OptimizerMetric can look for last</span>
            <span class="c1"># element and use the corresponding score method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span> <span class="o">=</span> <span class="n">OptimizerMetric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">check_metrics</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;score&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Attention: Scoring with default score function of estimator can slow down calculations!&#39;</span><span class="p">)</span>
            <span class="c1"># generate OUTER ! cross validation splits to iterate over</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_outer_cv_indices</span><span class="p">()</span>
            <span class="n">outer_fold_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_mother_pipe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_outer_fold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mother_outer_fold_counter</span><span class="p">)</span>  \
                                        <span class="o">+</span> <span class="s1">&#39;_inner_fold_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mother_inner_fold_counter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="c1"># initialize result logging with hyperpipe class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span> <span class="o">=</span> <span class="n">MDBHyperpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">eval_final_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">best_config_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_config_metric</span>
            <span class="c1"># loop over outer cross validation</span>
            <span class="k">for</span> <span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_test_cases</span><span class="p">:</span>
                <span class="c1"># give the optimizer the chance to inform about elements</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">)</span>
                <span class="n">outer_fold_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">outer_fold_fit_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;HYPERPARAMETER SEARCH OF {0}, Outer Cross validation Fold {1}&#39;</span>
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outer_fold_counter</span><span class="p">))</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="c1"># Prepare Train and validation set data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">train_indices</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">train_indices</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">test_indices</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">test_indices</span><span class="p">]</span>
                <span class="c1"># Prepare inner cross validation</span>
                <span class="n">cv_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">))</span>
                <span class="n">num_folds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_iter</span><span class="p">)</span>
                <span class="n">num_samples_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>
                <span class="n">num_samples_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span><span class="p">)</span>
                <span class="c1"># distribute number of folds to encapsulated child hyperpipes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">num_of_folds</span><span class="o">=</span><span class="n">num_folds</span><span class="p">,</span>
                                                               <span class="n">outer_fold_counter</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>
                <span class="n">tested_config_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># add outer fold info object to result tree</span>
                <span class="n">outer_fold</span> <span class="o">=</span> <span class="n">MDBOuterFold</span><span class="p">(</span><span class="n">fold_nr</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>
                <span class="n">outer_fold</span><span class="o">.</span><span class="n">tested_config_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_fold</span><span class="p">)</span>
                <span class="c1"># do the optimizing</span>
                <span class="k">for</span> <span class="n">current_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">next_config</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">config_counter</span><span class="o">=</span><span class="n">tested_config_counter</span><span class="p">)</span>
                    <span class="n">hp</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">,</span> <span class="n">current_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_mother_inner_fold_nr</span><span class="p">,</span>
                                      <span class="n">mongo_db_settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="p">,</span>
                                      <span class="n">callback_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_cv_callback_function</span><span class="p">)</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;optimizing of:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">current_config</span><span class="p">))</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calculating...&#39;</span><span class="p">)</span>
                    <span class="c1"># Test the configuration cross validated by inner_cv object</span>
                    <span class="n">current_config_mdb</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">calculate_cv_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">,</span> <span class="n">cv_iter</span><span class="p">,</span>
                                                        <span class="n">calculate_metrics_per_fold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_per_fold</span><span class="p">,</span>
                                                        <span class="n">calculate_metrics_across_folds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_across_folds</span><span class="p">)</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_nr</span> <span class="o">=</span> <span class="n">tested_config_counter</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_dict</span> <span class="o">=</span> <span class="n">current_config</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">pipe_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">tested_config_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">human_readable_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_to_dict</span><span class="p">(</span><span class="n">current_config</span><span class="p">)</span>
                    <span class="c1"># save the configuration of all children pipelines</span>
                    <span class="n">children_config</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">children_config_ref_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">pipe_step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">pipe_step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">local_search</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">best_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="n">children_config</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">best_config</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">PipelineStacking</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">subhyperpipe_name</span><span class="p">,</span> <span class="n">hyperpipe</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hyperpipe</span><span class="p">,</span> <span class="n">Hyperpipe</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">local_search</span> <span class="ow">and</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">best_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                        <span class="c1"># special case: we need to access pipe over pipeline_stacking element</span>
                                        <span class="n">children_config</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">subhyperpipe_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperpipe</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span>
                                    <span class="c1"># children_config_ref_list.append(hyperpipe.best_config_outer_fold._id)</span>
                    <span class="n">specific_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
                    <span class="c1">#current_config_mdb.full_model_spec = specific_parameters</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">children_config_dict</span> <span class="o">=</span> <span class="n">children_config</span>
                    <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">children_config_ref</span> <span class="o">=</span> <span class="n">children_config_ref_list</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">current_config</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_failed</span><span class="p">:</span>
                        <span class="c1"># get optimizer_metric and forward to optimizer</span>
                        <span class="c1"># todo: also pass greater_is_better=True/False to optimizer</span>
                        <span class="n">metric_train</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">get_metric</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">,</span> <span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
                        <span class="n">metric_test</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">get_metric</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">,</span> <span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># if not metric_train or metric_test:</span>
                        <span class="c1">#     raise Exception(&quot;Config did not fail, but did not get any metrics either....!!?&quot;)</span>
                        <span class="n">config_performance</span> <span class="o">=</span> <span class="p">(</span><span class="n">metric_train</span><span class="p">,</span> <span class="n">metric_test</span><span class="p">)</span>
                        <span class="c1"># Print Result for config</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;...done:&#39;</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_performance</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                         <span class="n">config_performance</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                         <span class="c1"># Print Result for config</span>
                         <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;...failed:&#39;</span><span class="p">)</span>
                         <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="o">.</span><span class="n">config_error</span><span class="p">)</span>
                    <span class="c1"># add config to result tree and do intermediate saving</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tested_config_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_config_mdb</span><span class="p">)</span>
                    <span class="c1"># Todo: add try catch in case config cannot be written</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
                    <span class="c1"># 3. inform optimizer about performance</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">evaluate_recent_performance</span><span class="p">(</span><span class="n">current_config</span><span class="p">,</span> <span class="n">config_performance</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tested_config_counter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">best_config_outer_fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">get_optimum_config</span><span class="p">(</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">tested_config_list</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">best_config_outer_fold</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No best config was found!&quot;</span><span class="p">)</span>
                    <span class="n">best_config_outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBConfig</span><span class="p">()</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">children_config_dict</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">pipe_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_ref</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">children_config_ref</span>
                    <span class="c1"># best_config_outer_fold_mdb.best_config_ref_to_train_item = best_config_outer_fold._id</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">config_dict</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">human_readable_config</span> <span class="o">=</span> <span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">human_readable_config</span>
                    <span class="c1"># inform user</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;finished optimization of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Result&#39;</span><span class="p">)</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Number of tested configurations:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tested_config_counter</span><span class="p">))</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Optimizer metric: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">metric</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                                     <span class="s1">&#39;   --&gt; Greater is better: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">greater_is_better</span><span class="p">))</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Best config: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">+</span>
                                  <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;... with children config: &#39;</span>
                                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span><span class="p">))</span>
                    <span class="c1"># ... and create optimal pipeline</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
                    <span class="c1"># set self to best config</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>
                    <span class="c1"># set all children to best config and inform to NOT optimize again, ONLY fit</span>
                    <span class="k">for</span> <span class="n">child_name</span><span class="p">,</span> <span class="n">child_config</span> <span class="ow">in</span> <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">children_config_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">child_config</span><span class="p">:</span>
                            <span class="c1"># in case we have a pipeline stacking we need to identify the particular subhyperpipe</span>
                            <span class="n">splitted_name</span> <span class="o">=</span> <span class="n">child_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitted_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">stacking_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">splitted_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                <span class="n">pipe_element</span> <span class="o">=</span> <span class="n">stacking_element</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">[</span><span class="n">splitted_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">pipe_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="n">child_name</span><span class="p">]</span>
                            <span class="n">pipe_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">child_config</span><span class="p">)</span>
                            <span class="n">pipe_element</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now fitting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; with optimum configuration&#39;</span><span class="p">)</span>
                    <span class="n">fit_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>
                    <span class="n">final_fit_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">fit_time_start</span>
                    <span class="c1">#self.best_config_outer_fold.full_model_spec = self.optimum_pipe.get_params()</span>
                    <span class="n">best_config_outer_fold_mdb</span><span class="o">.</span><span class="n">fit_duration_minutes</span> <span class="o">=</span> <span class="n">final_fit_duration</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="n">best_config_outer_fold_mdb</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_final_performance</span><span class="p">:</span>
                        <span class="c1"># Todo: generate mean and std over outer folds as well. move this items to the top</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now predicting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; unseen data&#39;</span><span class="p">)</span>
                        <span class="n">test_score_mdb</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_y</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                                                            <span class="n">save_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_predictions</span><span class="p">,</span>
                                                            <span class="n">save_feature_importances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_feature_importances</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;.. calculating metrics for test set (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;...now predicting &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; final model with training data&#39;</span><span class="p">)</span>
                        <span class="n">train_score_mdb</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                                                             <span class="n">save_predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_predictions</span><span class="p">,</span>
                                                             <span class="n">save_feature_importances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persist_options</span><span class="o">.</span><span class="n">save_feature_importances</span><span class="p">)</span>
                        <span class="c1"># save test fold</span>
                        <span class="n">outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBInnerFold</span><span class="p">()</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">fold_nr</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_training</span> <span class="o">=</span> <span class="n">num_samples_train</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_validation</span> <span class="o">=</span> <span class="n">num_samples_test</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="n">train_score_mdb</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">test_score_mdb</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_fold_mdb</span><span class="p">]</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PERFORMANCE TRAIN:&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">m_key</span><span class="p">,</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">train_score_mdb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_value</span><span class="p">))</span>
                        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PERFORMANCE TEST:&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">m_key</span><span class="p">,</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">test_score_mdb</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m_value</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># save test fold</span>
                        <span class="n">outer_fold_mdb</span> <span class="o">=</span> <span class="n">MDBInnerFold</span><span class="p">()</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">fold_nr</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_training</span> <span class="o">=</span> <span class="n">num_samples_train</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">number_samples_validation</span> <span class="o">=</span> <span class="n">num_samples_test</span>
                        <span class="k">def</span> <span class="nf">_copy_inner_fold_means</span><span class="p">(</span><span class="n">metric_dict</span><span class="p">):</span>
                            <span class="c1"># We copy all mean values from validation to the best config</span>
                            <span class="c1"># training</span>
                            <span class="n">train_item_metrics</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metric_dict</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">FoldOperations</span><span class="o">.</span><span class="n">MEAN</span><span class="p">):</span>
                                    <span class="n">train_item_metrics</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">value</span>
                            <span class="n">train_item</span> <span class="o">=</span> <span class="n">MDBScoreInformation</span><span class="p">()</span>
                            <span class="n">train_item</span><span class="o">.</span><span class="n">metrics_copied_from_inner</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">train_item</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">train_item_metrics</span>
                            <span class="k">return</span> <span class="n">train_item</span>
                        <span class="c1"># training</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="n">_copy_inner_fold_means</span><span class="p">(</span><span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">)</span>
                        <span class="c1"># validation</span>
                        <span class="n">outer_fold_mdb</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">_copy_inner_fold_means</span><span class="p">(</span><span class="n">best_config_outer_fold</span><span class="o">.</span><span class="n">metrics_test</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_fold_mdb</span><span class="p">]</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;This took {} minutes.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">time_of_results</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">reset_final_fit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outer_fold_counter</span><span class="o">=</span><span class="n">outer_fold_counter</span><span class="p">)</span>
            <span class="c1"># Compute all final metrics</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">metrics_test</span> <span class="o">=</span> <span class="n">MDBHelper</span><span class="o">.</span><span class="n">aggregate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">,</span>
                                                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
            <span class="c1"># save result tree to db or file or both</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saved result tree to database&quot;</span><span class="p">)</span>
            <span class="c1"># Find best config across outer folds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_optimizer</span><span class="o">.</span><span class="n">get_optimum_config_outer_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;OVERALL BEST CONFIGURATION&#39;</span><span class="p">)</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;--------------------------&#39;</span><span class="p">)</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">+</span>
                          <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;... with children config: &#39;</span>
                          <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_printing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">children_config_dict</span><span class="p">))</span>
            <span class="c1"># set self to best config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_y</span><span class="p">)</span>
            <span class="c1"># save results again</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_tree</span><span class="p">)</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saved overall best config to database&quot;</span><span class="p">)</span>
        <span class="c1">###############################################################################################</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Avoided fitting of &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; on fold &quot;</span>
                         <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_fold</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; because data did not change&quot;</span><span class="p">)</span>
        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s1">&#39;Best config of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Retrieve parameters from sklearn pipeline</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve parameters from sklearn pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.inverse_transform_pipeline">
    <p>def <span class="ident">inverse_transform_pipeline</span>(</p><p>self, hyperparameters, data, targets, data_to_inverse)</p>
    </div>
    

    
  
    <div class="desc"><p>Inverse transform data for a pipeline with specific hyperparameter configuration</p>
<ol>
<li>Copy Sklearn Pipeline,</li>
<li>Set Parameters</li>
<li>Fit Pipeline to data and targets</li>
<li>Inverse transform data with that pipeline</li>
</ol>
<h2>Parameters</h2>
<ul>
<li>'hyperparameters' [dict]:
    The concrete configuration settings for the pipeline elements</li>
<li>'data' [array-like]:
    The training data to which the pipeline is fitted</li>
<li>'targets' [array-like]:
    The truth values for training</li>
<li>'data_to_inverse' [array-like]:
    The data that should be inversed after training</li>
</ul>
<h2>Returns</h2>
<p>Inversed data as array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.inverse_transform_pipeline', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.inverse_transform_pipeline" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_transform_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_to_inverse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse transform data for a pipeline with specific hyperparameter configuration</span>
<span class="sd">    1. Copy Sklearn Pipeline,</span>
<span class="sd">    2. Set Parameters</span>
<span class="sd">    3. Fit Pipeline to data and targets</span>
<span class="sd">    4. Inverse transform data with that pipeline</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;hyperparameters&#39; [dict]:</span>
<span class="sd">        The concrete configuration settings for the pipeline elements</span>
<span class="sd">    * &#39;data&#39; [array-like]:</span>
<span class="sd">        The training data to which the pipeline is fitted</span>
<span class="sd">    * &#39;targets&#39; [array-like]:</span>
<span class="sd">        The truth values for training</span>
<span class="sd">    * &#39;data_to_inverse&#39; [array-like]:</span>
<span class="sd">        The data that should be inversed after training</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Inversed data as array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">copied_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_pipeline</span><span class="p">()</span>
    <span class="n">copied_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">hyperparameters</span><span class="p">)</span>
    <span class="n">copied_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copied_pipe</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data_to_inverse</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.load_optimum_pipe">
    <p>def <span class="ident">load_optimum_pipe</span>(</p><p>file)</p>
    </div>
    

    
  
    <div class="desc"><p>Load optimal pipeline.</p>
<h2>Parameters</h2>
<ul>
<li>'file' [str]:
    File path specifying .photon file to load optimal pipeline from</li>
</ul>
<h2>Returns</h2>
<p>sklearn Pipeline with all trained photon_pipelines</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.load_optimum_pipe', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.load_optimum_pipe" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">load_optimum_pipe</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load optimal pipeline.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;file&#39; [str]:</span>
<span class="sd">        File path specifying .photon file to load optimal pipeline from</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sklearn Pipeline with all trained photon_pipelines</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.photon&#39;</span><span class="p">):</span>
        <span class="n">archive_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">archive_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileNotFoundError</span><span class="p">(</span><span class="s1">&#39;Specify .photon file that holds PHOTON optimum pipe.&#39;</span><span class="p">)</span>
    <span class="n">setup_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_blueprint.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
    <span class="n">element_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">element_info</span> <span class="ow">in</span> <span class="n">setup_info</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span>
                                                          <span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;wrapper_script&#39;</span><span class="p">])</span>
            <span class="n">imported_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">imported_module</span><span class="p">)</span>
            <span class="n">base_element</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">])</span>
            <span class="n">custom_element</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">(),</span>
                                             <span class="n">hyperparameters</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;hyperparameters&#39;</span><span class="p">],</span>
                                             <span class="n">test_disabled</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;test_disabled&#39;</span><span class="p">],</span>
                                             <span class="n">disabled</span><span class="o">=</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">])</span>
            <span class="n">custom_element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
            <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">custom_element</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">element_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;element_name&#39;</span><span class="p">],</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">element_info</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.predict">
    <p>def <span class="ident">predict</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the optimum pipe to predict the data</p>
<h2>Returns</h2>
<div class="codehilite"><pre><span></span>predicted targets
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.predict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the optimum pipe to predict the data</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        predicted targets</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Todo: if local_search = true then use optimized pipe here?</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.predict_proba">
    <p>def <span class="ident">predict_proba</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Predict probabilities</p>
<h2>Returns</h2>
<p>predicted probabilities</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.predict_proba', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.predict_proba" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict probabilities</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    predicted probabilities</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.prettify_config_output">
    <p>def <span class="ident">prettify_config_output</span>(</p><p>config_name, config_value)</p>
    </div>
    

    
  
    <div class="desc"><p>Print the disabled = False as Enabled = True for better human reading</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.prettify_config_output', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.prettify_config_output" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the disabled = False as Enabled = True for better human reading</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.save_optimum_pipe">
    <p>def <span class="ident">save_optimum_pipe</span>(</p><p>self, file)</p>
    </div>
    

    
  
    <div class="desc"><p>Save optimal pipeline only. Complete hyperpipe will no not be saved.</p>
<h2>Parameters</h2>
<ul>
<li>'file' [str]:
    File path as string specifying file to save pipeline to</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.save_optimum_pipe', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.save_optimum_pipe" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_optimum_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save optimal pipeline only. Complete hyperpipe will no not be saved.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;file&#39; [str]:</span>
<span class="sd">        File path as string specifying file to save pipeline to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">element_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">element_identifier</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.photon&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">FileExistsError</span><span class="p">(</span><span class="s1">&#39;Trying to save optimum pipe: The file you specified already exists as a folder.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
    <span class="n">wrapper_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;_optimum_pipe_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element_number</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">element_name</span>
        <span class="n">element_identifier</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;element_name&#39;</span><span class="p">:</span> <span class="n">element_name</span><span class="p">,</span>
                                   <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;save&#39;</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
            <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;wrapper_script&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
            <span class="n">wrapper_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
            <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;test_disabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">test_disabled</span>
            <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">disabled</span>
            <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;hyperparameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">hyperparameters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">element_identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Custom pipeline element must implement .save() method or &quot;</span>
                                          <span class="s2">&quot;allow pickle.&quot;</span><span class="p">)</span>
        <span class="n">element_number</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># save pipeline blueprint to make loading of pipeline easier</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_blueprint.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">element_identifier</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="c1"># get all files</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;_optimum_pipe_*&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myzip</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">myzip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">wrapper_files</span><span class="p">:</span>
            <span class="n">myzip</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">removedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **params)</p>
    </div>
    

    
  
    <div class="desc"><p>Give parameter values to the pipeline elements</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Give parameter values to the pipeline elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.transform">
    <p>def <span class="ident">transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the optimum pipe to transform the data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the optimum pipe to transform the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.Hyperpipe.update_mother_inner_fold_nr">
    <p>def <span class="ident">update_mother_inner_fold_nr</span>(</p><p>self, new_inner_fold_nr)</p>
    </div>
    

    
  
    <div class="desc"><p>Function handle so that the TestPipeline class from Photon's validation module can pass the information to hyperpipe children</p>
<h2>Parameters</h2>
<ul>
<li>'new_inner_fold_nr' [int]:
    in which inner_fold the mother hyperpipe currently is</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.Hyperpipe.update_mother_inner_fold_nr', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.Hyperpipe.update_mother_inner_fold_nr" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_mother_inner_fold_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_inner_fold_nr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function handle so that the TestPipeline class from Photon&#39;s validation module can pass the information to hyperpipe children</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;new_inner_fold_nr&#39; [int]:</span>
<span class="sd">        in which inner_fold the mother hyperpipe currently is</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_cv_info_to_hyperpipe_children</span><span class="p">(</span><span class="n">inner_fold_counter</span><span class="o">=</span><span class="n">new_inner_fold_nr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.Hyperpipe.X" class="name">var <span class="ident">X</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.best_children_config" class="name">var <span class="ident">best_children_config</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.best_config" class="name">var <span class="ident">best_config</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.best_config_metric" class="name">var <span class="ident">best_config_metric</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.best_performance" class="name">var <span class="ident">best_performance</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.calculate_metrics_across_folds" class="name">var <span class="ident">calculate_metrics_across_folds</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.calculate_metrics_per_fold" class="name">var <span class="ident">calculate_metrics_per_fold</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.config_optimizer" class="name">var <span class="ident">config_optimizer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.cv_iter" class="name">var <span class="ident">cv_iter</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.data_test_cases" class="name">var <span class="ident">data_test_cases</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.eval_final_performance" class="name">var <span class="ident">eval_final_performance</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.filter_element" class="name">var <span class="ident">filter_element</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.fit_duration" class="name">var <span class="ident">fit_duration</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.groups" class="name">var <span class="ident">groups</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.inner_cv" class="name">var <span class="ident">inner_cv</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.inner_cv_callback_function" class="name">var <span class="ident">inner_cv_callback_function</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.is_final_fit" class="name">var <span class="ident">is_final_fit</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.metrics" class="name">var <span class="ident">metrics</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.mongodb_writer" class="name">var <span class="ident">mongodb_writer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.optimum_pipe" class="name">var <span class="ident">optimum_pipe</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.outer_cv" class="name">var <span class="ident">outer_cv</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.pipeline_elements" class="name">var <span class="ident">pipeline_elements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.result_tree" class="name">var <span class="ident">result_tree</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.test_size" class="name">var <span class="ident">test_size</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.Hyperpipe.y" class="name">var <span class="ident">y</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.ImbalancedDataTransform" class="name">class <span class="ident">ImbalancedDataTransform</span></p>
      
  
    <div class="desc"><p>Applies the chosen strategy to the data in order to handle the imbalance in the data.
Instantiates the strategy filter object according to the name given as string.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ImbalancedDataTransform</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the chosen strategy to the data in order to handle the imbalance in the data.</span>
<span class="sd">    Instantiates the strategy filter object according to the name given as string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_estimator_type</span> <span class="o">=</span> <span class="s2">&quot;transformer&quot;</span>

    <span class="n">IMBALANCED_DICT</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;oversampling&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;RandomOverSampler&quot;</span><span class="p">,</span> <span class="s2">&quot;SMOTE&quot;</span><span class="p">,</span> <span class="s2">&quot;ADASYN&quot;</span><span class="p">],</span>
        <span class="s1">&#39;undersampling&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ClusterCentroids&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;RandomUnderSampler&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;NearMiss&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;InstanceHardnessThreshold&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;CondensedNearestNeighbour&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;EditedNearestNeighbours&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;RepeatedEditedNearestNeighbours&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;AllKNN&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;NeighbourhoodCleaningRule&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;OneSidedSelection&quot;</span><span class="p">],</span>
        <span class="s1">&#39;combine&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMOTEENN&quot;</span><span class="p">,</span> <span class="s2">&quot;SMOTETomek&quot;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates an object that transforms the data into balanced groups according to the given method</span>

<span class="sd">        Possible values for method_name:</span>
<span class="sd">        imbalance_type = OVERSAMPLING:</span>
<span class="sd">            - RandomOverSampler</span>
<span class="sd">            - SMOTE</span>
<span class="sd">            - ADASYN</span>

<span class="sd">        imbalance_type = UNDERSAMPLING:</span>
<span class="sd">            - ClusterCentroids,</span>
<span class="sd">            - RandomUnderSampler,</span>
<span class="sd">            - NearMiss,</span>
<span class="sd">            - InstanceHardnessThreshold,</span>
<span class="sd">            - CondensedNearestNeighbour,</span>
<span class="sd">            - EditedNearestNeighbours,</span>
<span class="sd">            - RepeatedEditedNearestNeighbours,</span>
<span class="sd">            - AllKNN,</span>
<span class="sd">            - NeighbourhoodCleaningRule,</span>
<span class="sd">            - OneSidedSelection</span>

<span class="sd">        imbalance_type = COMBINE:</span>
<span class="sd">            - SMOTEENN,</span>
<span class="sd">            - SMOTETomek</span>

<span class="sd">        :param method_name: which imbalanced strategy to use</span>
<span class="sd">        :type method_name: str</span>
<span class="sd">        :param kwargs: any parameters to pass to the imbalance strategy object</span>
<span class="sd">        :type kwargs:  dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>

        <span class="n">imbalance_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">possible_strategies</span> <span class="ow">in</span> <span class="n">ImbalancedDataTransform</span><span class="o">.</span><span class="n">IMBALANCED_DICT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">possible_strategies</span><span class="p">:</span>
                <span class="n">imbalance_type</span> <span class="o">=</span> <span class="n">group</span>

        <span class="k">if</span> <span class="n">imbalance_type</span> <span class="o">==</span> <span class="s2">&quot;oversampling&quot;</span><span class="p">:</span>
            <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;over_sampling&quot;</span>
        <span class="k">elif</span> <span class="n">imbalance_type</span> <span class="o">==</span> <span class="s2">&quot;undersampling&quot;</span><span class="p">:</span>
            <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;under_sampling&quot;</span>
        <span class="k">elif</span> <span class="n">imbalance_type</span> <span class="o">==</span><span class="s2">&quot;combine&quot;</span> <span class="ow">or</span> <span class="n">imbalance_type</span> <span class="o">==</span><span class="s2">&quot;combination&quot;</span><span class="p">:</span>
            <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;combine&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Imbalance Type not found. Can be oversampling, undersampling or combine&quot;</span><span class="p">)</span>

        <span class="c1"># Todo: Try Catch Class Not Found Exception</span>

        <span class="n">desired_class_home</span> <span class="o">=</span> <span class="s2">&quot;imblearn.&quot;</span> <span class="o">+</span> <span class="n">home</span>
        <span class="n">desired_class_name</span> <span class="o">=</span> <span class="n">method_name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">imported_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">desired_class_home</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">desired_class_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">desired_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">desired_class_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Imbalance Type not found. Can be oversampling, undersampling or combine&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">desired_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">fit_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="c1"># ATTENTION: Works only if fit is called before transform!!!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">fit_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.ImbalancedDataTransform">ImbalancedDataTransform</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>sklearn.base.TransformerMixin</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.ImbalancedDataTransform.IMBALANCED_DICT" class="name">var <span class="ident">IMBALANCED_DICT</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.ImbalancedDataTransform.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, method_name, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Instantiates an object that transforms the data into balanced groups according to the given method</p>
<p>Possible values for method_name:
imbalance_type = OVERSAMPLING:
    - RandomOverSampler
    - SMOTE
    - ADASYN</p>
<p>imbalance_type = UNDERSAMPLING:
    - ClusterCentroids,
    - RandomUnderSampler,
    - NearMiss,
    - InstanceHardnessThreshold,
    - CondensedNearestNeighbour,
    - EditedNearestNeighbours,
    - RepeatedEditedNearestNeighbours,
    - AllKNN,
    - NeighbourhoodCleaningRule,
    - OneSidedSelection</p>
<p>imbalance_type = COMBINE:
    - SMOTEENN,
    - SMOTETomek</p>
<p>:param method_name: which imbalanced strategy to use
:type method_name: str
:param kwargs: any parameters to pass to the imbalance strategy object
:type kwargs:  dict</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates an object that transforms the data into balanced groups according to the given method</span>
<span class="sd">    Possible values for method_name:</span>
<span class="sd">    imbalance_type = OVERSAMPLING:</span>
<span class="sd">        - RandomOverSampler</span>
<span class="sd">        - SMOTE</span>
<span class="sd">        - ADASYN</span>
<span class="sd">    imbalance_type = UNDERSAMPLING:</span>
<span class="sd">        - ClusterCentroids,</span>
<span class="sd">        - RandomUnderSampler,</span>
<span class="sd">        - NearMiss,</span>
<span class="sd">        - InstanceHardnessThreshold,</span>
<span class="sd">        - CondensedNearestNeighbour,</span>
<span class="sd">        - EditedNearestNeighbours,</span>
<span class="sd">        - RepeatedEditedNearestNeighbours,</span>
<span class="sd">        - AllKNN,</span>
<span class="sd">        - NeighbourhoodCleaningRule,</span>
<span class="sd">        - OneSidedSelection</span>
<span class="sd">    imbalance_type = COMBINE:</span>
<span class="sd">        - SMOTEENN,</span>
<span class="sd">        - SMOTETomek</span>
<span class="sd">    :param method_name: which imbalanced strategy to use</span>
<span class="sd">    :type method_name: str</span>
<span class="sd">    :param kwargs: any parameters to pass to the imbalance strategy object</span>
<span class="sd">    :type kwargs:  dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>
    <span class="n">imbalance_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">possible_strategies</span> <span class="ow">in</span> <span class="n">ImbalancedDataTransform</span><span class="o">.</span><span class="n">IMBALANCED_DICT</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">possible_strategies</span><span class="p">:</span>
            <span class="n">imbalance_type</span> <span class="o">=</span> <span class="n">group</span>
    <span class="k">if</span> <span class="n">imbalance_type</span> <span class="o">==</span> <span class="s2">&quot;oversampling&quot;</span><span class="p">:</span>
        <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;over_sampling&quot;</span>
    <span class="k">elif</span> <span class="n">imbalance_type</span> <span class="o">==</span> <span class="s2">&quot;undersampling&quot;</span><span class="p">:</span>
        <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;under_sampling&quot;</span>
    <span class="k">elif</span> <span class="n">imbalance_type</span> <span class="o">==</span><span class="s2">&quot;combine&quot;</span> <span class="ow">or</span> <span class="n">imbalance_type</span> <span class="o">==</span><span class="s2">&quot;combination&quot;</span><span class="p">:</span>
        <span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;combine&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Imbalance Type not found. Can be oversampling, undersampling or combine&quot;</span><span class="p">)</span>
    <span class="c1"># Todo: Try Catch Class Not Found Exception</span>
    <span class="n">desired_class_home</span> <span class="o">=</span> <span class="s2">&quot;imblearn.&quot;</span> <span class="o">+</span> <span class="n">home</span>
    <span class="n">desired_class_name</span> <span class="o">=</span> <span class="n">method_name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">imported_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">desired_class_home</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">desired_class_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">desired_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">desired_class_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Imbalance Type not found. Can be oversampling, undersampling or combine&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">desired_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.ImbalancedDataTransform.fit_sample">
    <p>def <span class="ident">fit_sample</span>(</p><p>self, X, y)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform.fit_sample', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform.fit_sample" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># ATTENTION: Works only if fit is called before transform!!!</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">fit_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_transformed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_transformed</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.ImbalancedDataTransform.fit_transform">
    <p>def <span class="ident">fit_transform</span>(</p><p>self, X, y=None, **fit_params)</p>
    </div>
    

    
  
    <div class="desc"><p>Fit to data, then transform it.</p>
<p>Fits transformer to X and y with optional parameters fit_params
and returns a transformed version of X.</p>
<h2>Parameters</h2>
<p>X : numpy array of shape [n_samples, n_features]
    Training set.</p>
<p>y : numpy array of shape [n_samples]
    Target values.</p>
<h2>Returns</h2>
<p>X_new : numpy array of shape [n_samples, n_features_new]
    Transformed array.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform.fit_transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform.fit_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fit to data, then transform it.</span>
<span class="sd">    Fits transformer to X and y with optional parameters fit_params</span>
<span class="sd">    and returns a transformed version of X.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : numpy array of shape [n_samples, n_features]</span>
<span class="sd">        Training set.</span>
<span class="sd">    y : numpy array of shape [n_samples]</span>
<span class="sd">        Target values.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X_new : numpy array of shape [n_samples, n_features_new]</span>
<span class="sd">        Transformed array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># non-optimized default implementation; override when a better</span>
    <span class="c1"># method is possible for a given clustering algorithm</span>
    <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># fit method of arity 1 (unsupervised transformation)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># fit method of arity 2 (supervised transformation)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.ImbalancedDataTransform.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get parameters for this estimator.</p>
<h2>Parameters</h2>
<p>deep : boolean, optional
    If True, will return the parameters for this estimator and
    contained subobjects that are estimators.</p>
<h2>Returns</h2>
<p>params : mapping of string to any
    Parameter names mapped to their values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get parameters for this estimator.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    deep : boolean, optional</span>
<span class="sd">        If True, will return the parameters for this estimator and</span>
<span class="sd">        contained subobjects that are estimators.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : mapping of string to any</span>
<span class="sd">        Parameter names mapped to their values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_names</span><span class="p">():</span>
        <span class="c1"># We need deprecation warnings to always be on in order to</span>
        <span class="c1"># catch deprecated param values.</span>
        <span class="c1"># This is set in utils/__init__.py but it gets overwritten</span>
        <span class="c1"># when running under python3 somehow.</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="ne">DeprecationWarning</span><span class="p">:</span>
                <span class="c1"># if the parameter is deprecated, don&#39;t show it</span>
                <span class="k">continue</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># XXX: should we rather test if instance of estimator?</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;get_params&#39;</span><span class="p">):</span>
            <span class="n">deep_items</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">deep_items</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.ImbalancedDataTransform.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **params)</p>
    </div>
    

    
  
    <div class="desc"><p>Set the parameters of this estimator.</p>
<p>The method works on simple estimators as well as on nested objects
(such as pipelines). The latter have parameters of the form
<code>&lt;component&gt;__&lt;parameter&gt;</code> so that it's possible to update each
component of a nested object.</p>
<h2>Returns</h2>
<p>self</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.ImbalancedDataTransform.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.ImbalancedDataTransform.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the parameters of this estimator.</span>
<span class="sd">    The method works on simple estimators as well as on nested objects</span>
<span class="sd">    (such as pipelines). The latter have parameters of the form</span>
<span class="sd">    ``&lt;component&gt;__&lt;parameter&gt;`` so that it&#39;s possible to update each</span>
<span class="sd">    component of a nested object.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
        <span class="c1"># Simple optimization to gain speed (inspect is slow)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="n">valid_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># nested objects case</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">sub_name</span> <span class="o">=</span> <span class="n">split</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter </span><span class="si">%s</span><span class="s1"> for estimator </span><span class="si">%s</span><span class="s1">. &#39;</span>
                                 <span class="s1">&#39;Check the list of available parameters &#39;</span>
                                 <span class="s1">&#39;with `estimator.get_params().keys()`.&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
            <span class="n">sub_object</span> <span class="o">=</span> <span class="n">valid_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">sub_object</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">sub_name</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># simple objects case</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid parameter </span><span class="si">%s</span><span class="s1"> for estimator </span><span class="si">%s</span><span class="s1">. &#39;</span>
                                 <span class="s1">&#39;Check the list of available parameters &#39;</span>
                                 <span class="s1">&#39;with `estimator.get_params().keys()`.&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.ImbalancedDataTransform.method" class="name">var <span class="ident">method</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.ImbalancedDataTransform.method_name" class="name">var <span class="ident">method_name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.ImbalancedDataTransform.x_transformed" class="name">var <span class="ident">x_transformed</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.ImbalancedDataTransform.y_transformed" class="name">var <span class="ident">y_transformed</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.PersistOptions" class="name">class <span class="ident">OutputSettings</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PersistOptions', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PersistOptions" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">OutputSettings</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongodb_connect_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">save_predictions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">save_feature_importances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="n">local_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">log_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_connect_url</span> <span class="o">=</span> <span class="n">mongodb_connect_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_predictions</span> <span class="o">=</span> <span class="n">save_predictions</span>
        <span class="c1"># coef_ or feature_importances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_feature_importances</span> <span class="o">=</span> <span class="n">save_feature_importances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_file</span> <span class="o">=</span> <span class="n">local_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="n">log_filename</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.PersistOptions">OutputSettings</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PersistOptions.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, mongodb_connect_url=None, save_predictions=False, save_feature_importances=False, local_file=&#39;&#39;, log_filename=&#39;&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PersistOptions.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PersistOptions.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongodb_connect_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
             <span class="n">save_predictions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
             <span class="n">save_feature_importances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
             <span class="n">local_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">log_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mongodb_connect_url</span> <span class="o">=</span> <span class="n">mongodb_connect_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_predictions</span> <span class="o">=</span> <span class="n">save_predictions</span>
    <span class="c1"># coef_ or feature_importances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_feature_importances</span> <span class="o">=</span> <span class="n">save_feature_importances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_file</span> <span class="o">=</span> <span class="n">local_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="n">log_filename</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.PersistOptions.local_file" class="name">var <span class="ident">local_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PersistOptions.log_file" class="name">var <span class="ident">log_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PersistOptions.mongodb_connect_url" class="name">var <span class="ident">mongodb_connect_url</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PersistOptions.save_feature_importances" class="name">var <span class="ident">save_feature_importances</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PersistOptions.save_predictions" class="name">var <span class="ident">save_predictions</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.PipelineBranch" class="name">class <span class="ident">PipelineBranch</span></p>
      
  
    <div class="desc"><p>A substream of pipeline elements that is encapsulated e.g. for parallelization</p>
<h2>Parameters</h2>
<ul>
<li>'name' [str]:
       Name of the encapsulated item and/or summary of the encapsulated element's functions</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PipelineBranch</span><span class="p">(</span><span class="n">PipelineElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     A substream of pipeline elements that is encapsulated e.g. for parallelization</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">        * &#39;name&#39; [str]:</span>
<span class="sd">            Name of the encapsulated item and/or summary of the encapsulated element&#39;s functions</span>

<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an element to the sub pipeline</span>
<span class="sd">        Returns self</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;pipe_element&#39; [PipelineElement or Hyperpipe]:</span>
<span class="sd">            The object to add, being either a transformer or an estimator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_pipeline</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates sklearn pipeline with all underlying steps &quot;&quot;&quot;</span>
        <span class="n">pipeline_steps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="c1"># pipeline_steps.append((item.name, item.base_element))</span>
            <span class="n">pipeline_steps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">hyperparameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_sklearn_hyperparameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_steps</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span>

    <span class="nd">@hyperparameters.setter</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting hyperparameters does not make sense, only the items that added can be optimized, not the container (self)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">create_global_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.PipelineBranch">PipelineBranch</a></li>
          <li><a href="#photonai.base.PipelineElement">PipelineElement</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineBranch.ELEMENT_DICTIONARY" class="name">var <span class="ident">ELEMENT_DICTIONARY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes a string literal and transforms it into an object of the associated class (see PhotonCore.JSON)</p>
<h2>Returns</h2>
<p>instantiated class object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.add">
    <p>def <span class="ident">add</span>(</p><p>self, pipe_element)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.add', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.add" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.copy_me">
    <p>def <span class="ident">copy_me</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.copy_me', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.copy_me" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, data, targets=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the fit function of the base element</p>
<h2>Returns</h2>
<p>self</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.fit', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the fit function of the base element</span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># self.base_element.fit(data, targets)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.generate_config_grid">
    <p>def <span class="ident">generate_config_grid</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.generate_config_grid', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.generate_config_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">create_global_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.generate_sklearn_hyperparameters">
    <p>def <span class="ident">generate_sklearn_hyperparameters</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.generate_sklearn_hyperparameters', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.generate_sklearn_hyperparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_elements</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the get_params request to the wrapped base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forwards the get_params request to the wrapped base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.inverse_transform">
    <p>def <span class="ident">inverse_transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls inverse_transform on the base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.inverse_transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.inverse_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls inverse_transform on the base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;inverse_transform&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># raise Warning(&#39;Element &#39; + self.name + &#39; has no method inverse_transform&#39;)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.predict">
    <p>def <span class="ident">predict</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls predict function on the base element.</p>
<p>IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.
This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.
Sklearn usually expects the last element to predict.
Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after
training only used for transforming.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.predict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls predict function on the base element.</span>
<span class="sd">    IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.</span>
<span class="sd">    This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.</span>
<span class="sd">    Sklearn usually expects the last element to predict.</span>
<span class="sd">    Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after</span>
<span class="sd">    training only used for transforming.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have function &#39;</span> <span class="o">+</span>
                           <span class="s1">&#39;predict, or at least transform.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have function predict, or at least transform.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.predict_proba">
    <p>def <span class="ident">predict_proba</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Predict probabilities
base element needs predict_proba() function, otherwise throw
base exception.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.predict_proba', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.predict_proba" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict probabilities</span>
<span class="sd">    base element needs predict_proba() function, otherwise throw</span>
<span class="sd">    base exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have &quot;predict_proba&quot; function.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have predict_proba function.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.prettify_config_output">
    <p>def <span class="ident">prettify_config_output</span>(</p><p>self, config_name, config_value, return_dict=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Make hyperparameter combinations human readable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.prettify_config_output', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.prettify_config_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make hyperparameter combinations human readable &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">config_name</span><span class="p">:</span><span class="n">config_value</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.score">
    <p>def <span class="ident">score</span>(</p><p>self, X_test, y_test)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the score function on the base element:
Returns a goodness of fit measure or a likelihood of unseen data:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.score', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.score" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the score function on the base element:</span>
<span class="sd">    Returns a goodness of fit measure or a likelihood of unseen data:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the set_params request to the wrapped base element
Takes care of the disabled parameter which is additionally attached by the PHOTON wrapper</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forwards the set_params request to the wrapped base element</span>
<span class="sd">    Takes care of the disabled parameter which is additionally attached by the PHOTON wrapper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># element disable is a construct used for this container only</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;disabled&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.transform">
    <p>def <span class="ident">transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls transform on the base element.</p>
<p>IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.
This is used if we are using an estimator as a preprocessing step.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls transform on the base element.</span>
<span class="sd">    IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.</span>
<span class="sd">    This is used if we are using an estimator as a preprocessing step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException: transform-predict-mess&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;transform-predict-mess&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineBranch.hyperparameters" class="name">var <span class="ident">hyperparameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineBranch.pipeline_elements" class="name">var <span class="ident">pipeline_elements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineBranch.create">
    <p>def <span class="ident">create</span>(</p><p>cls, name, base_element, hyperparameters, test_disabled=False, disabled=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes an instantiated object and encapsulates it into the PHOTON structure,
add the disabled function and attaches information about the hyperparameters that should be tested</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineBranch.create', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineBranch.create" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_element</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an instantiated object and encapsulates it into the PHOTON structure,</span>
<span class="sd">    add the disabled function and attaches information about the hyperparameters that should be tested</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.PipelineElement" class="name">class <span class="ident">PipelineElement</span></p>
      
  
    <div class="desc"><p>Photon wrapper class for any transformer or predictor element in the pipeline.</p>
<ol>
<li>Saves the hyperparameters that are to be tested and creates a grid of all hyperparameter configurations</li>
<li>Enables fast and rapid instantiation of pipeline elements per string identifier,
     e.g 'svc' creates an sklearn.svm.SVC object.</li>
<li>Attaches a "disable" switch to every element in the pipeline in order to test a complete disable</li>
</ol>
<h2>Parameters</h2>
<ul>
<li>'name' [str]:
   A string literal encoding the class to be instantiated</li>
<li>'hyperparameters' [dict]:
   Which values/value range should be tested for the hyperparameter.
   In form of "Hyperparameter_name: [array of parameter values to be tested]"</li>
<li>'test_disabled' [bool]:
    If the hyperparameter search should evaluate a complete disabling of the element</li>
<li>'disabled' [bool]:
    If true, the element is currently disabled and does nothing except return the data it received</li>
<li>'kwargs' [dict]:
    Any parameters that should be passed to the object to be instantiated, default parameters</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PipelineElement</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Photon wrapper class for any transformer or predictor element in the pipeline.</span>

<span class="sd">    1. Saves the hyperparameters that are to be tested and creates a grid of all hyperparameter configurations</span>
<span class="sd">    2. Enables fast and rapid instantiation of pipeline elements per string identifier,</span>
<span class="sd">         e.g &#39;svc&#39; creates an sklearn.svm.SVC object.</span>
<span class="sd">    3. Attaches a &quot;disable&quot; switch to every element in the pipeline in order to test a complete disable</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;name&#39; [str]:</span>
<span class="sd">       A string literal encoding the class to be instantiated</span>
<span class="sd">    * &#39;hyperparameters&#39; [dict]:</span>
<span class="sd">       Which values/value range should be tested for the hyperparameter.</span>
<span class="sd">       In form of &quot;Hyperparameter_name: [array of parameter values to be tested]&quot;</span>
<span class="sd">    * &#39;test_disabled&#39; [bool]:</span>
<span class="sd">        If the hyperparameter search should evaluate a complete disabling of the element</span>
<span class="sd">    * &#39;disabled&#39; [bool]:</span>
<span class="sd">        If true, the element is currently disabled and does nothing except return the data it received</span>
<span class="sd">    * &#39;kwargs&#39; [dict]:</span>
<span class="sd">        Any parameters that should be passed to the object to be instantiated, default parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Registering Pipeline Elements</span>
    <span class="n">ELEMENT_DICTIONARY</span> <span class="o">=</span> <span class="n">PhotonRegister</span><span class="o">.</span><span class="n">get_package_info</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a string literal and transforms it into an object of the associated class (see PhotonCore.JSON)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        instantiated class object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hyperparameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_element</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">desired_class_info</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">desired_class_home</span> <span class="o">=</span> <span class="n">desired_class_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">desired_class_name</span> <span class="o">=</span> <span class="n">desired_class_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">imported_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">desired_class_home</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">desired_class_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">desired_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">desired_class_name</span><span class="p">)</span>
                    <span class="n">base_element</span> <span class="o">=</span> <span class="n">desired_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span> <span class="o">=</span> <span class="n">obj</span>
                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ae</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ValueError: Could not find according class:&#39;</span>
                                   <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not find according class:&#39;</span><span class="p">,</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Element not supported right now:&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Element not supported right now:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span> <span class="o">=</span> <span class="n">base_element</span>


        <span class="c1"># Todo: check if hyperparameters are members of the class</span>
        <span class="c1"># Todo: write method that returns any hyperparameter that could be optimized --&gt; sklearn: get_params.keys</span>
        <span class="c1"># Todo: map any hyperparameter to a possible default list of values to try</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span> <span class="o">=</span> <span class="n">test_disabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__disabled&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
        <span class="c1"># check if hyperparameters are already in sklearn style</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hyperparameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key_0</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">hyperparameters</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">disabled</span>

    <span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_element</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes an instantiated object and encapsulates it into the PHOTON structure,</span>
<span class="sd">        add the disabled function and attaches information about the hyperparameters that should be tested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span>

    <span class="nd">@hyperparameters.setter</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">create_global_config_dict</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
                <span class="n">config_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">)</span>
            <span class="n">config_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
                <span class="n">config_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">config_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forwards the get_params request to the wrapped base element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forwards the set_params request to the wrapped base element</span>
<span class="sd">        Takes care of the disabled parameter which is additionally attached by the PHOTON wrapper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># element disable is a construct used for this container only</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;disabled&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the fit function of the base element</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="c1"># self.base_element.fit(data, targets)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls predict function on the base element.</span>

<span class="sd">        IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.</span>
<span class="sd">        This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.</span>
<span class="sd">        Sklearn usually expects the last element to predict.</span>
<span class="sd">        Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after</span>
<span class="sd">        training only used for transforming.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have function &#39;</span> <span class="o">+</span>
                               <span class="s1">&#39;predict, or at least transform.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have function predict, or at least transform.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict probabilities</span>
<span class="sd">        base element needs predict_proba() function, otherwise throw</span>
<span class="sd">        base exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have &quot;predict_proba&quot; function.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have predict_proba function.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1"># def fit_predict(self, data, targets):</span>
    <span class="c1">#     if not self.disabled:</span>
    <span class="c1">#         return self.base_element.fit_predict(data, targets)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return data</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls transform on the base element.</span>

<span class="sd">        IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.</span>
<span class="sd">        This is used if we are using an estimator as a preprocessing step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException: transform-predict-mess&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;transform-predict-mess&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls inverse_transform on the base element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;inverse_transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># raise Warning(&#39;Element &#39; + self.name + &#39; has no method inverse_transform&#39;)</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="c1"># def fit_transform(self, data, targets=None):</span>
    <span class="c1">#     if not self.disabled:</span>
    <span class="c1">#         if hasattr(self.base_element, &#39;fit_transform&#39;):</span>
    <span class="c1">#             return self.base_element.fit_transform(data, targets)</span>
    <span class="c1">#         elif hasattr(self.base_element, &#39;transform&#39;):</span>
    <span class="c1">#             self.base_element.fit(data, targets)</span>
    <span class="c1">#             return self.base_element.transform(data)</span>
    <span class="c1">#         # elif hasattr(self.base_element, &#39;predict&#39;):</span>
    <span class="c1">#         #     self.base_element.fit(data, targets)</span>
    <span class="c1">#         #     return self.base_element.predict(data)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         return data</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the score function on the base element:</span>
<span class="sd">        Returns a goodness of fit measure or a likelihood of unseen data:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make hyperparameter combinations human readable &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">config_name</span><span class="p">:</span><span class="n">config_value</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.PipelineElement">PipelineElement</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineElement.ELEMENT_DICTIONARY" class="name">var <span class="ident">ELEMENT_DICTIONARY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, hyperparameters=None, test_disabled=False, disabled=False, base_element=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes a string literal and transforms it into an object of the associated class (see PhotonCore.JSON)</p>
<h2>Returns</h2>
<p>instantiated class object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">disabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a string literal and transforms it into an object of the associated class (see PhotonCore.JSON)</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    instantiated class object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hyperparameters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">base_element</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">desired_class_info</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">desired_class_home</span> <span class="o">=</span> <span class="n">desired_class_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">desired_class_name</span> <span class="o">=</span> <span class="n">desired_class_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">imported_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">desired_class_home</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">desired_class_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">desired_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_module</span><span class="p">,</span> <span class="n">desired_class_name</span><span class="p">)</span>
                <span class="n">base_element</span> <span class="o">=</span> <span class="n">desired_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ae</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ValueError: Could not find according class:&#39;</span>
                               <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not find according class:&#39;</span><span class="p">,</span> <span class="n">PipelineElement</span><span class="o">.</span><span class="n">ELEMENT_DICTIONARY</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Element not supported right now:&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Element not supported right now:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span> <span class="o">=</span> <span class="n">base_element</span>
    <span class="c1"># Todo: check if hyperparameters are members of the class</span>
    <span class="c1"># Todo: write method that returns any hyperparameter that could be optimized --&gt; sklearn: get_params.keys</span>
    <span class="c1"># Todo: map any hyperparameter to a possible default list of values to try</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span> <span class="o">=</span> <span class="n">test_disabled</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__disabled&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
    <span class="c1"># check if hyperparameters are already in sklearn style</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hyperparameters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">key_0</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">hyperparameters</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">hyperparameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">disabled</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.copy_me">
    <p>def <span class="ident">copy_me</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.copy_me', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.copy_me" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, data, targets=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the fit function of the base element</p>
<h2>Returns</h2>
<p>self</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.fit', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the fit function of the base element</span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># self.base_element.fit(data, targets)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.generate_config_grid">
    <p>def <span class="ident">generate_config_grid</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.generate_config_grid', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.generate_config_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config_dict</span> <span class="o">=</span> <span class="n">create_global_config_dict</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
            <span class="n">config_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">)</span>
        <span class="n">config_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
            <span class="n">config_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">config_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.generate_sklearn_hyperparameters">
    <p>def <span class="ident">generate_sklearn_hyperparameters</span>(</p><p>self, value)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.generate_sklearn_hyperparameters', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.generate_sklearn_hyperparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the get_params request to the wrapped base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forwards the get_params request to the wrapped base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.inverse_transform">
    <p>def <span class="ident">inverse_transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls inverse_transform on the base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.inverse_transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.inverse_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls inverse_transform on the base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;inverse_transform&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># raise Warning(&#39;Element &#39; + self.name + &#39; has no method inverse_transform&#39;)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.predict">
    <p>def <span class="ident">predict</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls predict function on the base element.</p>
<p>IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.
This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.
Sklearn usually expects the last element to predict.
Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after
training only used for transforming.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.predict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls predict function on the base element.</span>
<span class="sd">    IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.</span>
<span class="sd">    This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.</span>
<span class="sd">    Sklearn usually expects the last element to predict.</span>
<span class="sd">    Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after</span>
<span class="sd">    training only used for transforming.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have function &#39;</span> <span class="o">+</span>
                           <span class="s1">&#39;predict, or at least transform.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have function predict, or at least transform.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.predict_proba">
    <p>def <span class="ident">predict_proba</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Predict probabilities
base element needs predict_proba() function, otherwise throw
base exception.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.predict_proba', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.predict_proba" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict probabilities</span>
<span class="sd">    base element needs predict_proba() function, otherwise throw</span>
<span class="sd">    base exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have &quot;predict_proba&quot; function.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have predict_proba function.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.prettify_config_output">
    <p>def <span class="ident">prettify_config_output</span>(</p><p>self, config_name, config_value, return_dict=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Make hyperparameter combinations human readable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.prettify_config_output', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.prettify_config_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make hyperparameter combinations human readable &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">config_name</span><span class="p">:</span><span class="n">config_value</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.score">
    <p>def <span class="ident">score</span>(</p><p>self, X_test, y_test)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the score function on the base element:
Returns a goodness of fit measure or a likelihood of unseen data:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.score', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.score" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the score function on the base element:</span>
<span class="sd">    Returns a goodness of fit measure or a likelihood of unseen data:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the set_params request to the wrapped base element
Takes care of the disabled parameter which is additionally attached by the PHOTON wrapper</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forwards the set_params request to the wrapped base element</span>
<span class="sd">    Takes care of the disabled parameter which is additionally attached by the PHOTON wrapper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># element disable is a construct used for this container only</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;disabled&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;disabled&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.transform">
    <p>def <span class="ident">transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls transform on the base element.</p>
<p>IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.
This is used if we are using an estimator as a preprocessing step.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls transform on the base element.</span>
<span class="sd">    IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.</span>
<span class="sd">    This is used if we are using an estimator as a preprocessing step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException: transform-predict-mess&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;transform-predict-mess&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineElement.disabled" class="name">var <span class="ident">disabled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineElement.hyperparameters" class="name">var <span class="ident">hyperparameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineElement.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineElement.test_disabled" class="name">var <span class="ident">test_disabled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineElement.create">
    <p>def <span class="ident">create</span>(</p><p>cls, name, base_element, hyperparameters, test_disabled=False, disabled=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes an instantiated object and encapsulates it into the PHOTON structure,
add the disabled function and attaches information about the hyperparameters that should be tested</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineElement.create', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineElement.create" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_element</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an instantiated object and encapsulates it into the PHOTON structure,</span>
<span class="sd">    add the disabled function and attaches information about the hyperparameters that should be tested</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.PipelineStacking" class="name">class <span class="ident">PipelineStacking</span></p>
      
  
    <div class="desc"><p>Creates a vertical stacking/parallelization of pipeline items.</p>
<p>The object acts as single pipeline element and encapsulates several vertically stacked other pipeline elements, each
child receiving the same input data. The data is iteratively distributed to all children, the results are collected
and horizontally concatenated.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PipelineStacking</span><span class="p">(</span><span class="n">PipelineElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a vertical stacking/parallelization of pipeline items.</span>

<span class="sd">    The object acts as single pipeline element and encapsulates several vertically stacked other pipeline elements, each</span>
<span class="sd">    child receiving the same input data. The data is iteratively distributed to all children, the results are collected</span>
<span class="sd">    and horizontally concatenated.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stacking_elements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">voting</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new PipelineStacking element.</span>
<span class="sd">        Collects all possible hyperparameter combinations of the children</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;name&#39; [str]:</span>
<span class="sd">            Give the pipeline element a name</span>
<span class="sd">        * &#39;stacking_elements&#39; [list, optional]:</span>
<span class="sd">            List of pipeline elements that should run in parallel</span>
<span class="sd">        * &#39;voting&#39; [bool]:</span>
<span class="sd">            If true, the predictions of the encapsulated pipeline elements are joined to a single prediction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PipelineStacking</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                               <span class="n">base_element</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">voting</span> <span class="o">=</span> <span class="n">voting</span>
        <span class="k">if</span> <span class="n">stacking_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_to_stack</span> <span class="ow">in</span> <span class="n">stacking_elements</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">item_to_stack</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new element to the stack.</span>
<span class="sd">        Generates sklearn hyperparameter names in order to set the item&#39;s hyperparameters in the optimization process.</span>

<span class="sd">        * &#39;item&#39; [PipelineElement or PipelineBranch or Hyperpipe]:</span>
<span class="sd">            The Element that should be stacked and will run in a vertical parallelization in the original pipe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">hyperparameters</span>

        <span class="c1"># for each configuration</span>
        <span class="n">tmp_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">hyperparameters</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">tmp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">PipelineElement</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span>

    <span class="nd">@hyperparameters.setter</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setting hyperparameters does not make sense, only the items that added can be optimized, not the container (self)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">create_global_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">all_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">all_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_params</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the particular child and distribute the params to it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spread_params_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">splitted_k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="n">splitted_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">item_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spread_params_dict</span><span class="p">:</span>
                <span class="n">spread_params_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dict_entry</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splitted_k</span><span class="p">[</span><span class="mi">1</span><span class="p">::]):</span> <span class="n">val</span><span class="p">}</span>
            <span class="n">spread_params_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_entry</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">spread_params_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;NameError: Could not find element &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Could not find element &#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls fit iteratively on every child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Todo: parallellize fitting</span>
            <span class="n">element</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iteratively calls predict on every child.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Todo: strategy for concatenating data from different pipes</span>
        <span class="c1"># todo: parallelize prediction</span>
        <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predicted_data</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict probabilities for every pipe element and</span>
<span class="sd">        stack them together. Alternatively, do voting instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predicted_data</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls transform on every child.</span>

<span class="sd">        If the encapsulated child is a hyperpipe, also calls predict on the last element in the pipeline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># if it is a hyperpipe with a final estimator, we want to use predict:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s1">&#39;pipe&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">overwrite_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">element_data</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">overwrite_x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element_data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">_final_estimator</span><span class="p">:</span>
                    <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">element_data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if it is just a preprocessing pipe we want to use transform</span>
                    <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">element_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="s2">&quot;I dont know what todo!&quot;</span>

            <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">transformed_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transformed_data</span>

    <span class="c1"># def fit_predict(self, data, targets):</span>
    <span class="c1">#     predicted_data = None</span>
    <span class="c1">#     for name, element in self.pipe_elements.items():</span>
    <span class="c1">#         element_transform = element.fit_predict(data)</span>
    <span class="c1">#         predicted_data = PipelineStacking.stack_data(predicted_data, element_transform)</span>
    <span class="c1">#     return predicted_data</span>
    <span class="c1">#</span>
    <span class="c1"># def fit_transform(self, data, targets=None):</span>
    <span class="c1">#     transformed_data = np.empty((0, 0))</span>
    <span class="c1">#     for name, element in self.pipe_elements.items():</span>
    <span class="c1">#         # if it is a hyperpipe with a final estimator, we want to use predict:</span>
    <span class="c1">#         if hasattr(element, &#39;pipe&#39;):</span>
    <span class="c1">#             if element.pipe._final_estimator:</span>
    <span class="c1">#                 element.fit(data, targets)</span>
    <span class="c1">#                 element_transform = element.predict(data)</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 # if it is just a preprocessing pipe we want to use transform</span>
    <span class="c1">#                 element.fit(data)</span>
    <span class="c1">#                 element_transform = element.transform(data)</span>
    <span class="c1">#             transformed_data = PipelineStacking.stack_data(transformed_data, element_transform)</span>
    <span class="c1">#     return transformed_data</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stack_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to horizontally join the outcome of each child</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;a&#39; [ndarray]:</span>
<span class="sd">            The existing matrix</span>
<span class="sd">        * &#39;b&#39; [ndarray]:</span>
<span class="sd">            The matrix that is to be attached horizontally</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        New matrix, that is a and b horizontally joined</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Todo: check for right dimensions!</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate accuracy for predictions made with this object.</span>
<span class="sd">        This function should probably never be called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Todo: invent strategy for this ?</span>
        <span class="c1"># raise BaseException(&#39;PipelineStacking.score should probably never be reached.&#39;)</span>
        <span class="c1"># return 16</span>
        <span class="n">predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.PipelineStacking">PipelineStacking</a></li>
          <li><a href="#photonai.base.PipelineElement">PipelineElement</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineStacking.ELEMENT_DICTIONARY" class="name">var <span class="ident">ELEMENT_DICTIONARY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, stacking_elements=None, voting=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new PipelineStacking element.
Collects all possible hyperparameter combinations of the children</p>
<h2>Parameters</h2>
<ul>
<li>'name' [str]:
    Give the pipeline element a name</li>
<li>'stacking_elements' [list, optional]:
    List of pipeline elements that should run in parallel</li>
<li>'voting' [bool]:
    If true, the predictions of the encapsulated pipeline elements are joined to a single prediction</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stacking_elements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">voting</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new PipelineStacking element.</span>
<span class="sd">    Collects all possible hyperparameter combinations of the children</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;name&#39; [str]:</span>
<span class="sd">        Give the pipeline element a name</span>
<span class="sd">    * &#39;stacking_elements&#39; [list, optional]:</span>
<span class="sd">        List of pipeline elements that should run in parallel</span>
<span class="sd">    * &#39;voting&#39; [bool]:</span>
<span class="sd">        If true, the predictions of the encapsulated pipeline elements are joined to a single prediction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PipelineStacking</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{},</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                           <span class="n">base_element</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">voting</span> <span class="o">=</span> <span class="n">voting</span>
    <span class="k">if</span> <span class="n">stacking_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item_to_stack</span> <span class="ow">in</span> <span class="n">stacking_elements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">item_to_stack</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.add">
    <p>def <span class="ident">add</span>(</p><p>self, item)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.add', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.add" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.copy_me">
    <p>def <span class="ident">copy_me</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.copy_me', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.copy_me" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, data, targets=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls fit iteratively on every child</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.fit', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls fit iteratively on every child</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Todo: parallellize fitting</span>
        <span class="n">element</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.generate_config_grid">
    <p>def <span class="ident">generate_config_grid</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.generate_config_grid', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.generate_config_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">create_global_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.generate_sklearn_hyperparameters">
    <p>def <span class="ident">generate_sklearn_hyperparameters</span>(</p><p>self, value)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.generate_sklearn_hyperparameters', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.generate_sklearn_hyperparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the get_params request to the wrapped base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">all_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">all_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_params</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.inverse_transform">
    <p>def <span class="ident">inverse_transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls inverse_transform on the base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.inverse_transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.inverse_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls inverse_transform on the base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;inverse_transform&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># raise Warning(&#39;Element &#39; + self.name + &#39; has no method inverse_transform&#39;)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.predict">
    <p>def <span class="ident">predict</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Iteratively calls predict on every child.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.predict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iteratively calls predict on every child.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Todo: strategy for concatenating data from different pipes</span>
    <span class="c1"># todo: parallelize prediction</span>
    <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predicted_data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.predict_proba">
    <p>def <span class="ident">predict_proba</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Predict probabilities for every pipe element and
stack them together. Alternatively, do voting instead.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.predict_proba', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.predict_proba" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict probabilities for every pipe element and</span>
<span class="sd">    stack them together. Alternatively, do voting instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">predicted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predicted_data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.prettify_config_output">
    <p>def <span class="ident">prettify_config_output</span>(</p><p>self, config_name, config_value, return_dict=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Make hyperparameter combinations human readable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.prettify_config_output', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.prettify_config_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make hyperparameter combinations human readable &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">config_name</span> <span class="o">==</span> <span class="s2">&quot;disabled&quot;</span> <span class="ow">and</span> <span class="n">config_value</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;enabled&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;enabled = True&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">config_name</span><span class="p">:</span><span class="n">config_value</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config_name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.score">
    <p>def <span class="ident">score</span>(</p><p>self, X_test, y_test)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate accuracy for predictions made with this object.
This function should probably never be called.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.score', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.score" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate accuracy for predictions made with this object.</span>
<span class="sd">    This function should probably never be called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Todo: invent strategy for this ?</span>
    <span class="c1"># raise BaseException(&#39;PipelineStacking.score should probably never be reached.&#39;)</span>
    <span class="c1"># return 16</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Find the particular child and distribute the params to it</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the particular child and distribute the params to it</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spread_params_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">splitted_k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
        <span class="n">item_name</span> <span class="o">=</span> <span class="n">splitted_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spread_params_dict</span><span class="p">:</span>
            <span class="n">spread_params_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dict_entry</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splitted_k</span><span class="p">[</span><span class="mi">1</span><span class="p">::]):</span> <span class="n">val</span><span class="p">}</span>
        <span class="n">spread_params_dict</span><span class="p">[</span><span class="n">item_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_entry</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">spread_params_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;NameError: Could not find element &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Could not find element &#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.transform">
    <p>def <span class="ident">transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls transform on every child.</p>
<p>If the encapsulated child is a hyperpipe, also calls predict on the last element in the pipeline.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls transform on every child.</span>
<span class="sd">    If the encapsulated child is a hyperpipe, also calls predict on the last element in the pipeline.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># if it is a hyperpipe with a final estimator, we want to use predict:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s1">&#39;pipe&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">overwrite_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">element_data</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">overwrite_x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">element_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">_final_estimator</span><span class="p">:</span>
                <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">element_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if it is just a preprocessing pipe we want to use transform</span>
                <span class="n">element_transform</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">element_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;I dont know what todo!&quot;</span>
        <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">PipelineStacking</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">transformed_data</span><span class="p">,</span> <span class="n">element_transform</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transformed_data</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineStacking.hyperparameters" class="name">var <span class="ident">hyperparameters</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#photonai.base.PipelineElement">PipelineElement</a></code>.<code><a href="#photonai.base.PipelineElement.hyperparameters">hyperparameters</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineStacking.pipe_elements" class="name">var <span class="ident">pipe_elements</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineStacking.voting" class="name">var <span class="ident">voting</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.create">
    <p>def <span class="ident">create</span>(</p><p>cls, name, base_element, hyperparameters, test_disabled=False, disabled=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes an instantiated object and encapsulates it into the PHOTON structure,
add the disabled function and attaches information about the hyperparameters that should be tested</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.create', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.create" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_element</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an instantiated object and encapsulates it into the PHOTON structure,</span>
<span class="sd">    add the disabled function and attaches information about the hyperparameters that should be tested</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineStacking.stack_data">
    <p>def <span class="ident">stack_data</span>(</p><p>cls, a, b)</p>
    </div>
    

    
  
    <div class="desc"><p>Helper method to horizontally join the outcome of each child</p>
<h2>Parameters</h2>
<ul>
<li>'a' [ndarray]:
    The existing matrix</li>
<li>'b' [ndarray]:
    The matrix that is to be attached horizontally</li>
</ul>
<h2>Returns</h2>
<p>New matrix, that is a and b horizontally joined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineStacking.stack_data', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineStacking.stack_data" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">stack_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to horizontally join the outcome of each child</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;a&#39; [ndarray]:</span>
<span class="sd">        The existing matrix</span>
<span class="sd">    * &#39;b&#39; [ndarray]:</span>
<span class="sd">        The matrix that is to be attached horizontally</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    New matrix, that is a and b horizontally joined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Todo: check for right dimensions!</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="photonai.base.PipelineSwitch" class="name">class <span class="ident">PipelineSwitch</span></p>
      
  
    <div class="desc"><p>This class encapsulates several pipeline elements that belong at the same step of the pipeline,
competing for being the best choice.</p>
<p>If for example you want to find out if preprocessing A or preprocessing B is better at this position in the pipe.
Or you want to test if a tree outperforms the good old SVM.</p>
<p>ATTENTION: This class is a construct that may be convenient but is not suitable for any complex optimizations.
Currently it only works for grid_search and the derived optimization strategies.
USE THIS ONLY FOR RAPID PROTOTYPING AND PRELIMINARY RESULTS</p>
<p>The class acts as if it is a single entity. Tt joins the hyperparamater combinations of each encapsulated element to
a single, big combination grid. Each hyperparameter combination from that grid gets a number. Then the PipelineSwitch
object publishes the numbers to be chosen as the object's hyperparameter. When a new number is chosen from the
optimizer, it internally activates the belonging element and sets the element's parameter to the hyperparameter
combination. In that way, each of the elements is tested in all its configurations at the same position in the
pipeline. From the outside, the process and the optimizer only sees one parameter of the PipelineSwitch, that is
the an integer indicating which item of the hyperparameter combination grid is currently active.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PipelineSwitch</span><span class="p">(</span><span class="n">PipelineElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class encapsulates several pipeline elements that belong at the same step of the pipeline,</span>
<span class="sd">    competing for being the best choice.</span>

<span class="sd">    If for example you want to find out if preprocessing A or preprocessing B is better at this position in the pipe.</span>
<span class="sd">    Or you want to test if a tree outperforms the good old SVM.</span>

<span class="sd">    ATTENTION: This class is a construct that may be convenient but is not suitable for any complex optimizations.</span>
<span class="sd">    Currently it only works for grid_search and the derived optimization strategies.</span>
<span class="sd">    USE THIS ONLY FOR RAPID PROTOTYPING AND PRELIMINARY RESULTS</span>

<span class="sd">    The class acts as if it is a single entity. Tt joins the hyperparamater combinations of each encapsulated element to</span>
<span class="sd">    a single, big combination grid. Each hyperparameter combination from that grid gets a number. Then the PipelineSwitch</span>
<span class="sd">    object publishes the numbers to be chosen as the object&#39;s hyperparameter. When a new number is chosen from the</span>
<span class="sd">    optimizer, it internally activates the belonging element and sets the element&#39;s parameter to the hyperparameter</span>
<span class="sd">    combination. In that way, each of the elements is tested in all its configurations at the same position in the</span>
<span class="sd">    pipeline. From the outside, the process and the optimizer only sees one parameter of the PipelineSwitch, that is</span>
<span class="sd">    the an integer indicating which item of the hyperparameter combination grid is currently active.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pipeline_element_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">_estimator_type</span><span class="o">=</span><span class="s1">&#39;regressor&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new PipelineSwitch object and generated the hyperparameter combination grid</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * &#39;name&#39; [str]:</span>
<span class="sd">            How the element is called in the pipeline</span>
<span class="sd">        * &#39;pipeline_element_list&#39; [list, optional]:</span>
<span class="sd">            The competing pipeline elements</span>
<span class="sd">        * &#39;_estimator_type:</span>
<span class="sd">            Used for validation purposes, either classifier or regressor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;__current_element&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_element</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_estimator_type</span> <span class="o">=</span> <span class="n">_estimator_type</span>

        <span class="k">if</span> <span class="n">pipeline_element_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span> <span class="o">=</span> <span class="n">pipeline_element_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_private_config_grid</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_private_config_grid</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Todo: return actual hyperparameters of all pipeline elements??</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span>

    <span class="nd">@hyperparameters.setter</span>
    <span class="k">def</span> <span class="nf">hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">generate_private_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># calculate anew</span>
        <span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># generate possible combinations for each item respectively - do not mix hyperparameters across items</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pipe_element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">):</span>
            <span class="c1"># distinct_values_config = create_global_config([pipe_element])</span>
            <span class="c1"># add pipeline switch name in the config so that the hyperparameters can be set from other classes</span>
            <span class="c1"># pipeline switch will give the hyperparameters to the respective child</span>
            <span class="c1"># distinct_values_config_copy = {}</span>
            <span class="c1"># for config_key, config_value in distinct_values_config.items():</span>
            <span class="c1">#     distinct_values_config_copy[self.name + &quot;__&quot; + config_key] = config_value</span>

            <span class="n">element_configurations</span> <span class="o">=</span> <span class="n">pipe_element</span><span class="o">.</span><span class="n">generate_config_grid</span><span class="p">()</span>
            <span class="n">final_configuration_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">element_configurations</span><span class="p">:</span>
                <span class="n">copy_of_dict_item</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">copy_of_dict_item</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">final_configuration_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy_of_dict_item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_configuration_list</span><span class="p">)</span>
            <span class="n">hyperparameters</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span> <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final_configuration_list</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span><span class="p">:</span> <span class="n">hyperparameters</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_element</span>

    <span class="nd">@current_element.setter</span>
    <span class="k">def</span> <span class="nf">current_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_element</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># pass the right config to the element</span>
        <span class="c1"># config = self.pipeline_element_configurations[value[0]][value[1]]</span>
        <span class="c1"># self.base_element.set_params(config)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the currently active element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The optimization process sees the amount of possible combinations and chooses one of them.</span>
<span class="sd">        Then this class activates the belonging element and prepared the element with the particular chosen configuration.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_nr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">config_nr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_curr_element</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;current_element&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">config_nr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;current_element&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">config_nr</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_nr</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ValueError: current_element must be of type Tuple&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;current_element must be of type Tuple&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_element</span> <span class="o">=</span> <span class="n">config_nr</span>
            <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="p">[</span><span class="n">config_nr</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">config_nr</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># remove name</span>
            <span class="n">unnamed_config</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">config_key</span><span class="p">,</span> <span class="n">config_value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">key_split</span> <span class="o">=</span> <span class="n">config_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
                <span class="n">unnamed_config</span><span class="p">[</span><span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key_split</span><span class="p">[</span><span class="mi">2</span><span class="p">::])]</span> <span class="o">=</span> <span class="n">config_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">unnamed_config</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes the sklearn configuration dictionary human readable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * &#39;prettified_configuration_string&#39; [str]:</span>
<span class="sd">            configuration as prettified string or configuration as dict with prettified keys</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">config_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">output</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PipelineSwitch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prettify_config_output</span><span class="p">(</span><span class="n">config_name</span><span class="p">,</span> <span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#photonai.base.PipelineSwitch">PipelineSwitch</a></li>
          <li><a href="#photonai.base.PipelineElement">PipelineElement</a></li>
          <li>sklearn.base.BaseEstimator</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.ELEMENT_DICTIONARY" class="name">var <span class="ident">ELEMENT_DICTIONARY</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, pipeline_element_list=None, _estimator_type=&#39;regressor&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new PipelineSwitch object and generated the hyperparameter combination grid</p>
<h2>Parameters</h2>
<ul>
<li>'name' [str]:
    How the element is called in the pipeline</li>
<li>'pipeline_element_list' [list, optional]:
    The competing pipeline elements</li>
<li>'_estimator_type:
    Used for validation purposes, either classifier or regressor</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.__init__', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pipeline_element_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">_estimator_type</span><span class="o">=</span><span class="s1">&#39;regressor&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new PipelineSwitch object and generated the hyperparameter combination grid</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * &#39;name&#39; [str]:</span>
<span class="sd">        How the element is called in the pipeline</span>
<span class="sd">    * &#39;pipeline_element_list&#39; [list, optional]:</span>
<span class="sd">        The competing pipeline elements</span>
<span class="sd">    * &#39;_estimator_type:</span>
<span class="sd">        Used for validation purposes, either classifier or regressor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;__current_element&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_element</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_estimator_type</span> <span class="o">=</span> <span class="n">_estimator_type</span>
    <span class="k">if</span> <span class="n">pipeline_element_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span> <span class="o">=</span> <span class="n">pipeline_element_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_private_config_grid</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.add">
    <p>def <span class="ident">add</span>(</p><p>self, other)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.add', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.add" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.copy_me">
    <p>def <span class="ident">copy_me</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.copy_me', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.copy_me" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.fit">
    <p>def <span class="ident">fit</span>(</p><p>self, data, targets=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the fit function of the base element</p>
<h2>Returns</h2>
<p>self</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.fit', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.fit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the fit function of the base element</span>
<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    self</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># self.base_element.fit(data, targets)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.generate_config_grid">
    <p>def <span class="ident">generate_config_grid</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.generate_config_grid', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.generate_config_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">config_dict</span> <span class="o">=</span> <span class="n">create_global_config_dict</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
            <span class="n">config_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">)</span>
        <span class="n">config_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">config_dict</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
            <span class="n">config_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">config_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.generate_private_config_grid">
    <p>def <span class="ident">generate_private_config_grid</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.generate_private_config_grid', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.generate_private_config_grid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_private_config_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># reset</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># calculate anew</span>
    <span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># generate possible combinations for each item respectively - do not mix hyperparameters across items</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pipe_element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">):</span>
        <span class="c1"># distinct_values_config = create_global_config([pipe_element])</span>
        <span class="c1"># add pipeline switch name in the config so that the hyperparameters can be set from other classes</span>
        <span class="c1"># pipeline switch will give the hyperparameters to the respective child</span>
        <span class="c1"># distinct_values_config_copy = {}</span>
        <span class="c1"># for config_key, config_value in distinct_values_config.items():</span>
        <span class="c1">#     distinct_values_config_copy[self.name + &quot;__&quot; + config_key] = config_value</span>
        <span class="n">element_configurations</span> <span class="o">=</span> <span class="n">pipe_element</span><span class="o">.</span><span class="n">generate_config_grid</span><span class="p">()</span>
        <span class="n">final_configuration_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">element_configurations</span><span class="p">:</span>
            <span class="n">copy_of_dict_item</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">copy_of_dict_item</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">final_configuration_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy_of_dict_item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_configuration_list</span><span class="p">)</span>
        <span class="n">hyperparameters</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span> <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final_configuration_list</span><span class="p">))]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span><span class="p">:</span> <span class="n">hyperparameters</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.generate_sklearn_hyperparameters">
    <p>def <span class="ident">generate_sklearn_hyperparameters</span>(</p><p>self, value)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.generate_sklearn_hyperparameters', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.generate_sklearn_hyperparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_sklearn_hyperparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a dictionary according to the sklearn convention of element_name__parameter_name: parameter_value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_list</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_disabled</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_disabled</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.get_params">
    <p>def <span class="ident">get_params</span>(</p><p>self, deep=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Forwards the get_params request to the wrapped base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.get_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.get_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forwards the get_params request to the wrapped base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">deep</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.inverse_transform">
    <p>def <span class="ident">inverse_transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls inverse_transform on the base element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.inverse_transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.inverse_transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls inverse_transform on the base element</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;inverse_transform&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># raise Warning(&#39;Element &#39; + self.name + &#39; has no method inverse_transform&#39;)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.predict">
    <p>def <span class="ident">predict</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls predict function on the base element.</p>
<p>IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.
This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.
Sklearn usually expects the last element to predict.
Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after
training only used for transforming.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.predict', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.predict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls predict function on the base element.</span>
<span class="sd">    IF PREDICT IS NOT AVAILABLE CALLS TRANSFORM.</span>
<span class="sd">    This is for the case that the encapsulated hyperpipe only part of another hyperpipe, and works as a transformer.</span>
<span class="sd">    Sklearn usually expects the last element to predict.</span>
<span class="sd">    Also this is needed in case we are using an autoencoder which is firstly trained by using predict, and after</span>
<span class="sd">    training only used for transforming.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have function &#39;</span> <span class="o">+</span>
                           <span class="s1">&#39;predict, or at least transform.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have function predict, or at least transform.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.predict_proba">
    <p>def <span class="ident">predict_proba</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Predict probabilities
base element needs predict_proba() function, otherwise throw
base exception.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.predict_proba', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.predict_proba" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict probabilities</span>
<span class="sd">    base element needs predict_proba() function, otherwise throw</span>
<span class="sd">    base exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException. base Element should have &quot;predict_proba&quot; function.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;base Element should have predict_proba function.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.prettify_config_output">
    <p>def <span class="ident">prettify_config_output</span>(</p><p>self, config_name, config_value, return_dict=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Makes the sklearn configuration dictionary human readable</p>
<h2>Returns</h2>
<ul>
<li>'prettified_configuration_string' [str]:
    configuration as prettified string or configuration as dict with prettified keys</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.prettify_config_output', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.prettify_config_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prettify_config_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_name</span><span class="p">,</span> <span class="n">config_value</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes the sklearn configuration dictionary human readable</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    * &#39;prettified_configuration_string&#39; [str]:</span>
<span class="sd">        configuration as prettified string or configuration as dict with prettified keys</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">config_value</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_list</span><span class="p">[</span><span class="n">config_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">output</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">PipelineSwitch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prettify_config_output</span><span class="p">(</span><span class="n">config_name</span><span class="p">,</span> <span class="n">config_value</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.score">
    <p>def <span class="ident">score</span>(</p><p>self, X_test, y_test)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls the score function on the base element:
Returns a goodness of fit measure or a likelihood of unseen data:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.score', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.score" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the score function on the base element:</span>
<span class="sd">    Returns a goodness of fit measure or a likelihood of unseen data:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.set_params">
    <p>def <span class="ident">set_params</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>The optimization process sees the amount of possible combinations and chooses one of them.
Then this class activates the belonging element and prepared the element with the particular chosen configuration.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.set_params', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.set_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The optimization process sees the amount of possible combinations and chooses one of them.</span>
<span class="sd">    Then this class activates the belonging element and prepared the element with the particular chosen configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config_nr</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sklearn_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">config_nr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sklearn_curr_element</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s1">&#39;current_element&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">config_nr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;current_element&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">config_nr</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_nr</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ValueError: current_element must be of type Tuple&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;current_element must be of type Tuple&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_element</span> <span class="o">=</span> <span class="n">config_nr</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_element_configurations</span><span class="p">[</span><span class="n">config_nr</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">config_nr</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># remove name</span>
        <span class="n">unnamed_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">config_key</span><span class="p">,</span> <span class="n">config_value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_split</span> <span class="o">=</span> <span class="n">config_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
            <span class="n">unnamed_config</span><span class="p">[</span><span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key_split</span><span class="p">[</span><span class="mi">2</span><span class="p">::])]</span> <span class="o">=</span> <span class="n">config_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">unnamed_config</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.transform">
    <p>def <span class="ident">transform</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Calls transform on the base element.</p>
<p>IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.
This is used if we are using an estimator as a preprocessing step.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.transform', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.transform" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls transform on the base element.</span>
<span class="sd">    IN CASE THERE IS NO TRANSFORM METHOD, CALLS PREDICT.</span>
<span class="sd">    This is used if we are using an estimator as a preprocessing step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_element</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;BaseException: transform-predict-mess&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">&#39;transform-predict-mess&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.base_element" class="name">var <span class="ident">base_element</span></p>
            

            
  
    <div class="desc"><p>Returns the currently active element</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.current_element" class="name">var <span class="ident">current_element</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.disabled" class="name">var <span class="ident">disabled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.hyperparameters" class="name">var <span class="ident">hyperparameters</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#photonai.base.PipelineElement">PipelineElement</a></code>.<code><a href="#photonai.base.PipelineElement.hyperparameters">hyperparameters</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.pipeline_element_configurations" class="name">var <span class="ident">pipeline_element_configurations</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.sklearn_name" class="name">var <span class="ident">sklearn_name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="photonai.base.PipelineSwitch.test_disabled" class="name">var <span class="ident">test_disabled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="photonai.base.PipelineSwitch.create">
    <p>def <span class="ident">create</span>(</p><p>cls, name, base_element, hyperparameters, test_disabled=False, disabled=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes an instantiated object and encapsulates it into the PHOTON structure,
add the disabled function and attaches information about the hyperparameters that should be tested</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-photonai.base.PipelineSwitch.create', this);">Show source &equiv;</a></p>
  <div id="source-photonai.base.PipelineSwitch.create" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_element</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">test_disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an instantiated object and encapsulates it into the PHOTON structure,</span>
<span class="sd">    add the disabled function and attaches information about the hyperparameters that should be tested</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">test_disabled</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">base_element</span><span class="o">=</span><span class="n">base_element</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
