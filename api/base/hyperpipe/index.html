
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Hyperpipe - </title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-hyperpipe" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      <div class="photon-logo">PHOTON<span class="ai">AI</span></div>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hyperpipe
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../photon_elements/switch/" class="md-tabs__link">
        Pipeline Architecture
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../examples/classification/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../features/custom_metrics/" class="md-tabs__link">
        Features
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../algorithms/algorithms_index/" class="md-tabs__link">
        Algorithms
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="https://www.photon-ai.com" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      <div class="photon-logo">PHOTON<span class="ai">AI</span></div>
    </a>
    
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Basic Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/photonai/" class="md-nav__link">
        PHOTONAI Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/regression/" class="md-nav__link">
        A first regression example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/algorithm_index/" class="md-nav__link">
        Access established ml-packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/hpos/" class="md-nav__link">
        Hyperparameter Optimization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/custom_algorithm/" class="md-nav__link">
        Include custom algorithm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/output/" class="md-nav__link">
        Inspect and visualize results
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Pipeline Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pipeline Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Pipeline Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../photon_elements/switch/" class="md-nav__link">
        Switch (OR)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../photon_elements/stack/" class="md-nav__link">
        Stack (AND)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../photon_elements/feature_subset_pipelines/" class="md-nav__link">
        Feature Subset Pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../photon_elements/classifier_ensemble/" class="md-nav__link">
        Classifier Ensemble
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          General
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="General" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          General
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/classification/" class="md-nav__link">
        Simple Classification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/regression/" class="md-nav__link">
        Simple Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/compare_estimators/" class="md-nav__link">
        Compare estimators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/imbalanced_data/" class="md-nav__link">
        Over- /Undersampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/confounder_removal/" class="md-nav__link">
        Remove confounders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/dnn_multiclass_prediction/" class="md-nav__link">
        Use a DNN with multiclass prediction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Specific Use Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Specific Use Cases" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Specific Use Cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/sample_pairing/" class="md-nav__link">
        Sample Pairing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/no_outer_cv/" class="md-nav__link">
        No Hyperparameter Optimization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/group_driven_cv_split/" class="md-nav__link">
        Use site-specific validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/permutation_importances/" class="md-nav__link">
        Permutation Importances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/scikit_learn_mlp/" class="md-nav__link">
        Optimize a MLP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/custom_metrics/" class="md-nav__link">
        Custom Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/performance_constraints/" class="md-nav__link">
        Hyperparameter Optimization Shortcuts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/save_load/" class="md-nav__link">
        Load and use a .photon model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/additional_data/" class="md-nav__link">
        Stream additional data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/callbacks/" class="md-nav__link">
        Inspect the dataflow at runtime
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/caching/" class="md-nav__link">
        Caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/batching/" class="md-nav__link">
        Transform in Batches
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/learning_curves/" class="md-nav__link">
        Learning Curves
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/result_handler/" class="md-nav__link">
        Result Queries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/preprocessing/" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Algorithms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Algorithms" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Algorithms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithms/algorithms_index/" class="md-nav__link">
        Access pre-registered algorithms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithms/transformers/" class="md-nav__link">
        Transformers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithms/estimators/" class="md-nav__link">
        Estimators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithms/hpos/" class="md-nav__link">
        Hyperparameter Optimizers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algorithms/registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Base
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Base" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Base
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../branch/" class="md-nav__link">
        Branch
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Hyperpipe
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Hyperpipe
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe" class="md-nav__link">
    photonai.base.hyperpipe.Hyperpipe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.add" class="md-nav__link">
    add()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.copy_me" class="md-nav__link">
    copy_me()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.get_permutation_feature_importances" class="md-nav__link">
    get_permutation_feature_importances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.inverse_transform_pipeline" class="md-nav__link">
    inverse_transform_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.load_optimum_pipe" class="md-nav__link">
    load_optimum_pipe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.predict_proba" class="md-nav__link">
    predict_proba()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../output_settings/" class="md-nav__link">
        OutputSettings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_element/" class="md-nav__link">
        PipelineElement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stack/" class="md-nav__link">
        Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../switch/" class="md-nav__link">
        Switch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Modelwrapper
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelwrapper" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Modelwrapper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/base_model_wrapper/" class="md-nav__link">
        BaseModelWrapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3_2" type="checkbox" id="__nav_6_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3_2">
          Feature Selection
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Feature Selection" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_3_2">
          <span class="md-nav__icon md-icon"></span>
          Feature Selection
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/feature_selection/FClassifSelectPercentile/" class="md-nav__link">
        FClassifSelectPercentile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/feature_selection/FRegressionFilterPValue/" class="md-nav__link">
        FRegressionFilterPValue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/feature_selection/FRegressionSelectPercentile/" class="md-nav__link">
        FRegressionSelectPercentile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/feature_selection/LassoFeatureSelection/" class="md-nav__link">
        LassoFeatureSelection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/feature_selection/ModelSelector/" class="md-nav__link">
        ModelSelector
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3_3" type="checkbox" id="__nav_6_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3_3">
          Keras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Keras" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_3_3">
          <span class="md-nav__icon md-icon"></span>
          Keras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/keras/dnn_classifier/" class="md-nav__link">
        KerasDnnClassifier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/keras/dnn_regressor/" class="md-nav__link">
        KerasDnnRegressor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/label_encoder/" class="md-nav__link">
        LabelEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modelwrapper/imblearn/" class="md-nav__link">
        ImbalancedDataTransformer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4">
          Optimization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optimization" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Optimization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/grid_search/" class="md-nav__link">
        GridSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/random_grid_search/" class="md-nav__link">
        RandomGridSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/random_search/" class="md-nav__link">
        RandomSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/skopt/" class="md-nav__link">
        Scikit-Optimize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/smac/" class="md-nav__link">
        SMAC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/nevergrad/" class="md-nav__link">
        Nevergrad
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4_7" type="checkbox" id="__nav_6_4_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4_7">
          Hyperparameter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hyperparameter" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_4_7">
          <span class="md-nav__icon md-icon"></span>
          Hyperparameter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/hyperparameter/boolean_switch/" class="md-nav__link">
        BooleanSwitch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/hyperparameter/categorical/" class="md-nav__link">
        Categorical
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/hyperparameter/float_range/" class="md-nav__link">
        FloatRange
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../optimization/hyperparameter/integer_range/" class="md-nav__link">
        IntegerRange
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_5">
          Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Processing" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/results_handler/" class="md-nav__link">
        Results Handler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_6">
          Custom Elements
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Custom Elements" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          Custom Elements
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_transformer/" class="md-nav__link">
        Custom Transformer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../custom_estimator/" class="md-nav__link">
        Custom Estimator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://www.photon-ai.com" class="md-nav__link">
        Website
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://arxiv.org/abs/2002.05426" class="md-nav__link">
        Preprint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribution.md" class="md-nav__link">
        Contributions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe" class="md-nav__link">
    photonai.base.hyperpipe.Hyperpipe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.add" class="md-nav__link">
    add()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.copy_me" class="md-nav__link">
    copy_me()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.fit" class="md-nav__link">
    fit()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.get_permutation_feature_importances" class="md-nav__link">
    get_permutation_feature_importances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.inverse_transform_pipeline" class="md-nav__link">
    inverse_transform_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.load_optimum_pipe" class="md-nav__link">
    load_optimum_pipe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#photonai.base.hyperpipe.Hyperpipe.predict_proba" class="md-nav__link">
    predict_proba()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="documentation-for-hyperpipe">Documentation for <code>Hyperpipe</code></h1>


  <div class="doc doc-object doc-class">

<a id="photonai.base.hyperpipe.Hyperpipe"></a>
    <div class="doc doc-contents first">

      <p>The PHOTONAI Hyperpipe class creates a custom
machine learning pipeline. In addition it defines
the relevant analysis’ parameters such as the
cross-validation scheme, the hyperparameter optimization
strategy, and the performance metrics of interest.</p>
<p>So called PHOTONAI PipelineElements can be added to
the Hyperpipe, each of them being a data-processing
method or a learning algorithm. By choosing and
combining data-processing methods or algorithms,
and arranging them with the PHOTONAI classes,
simple and complex pipeline architectures can be designed rapidly.</p>
<p>The PHOTONAI Hyperpipe automatizes the nested training,
test and hyperparameter optimization procedures.</p>
<p>The Hyperpipe monitors:</p>
<ul>
<li>the nested-cross-validated training
    and test procedure,</li>
<li>communicates with the hyperparameter optimization
    strategy,</li>
<li>streams information between the pipeline elements,</li>
<li>logs all results obtained and evaluates the performance,</li>
<li>guides the hyperparameter optimization process by
    a so-called best config metric which is used to select
    the best performing hyperparameter configuration.</li>
</ul>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>optimum_pipe</code></td>
        <td><code>PhotonPipeline</code></td>
        <td><p>An sklearn pipeline object that is fitted to the training data
according to the best hyperparameter configuration found.
Currently, we don't create an ensemble of all best hyperparameter
configs over all folds. We find the best config by comparing
the test error across outer folds. The hyperparameter config of the best
fold is used as the optimal model and is then trained on the complete set.</p></td>
      </tr>
      <tr>
        <td><code>best_config</code></td>
        <td><code>dict</code></td>
        <td><p>Dictionary containing the hyperparameters of the
best configuration. Contains the parameters in the sklearn
interface of model_name__parameter_name: parameter value.</p></td>
      </tr>
      <tr>
        <td><code>results</code></td>
        <td><code>MDBHyperpipe</code></td>
        <td><p>Object containing all information about the for the
performed hyperparameter search. Holds the training and test
metrics for all outer folds, inner folds
and configurations, as well as additional information.</p></td>
      </tr>
      <tr>
        <td><code>elements</code></td>
        <td><code>list</code></td>
        <td><p>Contains `all PipelineElement or Hyperpipe
objects that are added to the pipeline.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">photonai.base</span> <span class="kn">import</span> <span class="n">Hyperpipe</span><span class="p">,</span> <span class="n">PipelineElement</span>
<span class="kn">from</span> <span class="nn">photonai.optimization</span> <span class="kn">import</span> <span class="n">FloatRange</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ShuffleSplit</span><span class="p">,</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>

<span class="n">hyperpipe</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="p">(</span><span class="s1">&#39;myPipe&#39;</span><span class="p">,</span>
                      <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;random_grid_search&#39;</span><span class="p">,</span>
                      <span class="n">optimizer_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;limit_in_minutes&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
                      <span class="n">outer_cv</span><span class="o">=</span><span class="n">ShuffleSplit</span><span class="p">(</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                      <span class="n">inner_cv</span><span class="o">=</span><span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                      <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;recall&#39;</span><span class="p">,</span> <span class="s2">&quot;f1_score&quot;</span><span class="p">],</span>
                      <span class="n">best_config_metric</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span>
                      <span class="n">eval_final_performance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">hyperpipe</span> <span class="o">+=</span> <span class="n">PipelineElement</span><span class="p">(</span><span class="s2">&quot;SVC&quot;</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">FloatRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)})</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hyperpipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>

        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Hyperpipe</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The PHOTONAI Hyperpipe class creates a custom</span>
<span class="sd">    machine learning pipeline. In addition it defines</span>
<span class="sd">    the relevant analysis’ parameters such as the</span>
<span class="sd">    cross-validation scheme, the hyperparameter optimization</span>
<span class="sd">    strategy, and the performance metrics of interest.</span>

<span class="sd">    So called PHOTONAI PipelineElements can be added to</span>
<span class="sd">    the Hyperpipe, each of them being a data-processing</span>
<span class="sd">    method or a learning algorithm. By choosing and</span>
<span class="sd">    combining data-processing methods or algorithms,</span>
<span class="sd">    and arranging them with the PHOTONAI classes,</span>
<span class="sd">    simple and complex pipeline architectures can be designed rapidly.</span>

<span class="sd">    The PHOTONAI Hyperpipe automatizes the nested training,</span>
<span class="sd">    test and hyperparameter optimization procedures.</span>

<span class="sd">    The Hyperpipe monitors:</span>

<span class="sd">    - the nested-cross-validated training</span>
<span class="sd">        and test procedure,</span>
<span class="sd">    - communicates with the hyperparameter optimization</span>
<span class="sd">        strategy,</span>
<span class="sd">    - streams information between the pipeline elements,</span>
<span class="sd">    - logs all results obtained and evaluates the performance,</span>
<span class="sd">    - guides the hyperparameter optimization process by</span>
<span class="sd">        a so-called best config metric which is used to select</span>
<span class="sd">        the best performing hyperparameter configuration.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        optimum_pipe (PhotonPipeline):</span>
<span class="sd">            An sklearn pipeline object that is fitted to the training data</span>
<span class="sd">            according to the best hyperparameter configuration found.</span>
<span class="sd">            Currently, we don&#39;t create an ensemble of all best hyperparameter</span>
<span class="sd">            configs over all folds. We find the best config by comparing</span>
<span class="sd">            the test error across outer folds. The hyperparameter config of the best</span>
<span class="sd">            fold is used as the optimal model and is then trained on the complete set.</span>

<span class="sd">        best_config (dict):</span>
<span class="sd">            Dictionary containing the hyperparameters of the</span>
<span class="sd">            best configuration. Contains the parameters in the sklearn</span>
<span class="sd">            interface of model_name__parameter_name: parameter value.</span>

<span class="sd">        results (MDBHyperpipe):</span>
<span class="sd">            Object containing all information about the for the</span>
<span class="sd">            performed hyperparameter search. Holds the training and test</span>
<span class="sd">            metrics for all outer folds, inner folds</span>
<span class="sd">            and configurations, as well as additional information.</span>

<span class="sd">        elements (list):</span>
<span class="sd">            Contains `all PipelineElement or Hyperpipe</span>
<span class="sd">            objects that are added to the pipeline.</span>

<span class="sd">    Example:</span>
<span class="sd">        ``` python</span>
<span class="sd">        from photonai.base import Hyperpipe, PipelineElement</span>
<span class="sd">        from photonai.optimization import FloatRange</span>
<span class="sd">        from sklearn.model_selection import ShuffleSplit, KFold</span>
<span class="sd">        from sklearn.datasets import load_breast_cancer</span>

<span class="sd">        hyperpipe = Hyperpipe(&#39;myPipe&#39;,</span>
<span class="sd">                              optimizer=&#39;random_grid_search&#39;,</span>
<span class="sd">                              optimizer_params={&#39;limit_in_minutes&#39;: 5},</span>
<span class="sd">                              outer_cv=ShuffleSplit(test_size=0.2, n_splits=3),</span>
<span class="sd">                              inner_cv=KFold(n_splits=10, shuffle=True),</span>
<span class="sd">                              metrics=[&#39;accuracy&#39;, &#39;precision&#39;, &#39;recall&#39;, &quot;f1_score&quot;],</span>
<span class="sd">                              best_config_metric=&#39;accuracy&#39;,</span>
<span class="sd">                              eval_final_performance=True,</span>
<span class="sd">                              verbosity=0)</span>

<span class="sd">        hyperpipe += PipelineElement(&quot;SVC&quot;, hyperparameters={&quot;C&quot;: FloatRange(1, 100)})</span>

<span class="sd">        X, y = load_breast_cancer(return_X_y=True)</span>
<span class="sd">        hyperpipe.fit(X, y)</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">inner_cv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">BaseShuffleSplit</span><span class="p">,</span> <span class="n">_RepeatedSplits</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">outer_cv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">BaseShuffleSplit</span><span class="p">,</span> <span class="n">_RepeatedSplits</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">optimizer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">,</span>
                 <span class="n">optimizer_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Scorer</span><span class="o">.</span><span class="n">Metric_Type</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">best_config_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Scorer</span><span class="o">.</span><span class="n">Metric_Type</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eval_final_performance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">use_test_set</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">project_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">calculate_metrics_per_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">calculate_metrics_across_folds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">learning_curves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">learning_curves_cut</span><span class="p">:</span> <span class="n">FloatRange</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">output_settings</span><span class="p">:</span> <span class="n">OutputSettings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">performance_constraints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">permutation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cache_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">nr_of_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">allow_multidim_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the object.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            name:</span>
<span class="sd">                Name of hyperpipe instance.</span>

<span class="sd">            inner_cv:</span>
<span class="sd">                Cross validation strategy to test hyperparameter configurations, generates the validation set.</span>

<span class="sd">            outer_cv:</span>
<span class="sd">                Cross validation strategy to use for the hyperparameter search itself, generates the test set.</span>

<span class="sd">            optimizer:</span>
<span class="sd">                Hyperparameter optimization algorithm.</span>

<span class="sd">                - In case a string literal is given:</span>
<span class="sd">                    - &quot;grid_search&quot;: Optimizer that iteratively tests all possible hyperparameter combinations.</span>
<span class="sd">                    - &quot;random_grid_search&quot;: A variation of the grid search optimization that randomly picks</span>
<span class="sd">                        hyperparameter combinations from all possible hyperparameter combinations.</span>
<span class="sd">                    - &quot;sk_opt&quot;: Scikit-Optimize based on theories of bayesian optimization.</span>
<span class="sd">                    - &quot;random_search&quot;: randomly chooses hyperparameter from grid-free domain.</span>
<span class="sd">                    - &quot;smac&quot;: SMAC based on theories of bayesian optimization.</span>
<span class="sd">                    - &quot;nevergrad&quot;: Nevergrad based on theories of evolutionary learning.</span>

<span class="sd">                - In case an object is given:</span>
<span class="sd">                    expects the object to have the following methods:</span>
<span class="sd">                    - `ask`: returns a hyperparameter configuration in form of an dictionary containing</span>
<span class="sd">                        key-&gt;value pairs in the sklearn parameter encoding `model_name__parameter_name: parameter_value`</span>
<span class="sd">                    - `prepare`: takes a list of pipeline elements and their particular hyperparameters to prepare the</span>
<span class="sd">                                 hyperparameter space</span>
<span class="sd">                    - `tell`: gets a tested config and the respective performance in order to</span>
<span class="sd">                        calculate a smart next configuration to process</span>

<span class="sd">            metrics:</span>
<span class="sd">                Metrics that should be calculated for both training, validation and test set</span>
<span class="sd">                Use the preimported metrics from sklearn and photonai, or register your own</span>

<span class="sd">                - Metrics for `classification`:</span>
<span class="sd">                    - `accuracy`: sklearn.metrics.accuracy_score</span>
<span class="sd">                    - `matthews_corrcoef`: sklearn.metrics.matthews_corrcoef</span>
<span class="sd">                    - `confusion_matrix`: sklearn.metrics.confusion_matrix,</span>
<span class="sd">                    - `f1_score`: sklearn.metrics.f1_score</span>
<span class="sd">                    - `hamming_loss`: sklearn.metrics.hamming_loss</span>
<span class="sd">                    - `log_loss`: sklearn.metrics.log_loss</span>
<span class="sd">                    - `precision`: sklearn.metrics.precision_score</span>
<span class="sd">                    - `recall`: sklearn.metrics.recall_score</span>
<span class="sd">                - Metrics for `regression`:</span>
<span class="sd">                    - `mean_squared_error`: sklearn.metrics.mean_squared_error</span>
<span class="sd">                    - `mean_absolute_error`: sklearn.metrics.mean_absolute_error</span>
<span class="sd">                    - `explained_variance`: sklearn.metrics.explained_variance_score</span>
<span class="sd">                    - `r2`: sklearn.metrics.r2_score</span>
<span class="sd">                - Other metrics</span>
<span class="sd">                    - `pearson_correlation`: photon_core.framework.Metrics.pearson_correlation</span>
<span class="sd">                    - `variance_explained`:  photon_core.framework.Metrics.variance_explained_score</span>
<span class="sd">                    - `categorical_accuracy`: photon_core.framework.Metrics.categorical_accuracy_score</span>

<span class="sd">            best_config_metric:</span>
<span class="sd">                The metric that should be maximized or minimized in order to choose</span>
<span class="sd">                the best hyperparameter configuration.</span>

<span class="sd">            eval_final_performance:</span>
<span class="sd">                DEPRECATED! Use &quot;use_test_set&quot; instead!</span>

<span class="sd">            use_test_set:</span>
<span class="sd">                If the metrics should be calculated for the test set,</span>
<span class="sd">                otherwise the test set is seperated but not used.</span>

<span class="sd">            project_folder:</span>
<span class="sd">                The output folder in which all files generated by the</span>
<span class="sd">                PHOTONAI project are saved to.</span>

<span class="sd">            test_size:</span>
<span class="sd">                The amount of the data that should be left out if no outer_cv is given and</span>
<span class="sd">                eval_final_performance is set to True.</span>

<span class="sd">            calculate_metrics_per_fold:</span>
<span class="sd">                If True, the metrics are calculated for each inner_fold.</span>
<span class="sd">                If False, calculate_metrics_across_folds must be True.</span>

<span class="sd">            calculate_metrics_across_folds:</span>
<span class="sd">                If True, the metrics are calculated across all inner_fold.</span>
<span class="sd">                If False, calculate_metrics_per_fold must be True.</span>

<span class="sd">            random_seed:</span>
<span class="sd">                Random Seed.</span>

<span class="sd">            verbosity:</span>
<span class="sd">                The level of verbosity, 0 is least talkative and</span>
<span class="sd">                gives only warn and error, 1 gives adds info and 2 adds debug.</span>

<span class="sd">            learning_curves:</span>
<span class="sd">                Enables learning curve procedure. Evaluate learning process over</span>
<span class="sd">                different sizes of input. Depends on learning_curves_cut.</span>

<span class="sd">            learning_curves_cut:</span>
<span class="sd">                The tested relative cuts for data size.</span>

<span class="sd">            performance_constraints:</span>
<span class="sd">                Objects that indicate whether a configuration should</span>
<span class="sd">                be tested further. For example, the inner fold of a config</span>
<span class="sd">                does not perform better than the dummy performance.</span>

<span class="sd">            permutation_id:</span>
<span class="sd">                String identifier for permutation tests.</span>

<span class="sd">            cache_folder:</span>
<span class="sd">                Folder path for multi-processing.</span>

<span class="sd">            nr_of_processes:</span>
<span class="sd">                Determined the amount of simultaneous calculation of outer_folds.</span>

<span class="sd">            allow_multidim_targets:</span>
<span class="sd">                Allows multidimensional targets.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\W+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eval_final_performance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">depr_warning</span> <span class="o">=</span> <span class="s2">&quot;Hyperpipe parameter eval_final_performance is deprecated. It&#39;s called use_test_set now.&quot;</span>
            <span class="n">use_test_set</span> <span class="o">=</span> <span class="n">eval_final_performance</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">depr_warning</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="n">depr_warning</span><span class="p">)</span>

        <span class="c1"># ====================== Cross Validation ===========================</span>
        <span class="c1"># check if both calculate_metrics_per_folds and calculate_metrics_across_folds is False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">calculate_metrics_across_folds</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">calculate_metrics_per_fold</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Apparently, you&#39;ve set calculate_metrics_across_folds=False and &quot;</span>
                                      <span class="s2">&quot;calculate_metrics_per_fold=False. In this case PHOTONAI does not calculate &quot;</span>
                                      <span class="s2">&quot;any metrics which doesn&#39;t make any sense. Set at least one to True.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inner_cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;PHOTONAI requires an inner_cv split. Please enable inner cross-validation. &quot;</span> \
                  <span class="s2">&quot;As exmaple: Hyperpipe(...inner_cv = KFold(n_splits = 3), ...). &quot;</span> \
                  <span class="s2">&quot;Ensure you import the cross_validation object first.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># use default cut &#39;FloatRange(0, 1, &#39;range&#39;, 0.2)&#39; if learning_curves = True but learning_curves_cut is None</span>
        <span class="k">if</span> <span class="n">learning_curves</span> <span class="ow">and</span> <span class="n">learning_curves_cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="n">FloatRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">learning_curves</span> <span class="ow">and</span> <span class="n">learning_curves_cut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">CrossValidation</span><span class="p">(</span><span class="n">inner_cv</span><span class="o">=</span><span class="n">inner_cv</span><span class="p">,</span>
                                                          <span class="n">outer_cv</span><span class="o">=</span><span class="n">outer_cv</span><span class="p">,</span>
                                                          <span class="n">use_test_set</span><span class="o">=</span><span class="n">use_test_set</span><span class="p">,</span>
                                                          <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span>
                                                          <span class="n">calculate_metrics_per_fold</span><span class="o">=</span><span class="n">calculate_metrics_per_fold</span><span class="p">,</span>
                                                          <span class="n">calculate_metrics_across_folds</span><span class="o">=</span><span class="n">calculate_metrics_across_folds</span><span class="p">,</span>
                                                          <span class="n">learning_curves</span><span class="o">=</span><span class="n">learning_curves</span><span class="p">,</span>
                                                          <span class="n">learning_curves_cut</span><span class="o">=</span><span class="n">learning_curves_cut</span><span class="p">)</span>

        <span class="c1"># ====================== Data ===========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">allow_multidim_targets</span><span class="o">=</span><span class="n">allow_multidim_targets</span><span class="p">)</span>

        <span class="c1"># ====================== Output Folder and Log File Management ===========================</span>
        <span class="k">if</span> <span class="n">output_settings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span> <span class="o">=</span> <span class="n">output_settings</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">project_folder</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">=</span> <span class="n">project_folder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">set_project_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span><span class="p">)</span>

        <span class="c1"># update output options to add pipe name and timestamp to results folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">set_log_file</span><span class="p">()</span>

        <span class="c1"># ====================== Result Logging ===========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ====================== Pipeline ===========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ====================== Performance Optimization ===========================</span>
        <span class="k">if</span> <span class="n">optimizer_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimizer_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span> <span class="o">=</span> <span class="n">Optimization</span><span class="p">(</span><span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                         <span class="n">best_config_metric</span><span class="o">=</span><span class="n">best_config_metric</span><span class="p">,</span>
                                         <span class="n">optimizer_input</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                         <span class="n">optimizer_params</span><span class="o">=</span><span class="n">optimizer_params</span><span class="p">,</span>
                                         <span class="n">performance_constraints</span><span class="o">=</span><span class="n">performance_constraints</span><span class="p">)</span>

        <span class="c1"># self.optimization.sanity_check_metrics()</span>

        <span class="c1"># ====================== Caching and Parallelization ===========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">=</span> <span class="n">nr_of_processes</span>
        <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ====================== Internals ===========================</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">permutation_id</span> <span class="o">=</span> <span class="n">permutation_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_multidim_targets</span> <span class="o">=</span> <span class="n">allow_multidim_targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># ====================== Random Seed ===========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_seed</span>
        <span class="k">if</span> <span class="n">random_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">random</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># Helper Classes</span>
    <span class="c1"># ===================================================================</span>

    <span class="k">class</span> <span class="nc">CrossValidation</span><span class="p">:</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_cv</span><span class="p">,</span> <span class="n">outer_cv</span><span class="p">,</span>
                     <span class="n">use_test_set</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span>
                     <span class="n">calculate_metrics_per_fold</span><span class="p">,</span>
                     <span class="n">calculate_metrics_across_folds</span><span class="p">,</span>
                     <span class="n">learning_curves</span><span class="p">,</span>
                     <span class="n">learning_curves_cut</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner_cv</span> <span class="o">=</span> <span class="n">inner_cv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outer_cv</span> <span class="o">=</span> <span class="n">outer_cv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_set</span> <span class="o">=</span> <span class="n">use_test_set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">learning_curves</span> <span class="o">=</span> <span class="n">learning_curves</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="n">learning_curves_cut</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_per_fold</span> <span class="o">=</span> <span class="n">calculate_metrics_per_fold</span>
            <span class="c1"># Todo: if self.outer_cv is LeaveOneOut: Set calculate metrics across folds to True -&gt; Print</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics_across_folds</span> <span class="o">=</span> <span class="n">calculate_metrics_across_folds</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Hyperpipe </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Data</span><span class="p">:</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_multidim_targets</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_multidim_targets</span> <span class="o">=</span> <span class="n">allow_multidim_targets</span>

        <span class="k">def</span> <span class="nf">input_data_sanity_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># ==================== SANITY CHECKS ===============================</span>
            <span class="c1"># 1. Make to numpy arrays</span>
            <span class="c1"># 2. erase all Nan targets</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking input data...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">targets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;(Input-)data is a NoneType.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;(Input-)target is a NoneType.&quot;</span><span class="p">)</span>

                <span class="n">shape_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
                <span class="n">shape_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_multidim_targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape_y</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># use np.squeeze for non 1D targets.</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                            <span class="n">shape_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;y has been automatically squeezed. If this is not your intention, block this &quot;</span> \
                                  <span class="s2">&quot;with Hyperpipe(allow_multidim_targets = True&quot;</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;Target is not one-dimensional. Multidimensional targets can cause problems&quot;</span>
                                <span class="s2">&quot;with sklearn metrics. Please override with &quot;</span>
                                <span class="s2">&quot;Hyperpipe(allow_multidim_targets = True).&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">shape_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                        <span class="s2">&quot;Size of targets mismatch to size of the data: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">ie</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;IndexError: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ie</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">ie</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ValueError: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ve</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">ve</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">e</span>

            <span class="c1"># be compatible to list of (image-) files</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

            <span class="c1"># at first first, erase all rows where y is Nan if preprocessing has not done it already</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nans_in_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">nr_of_nans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nans_in_y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">nr_of_nans</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;You have </span><span class="si">{}</span><span class="s2"> Nans in your target vector, &quot;</span>
                                <span class="s2">&quot;PHOTONAI erases every data item that has a Nan Target&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nr_of_nans</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">nans_in_y</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">nans_in_y</span><span class="p">]</span>
                    <span class="n">new_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">element_list</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">new_kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_list</span><span class="p">[</span><span class="o">~</span><span class="n">nans_in_y</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">new_kwargs</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># This is only for convenience so if it fails then never mind</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Removing Nans in target vector failed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">pass</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running analysis with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; samples.&quot;</span><span class="p">)</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># Properties and Helper</span>
    <span class="c1"># ===================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">estimation_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">estimation_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;_estimator_type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">estimation_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Last element in Hyperpipe should be an estimator.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimation_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span>

    <span class="nd">@verbosity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">verbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">disable_multiprocessing_recursively</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="p">(</span><span class="n">Stack</span><span class="p">,</span> <span class="n">Branch</span><span class="p">,</span> <span class="n">Switch</span><span class="p">,</span> <span class="n">Preprocessing</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="s1">&#39;nr_of_processes&#39;</span><span class="p">):</span>
                <span class="n">pipe</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">pipe</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Branch</span><span class="p">):</span>
                    <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">disable_multiprocessing_recursively</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="s1">&#39;base_element&#39;</span><span class="p">):</span>
                    <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">disable_multiprocessing_recursively</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">base_element</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">PhotonPipeline</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">disable_multiprocessing_recursively</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="s1">&#39;nr_of_processes&#39;</span><span class="p">):</span>
                <span class="n">pipe</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">recursive_cache_folder_propagation</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">,</span> <span class="n">inner_fold_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">(</span><span class="n">Switch</span><span class="p">,</span> <span class="n">Stack</span><span class="p">,</span> <span class="n">Preprocessing</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">,</span> <span class="n">inner_fold_id</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Branch</span><span class="p">):</span>
            <span class="c1"># in case it&#39;s a Branch, we create a cache subfolder and propagate it to every child</span>
            <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
                <span class="n">cache_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_folder</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">base_element</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">,</span> <span class="n">inner_fold_id</span><span class="p">)</span>
            <span class="c1"># Hyperpipe.prepare_caching(element.base_element.cache_folder)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">PhotonPipeline</span><span class="p">):</span>
            <span class="n">element</span><span class="o">.</span><span class="n">fold_id</span> <span class="o">=</span> <span class="n">inner_fold_id</span>
            <span class="n">element</span><span class="o">.</span><span class="n">cache_folder</span> <span class="o">=</span> <span class="n">cache_folder</span>

            <span class="c1"># pipe.caching is automatically set to True or False by .cache_folder setter</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">named_steps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># we need to check if any element is Branch, Stack or Swtich</span>
                <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">,</span> <span class="n">inner_fold_id</span><span class="p">)</span>

        <span class="c1"># else: if it&#39;s a simple PipelineElement, then we just don&#39;t do anything</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># Pipeline Setup</span>
    <span class="c1"># ===================================================================</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">:</span> <span class="n">PipelineElement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an element to the machine learning pipeline.</span>
<span class="sd">        Returns self.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            pipe_element:</span>
<span class="sd">                The object to add to the machine learning pipeline,</span>
<span class="sd">                being either a transformer or an estimator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">,</span> <span class="n">Preprocessing</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="n">pipe_element</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">,</span> <span class="n">CallbackElement</span><span class="p">):</span>
            <span class="n">pipe_element</span><span class="o">.</span><span class="n">needs_y</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">,</span> <span class="n">PipelineElement</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">),</span> <span class="n">PhotonNative</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Element must be of type Pipeline Element&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">:</span> <span class="n">PipelineElement</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an element to the machine learning pipeline.</span>
<span class="sd">        Returns self.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            pipe_element:</span>
<span class="sd">                The object to add to the machine learning pipeline,</span>
<span class="sd">                being either a transformer or an estimator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># Workflow Setup</span>
    <span class="c1"># ===================================================================</span>
    <span class="k">def</span> <span class="nf">_prepare_dummy_estimator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span> <span class="o">=</span> <span class="n">MDBDummyResults</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimation_type</span> <span class="o">==</span> <span class="s1">&#39;regressor&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
            <span class="k">return</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimation_type</span> <span class="o">==</span> <span class="s1">&#39;classifier&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;most_frequent&#39;</span>
            <span class="k">return</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Estimator does not specify whether it is a regressor or classifier. &#39;</span>
                        <span class="s1">&#39;DummyEstimator step skipped.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__get_pipeline_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_elements</span><span class="p">):</span>
        <span class="n">element_list</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p_el</span> <span class="ow">in</span> <span class="n">pipeline_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p_el</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Strange Pipeline Element found that has no name..? Type: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p_el</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p_el</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">):</span>
                <span class="n">child_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_pipeline_structure</span><span class="p">(</span><span class="n">p_el</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="n">p_el</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p_el</span><span class="p">,</span> <span class="s2">&quot;identifier&quot;</span><span class="p">):</span>
                    <span class="n">identifier</span> <span class="o">=</span> <span class="n">p_el</span><span class="o">.</span><span class="n">identifier</span> <span class="o">+</span> <span class="n">identifier</span>
                    <span class="n">element_list</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">child_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p_el</span><span class="p">,</span> <span class="s1">&#39;base_element&#39;</span><span class="p">):</span>
                    <span class="n">element_list</span><span class="p">[</span><span class="n">p_el</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p_el</span><span class="o">.</span><span class="n">base_element</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element_list</span><span class="p">[</span><span class="n">p_el</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p_el</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">element_list</span>

    <span class="k">def</span> <span class="nf">_prepare_result_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">MDBHyperpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span> <span class="o">=</span> <span class="n">MDBHyperpipeInfo</span><span class="p">()</span>

        <span class="c1"># in case eval final performance is false, we have no outer fold predictions</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">use_test_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">save_predictions_from_best_config_inner_folds</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span> <span class="o">=</span> <span class="n">ResultsHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">computation_start_time</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">estimation_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimation_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">results_folder</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">permutation_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">permutation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">permutation_id</span>

        <span class="c1"># save wizard information to PHOTONAI db in order to map results to the wizard design object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">,</span> <span class="s1">&#39;wizard_object_id&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">wizard_object_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">wizard_object_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">wizard_object_id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">wizard_object_id</span> <span class="o">=</span> <span class="n">ObjectId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">wizard_object_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">wizard_system_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">wizard_project_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_pipeline_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">eval_final_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">use_test_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">best_config_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">best_config_metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">learning_curves_cut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">maximize_best_config_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">maximize_metric</span>

        <span class="c1"># optimization</span>
        <span class="k">def</span> <span class="nf">_format_cross_validation</span><span class="p">(</span><span class="n">cv</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cv</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">string</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;None&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">cross_validation</span> <span class="o">=</span> \
            <span class="p">{</span><span class="s1">&#39;OuterCV&#39;</span><span class="p">:</span> <span class="n">_format_cross_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">),</span>
             <span class="s1">&#39;InnerCV&#39;</span><span class="p">:</span> <span class="n">_format_cross_validation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">inner_cv</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X_shape&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;y_shape&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">optimization</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Optimizer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_input_str</span><span class="p">,</span>
                                                    <span class="s1">&#39;OptimizerParams&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_params</span><span class="p">),</span>
                                                    <span class="s1">&#39;BestConfigMetric&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">}</span>

        <span class="c1"># add json file of hyperpipe attributes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_transformer</span> <span class="o">=</span> <span class="n">JsonTransformer</span><span class="p">()</span>
            <span class="n">json_transformer</span><span class="o">.</span><span class="n">to_json_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">results_folder</span><span class="o">+</span><span class="s2">&quot;/hyperpipe_config.json&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;JsonTransformer was unable to create the .json file.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalize_optimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ==================== EVALUATING RESULTS OF HYPERPARAMETER OPTIMIZATION ===============================</span>
        <span class="c1"># 1. computing average metrics</span>
        <span class="c1"># 2. finding overall best config</span>
        <span class="c1"># 3. training model with best config</span>
        <span class="c1"># 4. persisting best model</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">clean_info</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Finished all outer fold computations.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Now analysing the final results...&quot;</span><span class="p">)</span>

        <span class="c1"># computer dummy metrics</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing dummy metrics...&quot;</span><span class="p">)</span>
        <span class="n">config_item</span> <span class="o">=</span> <span class="n">MDBConfig</span><span class="p">()</span>
        <span class="n">dummy_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">dummy_results</span> <span class="k">for</span> <span class="n">outer_fold</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">]</span>
        <span class="n">config_item</span><span class="o">.</span><span class="n">inner_folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dummy_results</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config_item</span><span class="o">.</span><span class="n">inner_folds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">dummy_estimator</span><span class="o">.</span><span class="n">metrics_test</span> <span class="o">=</span> \
                <span class="n">MDBHelper</span><span class="o">.</span><span class="n">aggregate_metrics_for_inner_folds</span><span class="p">(</span><span class="n">config_item</span><span class="o">.</span><span class="n">inner_folds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing mean and std for all outer fold metrics...&quot;</span><span class="p">)</span>
        <span class="c1"># Compute all final metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">metrics_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">metrics_test</span> <span class="o">=</span> \
            <span class="n">MDBHelper</span><span class="o">.</span><span class="n">aggregate_metrics_for_outer_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>

        <span class="c1"># Find best config across outer folds</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Find best config across outer folds...&quot;</span><span class="p">)</span>
        <span class="n">best_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">get_optimum_config_outer_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="n">best_config</span>

        <span class="c1"># save results again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">computation_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">computation_completed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Save final results...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Prepare Hyperpipe.optimum pipe with best config..&quot;</span><span class="p">)</span>
        <span class="c1"># set self to best config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">generate_best_model</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fitting best model...&quot;</span><span class="p">)</span>
            <span class="c1"># set self to best config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">best_config</span><span class="p">)</span>

            <span class="c1"># set caching</span>
            <span class="c1"># we want caching disabled in general but still want to do single subject caching</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span> <span class="s1">&#39;fixed_fold_id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">caching</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># disable multiprocessing when fitting optimum pipe</span>
            <span class="c1"># (otherwise inverse_transform won&#39;t work for BrainAtlas/Mask)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_multiprocessing_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Before saving the optimum pipe, add preprocessing without multiprocessing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_multiprocessing_recursively</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">add_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">)</span>

            <span class="c1"># Now truly set to no caching (including single_subject_caching)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">save_output</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pretrained_model_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">results_folder</span><span class="p">,</span>
                                                             <span class="s1">&#39;photon_best_model.photon&#39;</span><span class="p">)</span>
                    <span class="n">PhotonModelPersistor</span><span class="o">.</span><span class="n">save_optimum_pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="p">,</span> <span class="n">pretrained_model_filename</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saved best model to file.&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Could not save best model to file&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

                <span class="c1"># get feature importances of optimum pipe</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mapping back feature importances...&quot;</span><span class="p">)</span>
                <span class="n">feature_importances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">feature_importances_</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">feature_importances</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No feature importances available for </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">best_config_feature_importances</span> <span class="o">=</span> <span class="n">feature_importances</span>

                    <span class="c1"># write backmapping file only if optimum_pipes inverse_transform works completely.</span>
                    <span class="c1"># restriction: only a faulty inverse_transform is considered, missing ones are further ignored.</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
                        <span class="c1"># get backmapping</span>
                        <span class="n">backmapping</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span>\
                            <span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_importances</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;The inverse transformation is not possible for&quot;</span> <span class="ow">in</span> <span class="n">s</span>
                                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]):</span>
                            <span class="c1"># save backmapping</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save_backmapping</span><span class="p">(</span>
                                <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;optimum_pipe_feature_importances_backmapped&#39;</span><span class="p">,</span> <span class="n">backmapping</span><span class="o">=</span><span class="n">backmapping</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Could not save feature importance: backmapping NOT successful.&#39;</span><span class="p">)</span>

                <span class="c1"># save learning curves</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">learning_curves</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save_all_learning_curves</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Summarizing results...&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write predictions to files...&quot;</span><span class="p">)</span>
        <span class="c1"># write all convenience files (summary, predictions_file and plots)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">write_predictions_file</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Write summary...&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">text_summary</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># if there is a preprocessing pipeline, we apply it first.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Applying preprocessing steps...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                                                                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="n">Branch</span><span class="o">.</span><span class="n">prepare_photon_pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="n">Branch</span><span class="o">.</span><span class="n">sanity_check_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># sklearn interfaces</span>
    <span class="c1"># ===================================================================</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fit_outer_folds</span><span class="p">(</span><span class="n">outer_fold_computer</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">outer_fold_computer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the hyperparameter search and/or fits the pipeline to the data and targets.</span>

<span class="sd">        Manages the nested cross validated hyperparameter search:</span>

<span class="sd">        1. Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</span>
<span class="sd">        2. requests new configurations from the hyperparameter search strategy, the optimizer,</span>
<span class="sd">        3. initializes the testing of a specific configuration,</span>
<span class="sd">        4. communicates the result to the optimizer,</span>
<span class="sd">        5. repeats 2-4 until optimizer delivers no more configurations to test</span>
<span class="sd">        6. finally searches for the best config in all tested configs,</span>
<span class="sd">        7. trains the pipeline with the best config and evaluates the performance on the test set</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data:</span>
<span class="sd">                The array-like training and test data with shape=[N, D],</span>
<span class="sd">                where N is the number of samples and D is the number of features.</span>

<span class="sd">            targets:</span>
<span class="sd">                The truth array-like values with shape=[N],</span>
<span class="sd">                where N is the number of samples.</span>

<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to Outer_Fold_Manager.fit.</span>


<span class="sd">        Returns:</span>
<span class="sd">            Fitted Hyperpipe.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># switch to result output folder</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">101</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;PHOTONAI ANALYSIS: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">101</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preparing data and PHOTONAI objects for analysis...&quot;</span><span class="p">)</span>

        <span class="c1"># loop over outer cross validation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hyperpipe_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># check data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">input_data_sanity_checks</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># create photon pipeline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_pipeline</span><span class="p">()</span>
            <span class="c1"># initialize the progress monitors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_result_logging</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="c1"># apply preprocessing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span><span class="p">:</span>

                <span class="c1"># Outer Folds</span>
                <span class="n">outer_folds</span> <span class="o">=</span> <span class="n">FoldInfo</span><span class="o">.</span><span class="n">generate_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">use_test_set</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">test_size</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">fold_id</span><span class="p">:</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">outer_folds</span><span class="p">}</span>
                <span class="n">delayed_jobs</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Run Dummy Estimator</span>
                <span class="n">dummy_estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_dummy_estimator</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing cache files...&quot;</span><span class="p">)</span>
                    <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span> <span class="n">force_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># loop over outer cross validation</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">outer_f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outer_folds</span><span class="p">):</span>

                    <span class="c1"># 1. generate OuterFolds Object</span>
                    <span class="n">outer_fold</span> <span class="o">=</span> <span class="n">MDBOuterFold</span><span class="p">(</span><span class="n">fold_nr</span><span class="o">=</span><span class="n">outer_f</span><span class="o">.</span><span class="n">fold_nr</span><span class="p">)</span>
                    <span class="n">outer_fold_computer</span> <span class="o">=</span> <span class="n">OuterFoldManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">,</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="p">,</span>
                                                           <span class="n">outer_f</span><span class="o">.</span><span class="n">fold_id</span><span class="p">,</span>
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">,</span>
                                                           <span class="n">cache_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span>
                                                           <span class="n">cache_updater</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">,</span>
                                                           <span class="n">dummy_estimator</span><span class="o">=</span><span class="n">dummy_estimator</span><span class="p">,</span>
                                                           <span class="n">result_obj</span><span class="o">=</span><span class="n">outer_fold</span><span class="p">)</span>
                    <span class="c1"># 2. monitor outputs</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_fold</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">Hyperpipe</span><span class="o">.</span><span class="n">fit_outer_folds</span><span class="p">)(</span><span class="n">outer_fold_computer</span><span class="p">,</span>
                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">delayed_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># 3. fit</span>
                            <span class="n">outer_fold_computer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                            <span class="c1"># 4. save outer fold results</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="k">finally</span><span class="p">:</span>
                            <span class="c1"># 5. clear cache</span>
                            <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="o">*</span><span class="n">delayed_jobs</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

                <span class="c1"># evaluate hyperparameter optimization results for best config</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_optimization</span><span class="p">()</span>

                <span class="c1"># clear complete cache ? use self.cache_folder to delete all subfolders within the parent cache folder</span>
                <span class="c1"># directory</span>
                <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span> <span class="n">force_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1">###############################################################################################</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">hyperpipe_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to predict the input data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data:</span>
<span class="sd">                The array-like prediction data with shape=[M, D],</span>
<span class="sd">                where M is the number of samples and D is the number</span>
<span class="sd">                of features. D must correspond to the number</span>
<span class="sd">                of trained dimensions of the fit method.</span>

<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to optimum_pipe.predict.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Predicted targets calculated on input data with trained model.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Todo: if local_search = true then use optimized pipe here?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to predict the probabilities from the input data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data:</span>
<span class="sd">                The array-like prediction data with shape=[M, D],</span>
<span class="sd">                where M is the number of samples and D is the number</span>
<span class="sd">                of features. D must correspond to the number</span>
<span class="sd">                of trained dimensions of the fit method.</span>

<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to optimum_pipe.predict_proba.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Probabilities calculated from input data on fitted model.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to transform the data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data:</span>
<span class="sd">                The array-like input data with shape=[M, D],</span>
<span class="sd">                where M is the number of samples and D is the number</span>
<span class="sd">                of features. D must correspond to the number</span>
<span class="sd">                of trained dimensions of the fit method.</span>

<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to optimum_pipe.transform.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Transformed data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the optimum pipe to score the model.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data:</span>
<span class="sd">                The array-like data with shape=[M, D],</span>
<span class="sd">                where M is the number of samples and D is the number</span>
<span class="sd">                of features. D must correspond to the number</span>
<span class="sd">                of trained dimensions of the fit method.</span>

<span class="sd">            y:</span>
<span class="sd">                The array-like true targets.</span>

<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to optimum_pipe.predict.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Score data on input data with trained model.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">scorer</span> <span class="o">=</span> <span class="n">Scorer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">scorer</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_permutation_importances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        extracted function from get_feature_importance to improve unit testing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">importance_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">()}</span>

        <span class="k">def</span> <span class="nf">train_and_get_fimps</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">data_X</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_kwargs</span><span class="p">,</span> <span class="n">fold_str</span><span class="p">):</span>

            <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">train_kwargs</span> <span class="o">=</span> <span class="n">PhotonDataHelper</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">data_X</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_kwargs</span><span class="p">,</span>
                                                                         <span class="n">indices</span><span class="o">=</span><span class="n">train_idx</span><span class="p">)</span>

            <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">test_kwargs</span> <span class="o">=</span> <span class="n">PhotonDataHelper</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">data_X</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_kwargs</span><span class="p">,</span>
                                                                      <span class="n">indices</span><span class="o">=</span><span class="n">test_idx</span><span class="p">)</span>

            <span class="c1"># fit fold&#39;s best model (again) -&gt; to obtain that model&#39;s feature importances</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Permutation Importances: Fitting model for &quot;</span> <span class="o">+</span> <span class="n">fold_str</span><span class="p">)</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="o">**</span><span class="n">train_kwargs</span><span class="p">)</span>

            <span class="c1"># get feature importances</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Permutation Importances: Calculating performances for &quot;</span> <span class="o">+</span> <span class="n">fold_str</span><span class="p">)</span>
            <span class="n">perm_imps</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># store into list</span>
            <span class="n">importance_list</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perm_imps</span><span class="p">[</span><span class="s2">&quot;importances_mean&quot;</span><span class="p">])</span>
            <span class="n">importance_list</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perm_imps</span><span class="p">[</span><span class="s2">&quot;importances_std&quot;</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">perm_imps</span>

        <span class="k">for</span> <span class="n">outer_fold</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find a best config for outer fold &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">fold_nr</span><span class="p">))</span>

            <span class="n">pipe_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>

            <span class="c1"># set pipe to config</span>
            <span class="n">pipe_copy</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">config_dict</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">hyperpipe_info</span><span class="o">.</span><span class="n">eval_final_performance</span><span class="p">:</span>
                <span class="n">no_outer_cv_indices</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">no_outer_cv_indices</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span><span class="o">.</span><span class="n">training</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                    <span class="n">no_outer_cv_indices</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">no_outer_cv_indices</span><span class="p">:</span>
                    <span class="n">data_to_split</span><span class="p">,</span> <span class="n">y_to_split</span><span class="p">,</span> <span class="n">kwargs_to_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Permutation Importances: Using inner_cv folds.&quot;</span><span class="p">)</span>

                    <span class="c1"># get outer fold data</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">indices</span>
                    <span class="n">data_to_split</span><span class="p">,</span> <span class="n">y_to_split</span><span class="p">,</span> <span class="n">kwargs_to_split</span> <span class="o">=</span> <span class="n">PhotonDataHelper</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                                                                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
                                                                                             <span class="n">indices</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">inner_fold</span> <span class="ow">in</span> <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">inner_folds</span><span class="p">:</span>
                    <span class="n">train_and_get_fimps</span><span class="p">(</span><span class="n">pipe_copy</span><span class="p">,</span>
                                        <span class="n">inner_fold</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">inner_fold</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
                                        <span class="n">data_to_split</span><span class="p">,</span> <span class="n">y_to_split</span><span class="p">,</span> <span class="n">kwargs_to_split</span><span class="p">,</span>
                                        <span class="s2">&quot;inner fold &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inner_fold</span><span class="o">.</span><span class="n">fold_nr</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">train_and_get_fimps</span><span class="p">(</span><span class="n">pipe_copy</span><span class="p">,</span>
                                    <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
                                    <span class="n">outer_fold</span><span class="o">.</span><span class="n">best_config</span><span class="o">.</span><span class="n">best_config_score</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;outer fold &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">outer_fold</span><span class="o">.</span><span class="n">fold_nr</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">importance_list</span>

    <span class="k">def</span> <span class="nf">get_permutation_feature_importances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits a model for the best config of each outer fold (using the training data of that fold).</span>
<span class="sd">        Then calls sklearn.inspection.permutation_importance with the test data and the given kwargs (e.g. n_repeats).</span>
<span class="sd">        Returns mean of &quot;importances_mean&quot; and of &quot;importances_std&quot; of all outer folds.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            **kwargs:</span>
<span class="sd">                Keyword arguments, passed to sklearn.permutation_importance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with average of &quot;mean&quot; and &quot;std&quot; for all outer folds, respectively.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Computing permutation importances. This may take a while.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot calculate permutation importances when optimum_pipe is None (probably the &quot;</span>
                             <span class="s2">&quot;training and optimization procedure failed)&quot;</span><span class="p">)</span>
        <span class="n">importance_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_permutation_importances</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mean_importances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">importance_list</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">std_importances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">importance_list</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_importances</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_importances</span><span class="p">}</span>


    <span class="k">def</span> <span class="nf">inverse_transform_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                   <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                   <span class="n">targets</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                                   <span class="n">data_to_inverse</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse transform data for a pipeline with specific hyperparameter configuration.</span>

<span class="sd">        1. Copy Sklearn Pipeline,</span>
<span class="sd">        2. Set Parameters</span>
<span class="sd">        3. Fit Pipeline to data and targets</span>
<span class="sd">        4. Inverse transform data with that pipeline</span>

<span class="sd">        Parameters:</span>
<span class="sd">            hyperparameters:</span>
<span class="sd">                The concrete configuration settings for the pipeline elements.</span>

<span class="sd">            data:</span>
<span class="sd">                The training data to which the pipeline is fitted.</span>

<span class="sd">            targets:</span>
<span class="sd">                The truth values for training.</span>

<span class="sd">            data_to_inverse:</span>
<span class="sd">                The data that should be inversed after training.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Inverse data as array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copied_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
        <span class="n">copied_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">hyperparameters</span><span class="p">)</span>
        <span class="n">copied_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copied_pipe</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data_to_inverse</span><span class="p">)</span>

    <span class="c1"># ===================================================================</span>
    <span class="c1"># Copy, Save and Load</span>
    <span class="c1"># ===================================================================</span>

    <span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to copy an entire Hyperpipe</span>

<span class="sd">        Returns:</span>
<span class="sd">            Hyperpipe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">OutputSettings</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">initialize_log_file</span><span class="p">()</span>

        <span class="c1"># create new Hyperpipe instance</span>
        <span class="n">pipe_copy</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                              <span class="n">inner_cv</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">inner_cv</span><span class="p">),</span>
                              <span class="n">outer_cv</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">),</span>
                              <span class="n">best_config_metric</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">,</span>
                              <span class="n">metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                              <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_input_str</span><span class="p">,</span>
                              <span class="n">optimizer_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_params</span><span class="p">,</span>
                              <span class="n">project_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span>
                              <span class="n">output_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attr</span> <span class="o">!=</span> <span class="s1">&#39;output_settings&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pipe_copy</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
            <span class="n">preprocessing</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="n">preprocessing</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
            <span class="n">pipe_copy</span> <span class="o">+=</span> <span class="n">preprocessing</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="n">pipe_copy</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pipe_copy</span>

    <span class="k">def</span> <span class="nf">save_optimum_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;photon_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_best_model.p&quot;</span>
        <span class="n">PhotonModelPersistor</span><span class="o">.</span><span class="n">save_optimum_pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_optimum_pipe</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhotonPipeline</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load optimum pipe from file.</span>
<span class="sd">        As staticmethod, instantiation is thus not required.</span>
<span class="sd">        Called backend: PhotonModelPersistor.load_optimum_pipe.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file:</span>
<span class="sd">                File path specifying .photon file to load</span>
<span class="sd">                trained pipeline from zipped file.</span>

<span class="sd">            password:</span>
<span class="sd">                Passcode for read file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns pipeline with all trained PipelineElements.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PhotonModelPersistor</span><span class="o">.</span><span class="n">load_optimum_pipe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reload_hyperpipe</span><span class="p">(</span><span class="n">results_folder</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">data_kwargs</span><span class="p">):</span>

        <span class="n">res_handler</span> <span class="o">=</span> <span class="n">ResultsHandler</span><span class="p">()</span>
        <span class="n">res_handler</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_folder</span><span class="p">,</span> <span class="s2">&quot;photon_result_file.json&quot;</span><span class="p">))</span>
        <span class="n">loaded_optimum_pipe</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">load_optimum_pipe</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_folder</span><span class="p">,</span> <span class="s2">&quot;photon_best_model.photon&quot;</span><span class="p">))</span>

        <span class="n">new_hyperpipe</span> <span class="o">=</span> <span class="n">JsonTransformer</span><span class="p">()</span><span class="o">.</span><span class="n">from_json_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_folder</span><span class="p">,</span> <span class="s2">&quot;hyperpipe_config.json&quot;</span><span class="p">))</span>
        <span class="n">new_hyperpipe</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">res_handler</span><span class="o">.</span><span class="n">results</span>
        <span class="n">new_hyperpipe</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="n">loaded_optimum_pipe</span>
        <span class="n">new_hyperpipe</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data_kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_hyperpipe</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overwrite BaseEstimator&#39;s function to avoid errors when using Jupyter Notebooks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Hyperpipe(name=&#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">inner_cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outer_cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;grid_search&#39;</span><span class="p">,</span> <span class="n">optimizer_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">best_config_metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eval_final_performance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_test_set</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">calculate_metrics_per_fold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">calculate_metrics_across_folds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">learning_curves</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">learning_curves_cut</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">performance_constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">permutation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nr_of_processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">allow_multidim_targets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initialize the object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Name of hyperpipe instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>inner_cv</code></td>
        <td><code>Union[sklearn.model_selection._split.BaseCrossValidator, sklearn.model_selection._split.BaseShuffleSplit, sklearn.model_selection._split._RepeatedSplits]</code></td>
        <td><p>Cross validation strategy to test hyperparameter configurations, generates the validation set.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>outer_cv</code></td>
        <td><code>Union[sklearn.model_selection._split.BaseCrossValidator, sklearn.model_selection._split.BaseShuffleSplit, sklearn.model_selection._split._RepeatedSplits]</code></td>
        <td><p>Cross validation strategy to use for the hyperparameter search itself, generates the test set.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>optimizer</code></td>
        <td><code>str</code></td>
        <td><p>Hyperparameter optimization algorithm.</p>
<ul>
<li>
<p>In case a string literal is given:</p>
<ul>
<li>"grid_search": Optimizer that iteratively tests all possible hyperparameter combinations.</li>
<li>"random_grid_search": A variation of the grid search optimization that randomly picks
    hyperparameter combinations from all possible hyperparameter combinations.</li>
<li>"sk_opt": Scikit-Optimize based on theories of bayesian optimization.</li>
<li>"random_search": randomly chooses hyperparameter from grid-free domain.</li>
<li>"smac": SMAC based on theories of bayesian optimization.</li>
<li>"nevergrad": Nevergrad based on theories of evolutionary learning.</li>
</ul>
</li>
<li>
<p>In case an object is given:
    expects the object to have the following methods:</p>
<ul>
<li><code>ask</code>: returns a hyperparameter configuration in form of an dictionary containing
    key-&gt;value pairs in the sklearn parameter encoding <code>model_name__parameter_name: parameter_value</code></li>
<li><code>prepare</code>: takes a list of pipeline elements and their particular hyperparameters to prepare the
             hyperparameter space</li>
<li><code>tell</code>: gets a tested config and the respective performance in order to
    calculate a smart next configuration to process</li>
</ul>
</li>
</ul></td>
        <td><code>&#39;grid_search&#39;</code></td>
      </tr>
      <tr>
        <td><code>metrics</code></td>
        <td><code>Optional[List[Union[Callable, keras.metrics.Metric, Type[keras.metrics.Metric], str]]]</code></td>
        <td><p>Metrics that should be calculated for both training, validation and test set
Use the preimported metrics from sklearn and photonai, or register your own</p>
<ul>
<li>Metrics for <code>classification</code>:<ul>
<li><code>accuracy</code>: sklearn.metrics.accuracy_score</li>
<li><code>matthews_corrcoef</code>: sklearn.metrics.matthews_corrcoef</li>
<li><code>confusion_matrix</code>: sklearn.metrics.confusion_matrix,</li>
<li><code>f1_score</code>: sklearn.metrics.f1_score</li>
<li><code>hamming_loss</code>: sklearn.metrics.hamming_loss</li>
<li><code>log_loss</code>: sklearn.metrics.log_loss</li>
<li><code>precision</code>: sklearn.metrics.precision_score</li>
<li><code>recall</code>: sklearn.metrics.recall_score</li>
</ul>
</li>
<li>Metrics for <code>regression</code>:<ul>
<li><code>mean_squared_error</code>: sklearn.metrics.mean_squared_error</li>
<li><code>mean_absolute_error</code>: sklearn.metrics.mean_absolute_error</li>
<li><code>explained_variance</code>: sklearn.metrics.explained_variance_score</li>
<li><code>r2</code>: sklearn.metrics.r2_score</li>
</ul>
</li>
<li>Other metrics<ul>
<li><code>pearson_correlation</code>: photon_core.framework.Metrics.pearson_correlation</li>
<li><code>variance_explained</code>:  photon_core.framework.Metrics.variance_explained_score</li>
<li><code>categorical_accuracy</code>: photon_core.framework.Metrics.categorical_accuracy_score</li>
</ul>
</li>
</ul></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>best_config_metric</code></td>
        <td><code>Union[Callable, keras.metrics.Metric, Type[keras.metrics.Metric], str]</code></td>
        <td><p>The metric that should be maximized or minimized in order to choose
the best hyperparameter configuration.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>eval_final_performance</code></td>
        <td><code>bool</code></td>
        <td><p>DEPRECATED! Use "use_test_set" instead!</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_test_set</code></td>
        <td><code>bool</code></td>
        <td><p>If the metrics should be calculated for the test set,
otherwise the test set is seperated but not used.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>project_folder</code></td>
        <td><code>str</code></td>
        <td><p>The output folder in which all files generated by the
PHOTONAI project are saved to.</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>test_size</code></td>
        <td><code>float</code></td>
        <td><p>The amount of the data that should be left out if no outer_cv is given and
eval_final_performance is set to True.</p></td>
        <td><code>0.2</code></td>
      </tr>
      <tr>
        <td><code>calculate_metrics_per_fold</code></td>
        <td><code>bool</code></td>
        <td><p>If True, the metrics are calculated for each inner_fold.
If False, calculate_metrics_across_folds must be True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>calculate_metrics_across_folds</code></td>
        <td><code>bool</code></td>
        <td><p>If True, the metrics are calculated across all inner_fold.
If False, calculate_metrics_per_fold must be True.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>random_seed</code></td>
        <td><code>int</code></td>
        <td><p>Random Seed.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>verbosity</code></td>
        <td><code>int</code></td>
        <td><p>The level of verbosity, 0 is least talkative and
gives only warn and error, 1 gives adds info and 2 adds debug.</p></td>
        <td><code>0</code></td>
      </tr>
      <tr>
        <td><code>learning_curves</code></td>
        <td><code>bool</code></td>
        <td><p>Enables learning curve procedure. Evaluate learning process over
different sizes of input. Depends on learning_curves_cut.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>learning_curves_cut</code></td>
        <td><code>FloatRange</code></td>
        <td><p>The tested relative cuts for data size.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>performance_constraints</code></td>
        <td><code>list</code></td>
        <td><p>Objects that indicate whether a configuration should
be tested further. For example, the inner fold of a config
does not perform better than the dummy performance.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>permutation_id</code></td>
        <td><code>str</code></td>
        <td><p>String identifier for permutation tests.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cache_folder</code></td>
        <td><code>str</code></td>
        <td><p>Folder path for multi-processing.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>nr_of_processes</code></td>
        <td><code>int</code></td>
        <td><p>Determined the amount of simultaneous calculation of outer_folds.</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>allow_multidim_targets</code></td>
        <td><code>bool</code></td>
        <td><p>Allows multidimensional targets.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
             <span class="n">inner_cv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">BaseShuffleSplit</span><span class="p">,</span> <span class="n">_RepeatedSplits</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">outer_cv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BaseCrossValidator</span><span class="p">,</span> <span class="n">BaseShuffleSplit</span><span class="p">,</span> <span class="n">_RepeatedSplits</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">optimizer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">,</span>
             <span class="n">optimizer_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Scorer</span><span class="o">.</span><span class="n">Metric_Type</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">best_config_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Scorer</span><span class="o">.</span><span class="n">Metric_Type</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">eval_final_performance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">use_test_set</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
             <span class="n">project_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">calculate_metrics_per_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">calculate_metrics_across_folds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
             <span class="n">learning_curves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">learning_curves_cut</span><span class="p">:</span> <span class="n">FloatRange</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">output_settings</span><span class="p">:</span> <span class="n">OutputSettings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">performance_constraints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">permutation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">cache_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">nr_of_processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
             <span class="n">allow_multidim_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the object.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        name:</span>
<span class="sd">            Name of hyperpipe instance.</span>

<span class="sd">        inner_cv:</span>
<span class="sd">            Cross validation strategy to test hyperparameter configurations, generates the validation set.</span>

<span class="sd">        outer_cv:</span>
<span class="sd">            Cross validation strategy to use for the hyperparameter search itself, generates the test set.</span>

<span class="sd">        optimizer:</span>
<span class="sd">            Hyperparameter optimization algorithm.</span>

<span class="sd">            - In case a string literal is given:</span>
<span class="sd">                - &quot;grid_search&quot;: Optimizer that iteratively tests all possible hyperparameter combinations.</span>
<span class="sd">                - &quot;random_grid_search&quot;: A variation of the grid search optimization that randomly picks</span>
<span class="sd">                    hyperparameter combinations from all possible hyperparameter combinations.</span>
<span class="sd">                - &quot;sk_opt&quot;: Scikit-Optimize based on theories of bayesian optimization.</span>
<span class="sd">                - &quot;random_search&quot;: randomly chooses hyperparameter from grid-free domain.</span>
<span class="sd">                - &quot;smac&quot;: SMAC based on theories of bayesian optimization.</span>
<span class="sd">                - &quot;nevergrad&quot;: Nevergrad based on theories of evolutionary learning.</span>

<span class="sd">            - In case an object is given:</span>
<span class="sd">                expects the object to have the following methods:</span>
<span class="sd">                - `ask`: returns a hyperparameter configuration in form of an dictionary containing</span>
<span class="sd">                    key-&gt;value pairs in the sklearn parameter encoding `model_name__parameter_name: parameter_value`</span>
<span class="sd">                - `prepare`: takes a list of pipeline elements and their particular hyperparameters to prepare the</span>
<span class="sd">                             hyperparameter space</span>
<span class="sd">                - `tell`: gets a tested config and the respective performance in order to</span>
<span class="sd">                    calculate a smart next configuration to process</span>

<span class="sd">        metrics:</span>
<span class="sd">            Metrics that should be calculated for both training, validation and test set</span>
<span class="sd">            Use the preimported metrics from sklearn and photonai, or register your own</span>

<span class="sd">            - Metrics for `classification`:</span>
<span class="sd">                - `accuracy`: sklearn.metrics.accuracy_score</span>
<span class="sd">                - `matthews_corrcoef`: sklearn.metrics.matthews_corrcoef</span>
<span class="sd">                - `confusion_matrix`: sklearn.metrics.confusion_matrix,</span>
<span class="sd">                - `f1_score`: sklearn.metrics.f1_score</span>
<span class="sd">                - `hamming_loss`: sklearn.metrics.hamming_loss</span>
<span class="sd">                - `log_loss`: sklearn.metrics.log_loss</span>
<span class="sd">                - `precision`: sklearn.metrics.precision_score</span>
<span class="sd">                - `recall`: sklearn.metrics.recall_score</span>
<span class="sd">            - Metrics for `regression`:</span>
<span class="sd">                - `mean_squared_error`: sklearn.metrics.mean_squared_error</span>
<span class="sd">                - `mean_absolute_error`: sklearn.metrics.mean_absolute_error</span>
<span class="sd">                - `explained_variance`: sklearn.metrics.explained_variance_score</span>
<span class="sd">                - `r2`: sklearn.metrics.r2_score</span>
<span class="sd">            - Other metrics</span>
<span class="sd">                - `pearson_correlation`: photon_core.framework.Metrics.pearson_correlation</span>
<span class="sd">                - `variance_explained`:  photon_core.framework.Metrics.variance_explained_score</span>
<span class="sd">                - `categorical_accuracy`: photon_core.framework.Metrics.categorical_accuracy_score</span>

<span class="sd">        best_config_metric:</span>
<span class="sd">            The metric that should be maximized or minimized in order to choose</span>
<span class="sd">            the best hyperparameter configuration.</span>

<span class="sd">        eval_final_performance:</span>
<span class="sd">            DEPRECATED! Use &quot;use_test_set&quot; instead!</span>

<span class="sd">        use_test_set:</span>
<span class="sd">            If the metrics should be calculated for the test set,</span>
<span class="sd">            otherwise the test set is seperated but not used.</span>

<span class="sd">        project_folder:</span>
<span class="sd">            The output folder in which all files generated by the</span>
<span class="sd">            PHOTONAI project are saved to.</span>

<span class="sd">        test_size:</span>
<span class="sd">            The amount of the data that should be left out if no outer_cv is given and</span>
<span class="sd">            eval_final_performance is set to True.</span>

<span class="sd">        calculate_metrics_per_fold:</span>
<span class="sd">            If True, the metrics are calculated for each inner_fold.</span>
<span class="sd">            If False, calculate_metrics_across_folds must be True.</span>

<span class="sd">        calculate_metrics_across_folds:</span>
<span class="sd">            If True, the metrics are calculated across all inner_fold.</span>
<span class="sd">            If False, calculate_metrics_per_fold must be True.</span>

<span class="sd">        random_seed:</span>
<span class="sd">            Random Seed.</span>

<span class="sd">        verbosity:</span>
<span class="sd">            The level of verbosity, 0 is least talkative and</span>
<span class="sd">            gives only warn and error, 1 gives adds info and 2 adds debug.</span>

<span class="sd">        learning_curves:</span>
<span class="sd">            Enables learning curve procedure. Evaluate learning process over</span>
<span class="sd">            different sizes of input. Depends on learning_curves_cut.</span>

<span class="sd">        learning_curves_cut:</span>
<span class="sd">            The tested relative cuts for data size.</span>

<span class="sd">        performance_constraints:</span>
<span class="sd">            Objects that indicate whether a configuration should</span>
<span class="sd">            be tested further. For example, the inner fold of a config</span>
<span class="sd">            does not perform better than the dummy performance.</span>

<span class="sd">        permutation_id:</span>
<span class="sd">            String identifier for permutation tests.</span>

<span class="sd">        cache_folder:</span>
<span class="sd">            Folder path for multi-processing.</span>

<span class="sd">        nr_of_processes:</span>
<span class="sd">            Determined the amount of simultaneous calculation of outer_folds.</span>

<span class="sd">        allow_multidim_targets:</span>
<span class="sd">            Allows multidimensional targets.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\W+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eval_final_performance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">depr_warning</span> <span class="o">=</span> <span class="s2">&quot;Hyperpipe parameter eval_final_performance is deprecated. It&#39;s called use_test_set now.&quot;</span>
        <span class="n">use_test_set</span> <span class="o">=</span> <span class="n">eval_final_performance</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">depr_warning</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="n">depr_warning</span><span class="p">)</span>

    <span class="c1"># ====================== Cross Validation ===========================</span>
    <span class="c1"># check if both calculate_metrics_per_folds and calculate_metrics_across_folds is False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">calculate_metrics_across_folds</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">calculate_metrics_per_fold</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Apparently, you&#39;ve set calculate_metrics_across_folds=False and &quot;</span>
                                  <span class="s2">&quot;calculate_metrics_per_fold=False. In this case PHOTONAI does not calculate &quot;</span>
                                  <span class="s2">&quot;any metrics which doesn&#39;t make any sense. Set at least one to True.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inner_cv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;PHOTONAI requires an inner_cv split. Please enable inner cross-validation. &quot;</span> \
              <span class="s2">&quot;As exmaple: Hyperpipe(...inner_cv = KFold(n_splits = 3), ...). &quot;</span> \
              <span class="s2">&quot;Ensure you import the cross_validation object first.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># use default cut &#39;FloatRange(0, 1, &#39;range&#39;, 0.2)&#39; if learning_curves = True but learning_curves_cut is None</span>
    <span class="k">if</span> <span class="n">learning_curves</span> <span class="ow">and</span> <span class="n">learning_curves_cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="n">FloatRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">learning_curves</span> <span class="ow">and</span> <span class="n">learning_curves_cut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">learning_curves_cut</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">CrossValidation</span><span class="p">(</span><span class="n">inner_cv</span><span class="o">=</span><span class="n">inner_cv</span><span class="p">,</span>
                                                      <span class="n">outer_cv</span><span class="o">=</span><span class="n">outer_cv</span><span class="p">,</span>
                                                      <span class="n">use_test_set</span><span class="o">=</span><span class="n">use_test_set</span><span class="p">,</span>
                                                      <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span>
                                                      <span class="n">calculate_metrics_per_fold</span><span class="o">=</span><span class="n">calculate_metrics_per_fold</span><span class="p">,</span>
                                                      <span class="n">calculate_metrics_across_folds</span><span class="o">=</span><span class="n">calculate_metrics_across_folds</span><span class="p">,</span>
                                                      <span class="n">learning_curves</span><span class="o">=</span><span class="n">learning_curves</span><span class="p">,</span>
                                                      <span class="n">learning_curves_cut</span><span class="o">=</span><span class="n">learning_curves_cut</span><span class="p">)</span>

    <span class="c1"># ====================== Data ===========================</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">allow_multidim_targets</span><span class="o">=</span><span class="n">allow_multidim_targets</span><span class="p">)</span>

    <span class="c1"># ====================== Output Folder and Log File Management ===========================</span>
    <span class="k">if</span> <span class="n">output_settings</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span> <span class="o">=</span> <span class="n">output_settings</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">project_folder</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span> <span class="o">=</span> <span class="n">project_folder</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">set_project_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span><span class="p">)</span>

    <span class="c1"># update output options to add pipe name and timestamp to results folder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">set_log_file</span><span class="p">()</span>

    <span class="c1"># ====================== Result Logging ===========================</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ====================== Pipeline ===========================</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ====================== Performance Optimization ===========================</span>
    <span class="k">if</span> <span class="n">optimizer_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">optimizer_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span> <span class="o">=</span> <span class="n">Optimization</span><span class="p">(</span><span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
                                     <span class="n">best_config_metric</span><span class="o">=</span><span class="n">best_config_metric</span><span class="p">,</span>
                                     <span class="n">optimizer_input</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                     <span class="n">optimizer_params</span><span class="o">=</span><span class="n">optimizer_params</span><span class="p">,</span>
                                     <span class="n">performance_constraints</span><span class="o">=</span><span class="n">performance_constraints</span><span class="p">)</span>

    <span class="c1"># self.optimization.sanity_check_metrics()</span>

    <span class="c1"># ====================== Caching and Parallelization ===========================</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">=</span> <span class="n">nr_of_processes</span>
    <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cache_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># ====================== Internals ===========================</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">permutation_id</span> <span class="o">=</span> <span class="n">permutation_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">allow_multidim_targets</span> <span class="o">=</span> <span class="n">allow_multidim_targets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ====================== Random Seed ===========================</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_seed</span>
    <span class="k">if</span> <span class="n">random_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">random</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.add">
<code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Add an element to the machine learning pipeline.
Returns self.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pipe_element</code></td>
        <td><code>PipelineElement</code></td>
        <td><p>The object to add to the machine learning pipeline,
being either a transformer or an estimator.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipe_element</span><span class="p">:</span> <span class="n">PipelineElement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add an element to the machine learning pipeline.</span>
<span class="sd">    Returns self.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pipe_element:</span>
<span class="sd">            The object to add to the machine learning pipeline,</span>
<span class="sd">            being either a transformer or an estimator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="n">pipe_element</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.copy_me">
<code class="highlight language-python"><span class="n">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Helper function to copy an entire Hyperpipe</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Hyperpipe</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">copy_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to copy an entire Hyperpipe</span>

<span class="sd">    Returns:</span>
<span class="sd">        Hyperpipe</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">OutputSettings</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">OutputSettings</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">initialize_log_file</span><span class="p">()</span>

    <span class="c1"># create new Hyperpipe instance</span>
    <span class="n">pipe_copy</span> <span class="o">=</span> <span class="n">Hyperpipe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                          <span class="n">inner_cv</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">inner_cv</span><span class="p">),</span>
                          <span class="n">outer_cv</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">),</span>
                          <span class="n">best_config_metric</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">best_config_metric</span><span class="p">,</span>
                          <span class="n">metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                          <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_input_str</span><span class="p">,</span>
                          <span class="n">optimizer_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">optimizer_params</span><span class="p">,</span>
                          <span class="n">project_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_folder</span><span class="p">,</span>
                          <span class="n">output_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">attr</span> <span class="o">!=</span> <span class="s1">&#39;output_settings&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">pipe_copy</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">:</span>
        <span class="n">preprocessing</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">preprocessing</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
        <span class="n">pipe_copy</span> <span class="o">+=</span> <span class="n">preprocessing</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">pipe_copy</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pipe_copy</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.fit">
<code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Starts the hyperparameter search and/or fits the pipeline to the data and targets.</p>
<p>Manages the nested cross validated hyperparameter search:</p>
<ol>
<li>Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</li>
<li>requests new configurations from the hyperparameter search strategy, the optimizer,</li>
<li>initializes the testing of a specific configuration,</li>
<li>communicates the result to the optimizer,</li>
<li>repeats 2-4 until optimizer delivers no more configurations to test</li>
<li>finally searches for the best config in all tested configs,</li>
<li>trains the pipeline with the best config and evaluates the performance on the test set</li>
</ol>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>ndarray</code></td>
        <td><p>The array-like training and test data with shape=[N, D],
where N is the number of samples and D is the number of features.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>targets</code></td>
        <td><code>ndarray</code></td>
        <td><p>The truth array-like values with shape=[N],
where N is the number of samples.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Keyword arguments, passed to Outer_Fold_Manager.fit.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Fitted Hyperpipe.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts the hyperparameter search and/or fits the pipeline to the data and targets.</span>

<span class="sd">    Manages the nested cross validated hyperparameter search:</span>

<span class="sd">    1. Filters the data according to filter strategy (1) and according to the imbalanced_data_strategy (2)</span>
<span class="sd">    2. requests new configurations from the hyperparameter search strategy, the optimizer,</span>
<span class="sd">    3. initializes the testing of a specific configuration,</span>
<span class="sd">    4. communicates the result to the optimizer,</span>
<span class="sd">    5. repeats 2-4 until optimizer delivers no more configurations to test</span>
<span class="sd">    6. finally searches for the best config in all tested configs,</span>
<span class="sd">    7. trains the pipeline with the best config and evaluates the performance on the test set</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data:</span>
<span class="sd">            The array-like training and test data with shape=[N, D],</span>
<span class="sd">            where N is the number of samples and D is the number of features.</span>

<span class="sd">        targets:</span>
<span class="sd">            The truth array-like values with shape=[N],</span>
<span class="sd">            where N is the number of samples.</span>

<span class="sd">        **kwargs:</span>
<span class="sd">            Keyword arguments, passed to Outer_Fold_Manager.fit.</span>


<span class="sd">    Returns:</span>
<span class="sd">        Fitted Hyperpipe.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># switch to result output folder</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_settings</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H-%M-%S&quot;</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;PHOTONAI ANALYSIS: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preparing data and PHOTONAI objects for analysis...&quot;</span><span class="p">)</span>

    <span class="c1"># loop over outer cross validation</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">hyperpipe_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># check data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">input_data_sanity_checks</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># create photon pipeline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_pipeline</span><span class="p">()</span>
        <span class="c1"># initialize the progress monitors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_result_logging</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="c1"># apply preprocessing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final_fit</span><span class="p">:</span>

            <span class="c1"># Outer Folds</span>
            <span class="n">outer_folds</span> <span class="o">=</span> <span class="n">FoldInfo</span><span class="o">.</span><span class="n">generate_folds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_cv</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">use_test_set</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">test_size</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">outer_folds</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">fold_id</span><span class="p">:</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">outer_folds</span><span class="p">}</span>
            <span class="n">delayed_jobs</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Run Dummy Estimator</span>
            <span class="n">dummy_estimator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_dummy_estimator</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing cache files...&quot;</span><span class="p">)</span>
                <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span> <span class="n">force_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># loop over outer cross validation</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">outer_f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outer_folds</span><span class="p">):</span>

                <span class="c1"># 1. generate OuterFolds Object</span>
                <span class="n">outer_fold</span> <span class="o">=</span> <span class="n">MDBOuterFold</span><span class="p">(</span><span class="n">fold_nr</span><span class="o">=</span><span class="n">outer_f</span><span class="o">.</span><span class="n">fold_nr</span><span class="p">)</span>
                <span class="n">outer_fold_computer</span> <span class="o">=</span> <span class="n">OuterFoldManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span><span class="p">,</span>
                                                       <span class="n">outer_f</span><span class="o">.</span><span class="n">fold_id</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation</span><span class="p">,</span>
                                                       <span class="n">cache_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span>
                                                       <span class="n">cache_updater</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_cache_folder_propagation</span><span class="p">,</span>
                                                       <span class="n">dummy_estimator</span><span class="o">=</span><span class="n">dummy_estimator</span><span class="p">,</span>
                                                       <span class="n">result_obj</span><span class="o">=</span><span class="n">outer_fold</span><span class="p">)</span>
                <span class="c1"># 2. monitor outputs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">outer_folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_fold</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">Hyperpipe</span><span class="o">.</span><span class="n">fit_outer_folds</span><span class="p">)(</span><span class="n">outer_fold_computer</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">delayed_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># 3. fit</span>
                        <span class="n">outer_fold_computer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="c1"># 4. save outer fold results</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="c1"># 5. clear cache</span>
                        <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="o">*</span><span class="n">delayed_jobs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_handler</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># evaluate hyperparameter optimization results for best config</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_optimization</span><span class="p">()</span>

            <span class="c1"># clear complete cache ? use self.cache_folder to delete all subfolders within the parent cache folder</span>
            <span class="c1"># directory</span>
            <span class="n">CacheManager</span><span class="o">.</span><span class="n">clear_cache_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_folder</span><span class="p">,</span> <span class="n">force_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">###############################################################################################</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_of_processes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hyperpipe_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.get_permutation_feature_importances">
<code class="highlight language-python"><span class="n">get_permutation_feature_importances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Fits a model for the best config of each outer fold (using the training data of that fold).
Then calls sklearn.inspection.permutation_importance with the test data and the given kwargs (e.g. n_repeats).
Returns mean of "importances_mean" and of "importances_std" of all outer folds.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Keyword arguments, passed to sklearn.permutation_importance.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Dictionary with average of "mean" and "std" for all outer folds, respectively.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_permutation_feature_importances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits a model for the best config of each outer fold (using the training data of that fold).</span>
<span class="sd">    Then calls sklearn.inspection.permutation_importance with the test data and the given kwargs (e.g. n_repeats).</span>
<span class="sd">    Returns mean of &quot;importances_mean&quot; and of &quot;importances_std&quot; of all outer folds.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Keyword arguments, passed to sklearn.permutation_importance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with average of &quot;mean&quot; and &quot;std&quot; for all outer folds, respectively.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">photon_system_log</span><span class="p">(</span><span class="s2">&quot;Computing permutation importances. This may take a while.&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot calculate permutation importances when optimum_pipe is None (probably the &quot;</span>
                         <span class="s2">&quot;training and optimization procedure failed)&quot;</span><span class="p">)</span>
    <span class="n">importance_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_permutation_importances</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mean_importances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">importance_list</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std_importances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">importance_list</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">stars</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean_importances</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_importances</span><span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.inverse_transform_pipeline">
<code class="highlight language-python"><span class="n">inverse_transform_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_to_inverse</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Inverse transform data for a pipeline with specific hyperparameter configuration.</p>
<ol>
<li>Copy Sklearn Pipeline,</li>
<li>Set Parameters</li>
<li>Fit Pipeline to data and targets</li>
<li>Inverse transform data with that pipeline</li>
</ol>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>hyperparameters</code></td>
        <td><code>dict</code></td>
        <td><p>The concrete configuration settings for the pipeline elements.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>ndarray</code></td>
        <td><p>The training data to which the pipeline is fitted.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>targets</code></td>
        <td><code>ndarray</code></td>
        <td><p>The truth values for training.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data_to_inverse</code></td>
        <td><code>ndarray</code></td>
        <td><p>The data that should be inversed after training.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ndarray</code></td>
      <td><p>Inverse data as array.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">inverse_transform_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                               <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                               <span class="n">targets</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                               <span class="n">data_to_inverse</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverse transform data for a pipeline with specific hyperparameter configuration.</span>

<span class="sd">    1. Copy Sklearn Pipeline,</span>
<span class="sd">    2. Set Parameters</span>
<span class="sd">    3. Fit Pipeline to data and targets</span>
<span class="sd">    4. Inverse transform data with that pipeline</span>

<span class="sd">    Parameters:</span>
<span class="sd">        hyperparameters:</span>
<span class="sd">            The concrete configuration settings for the pipeline elements.</span>

<span class="sd">        data:</span>
<span class="sd">            The training data to which the pipeline is fitted.</span>

<span class="sd">        targets:</span>
<span class="sd">            The truth values for training.</span>

<span class="sd">        data_to_inverse:</span>
<span class="sd">            The data that should be inversed after training.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Inverse data as array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">copied_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">copy_me</span><span class="p">()</span>
    <span class="n">copied_pipe</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">hyperparameters</span><span class="p">)</span>
    <span class="n">copied_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">copied_pipe</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">data_to_inverse</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.load_optimum_pipe">
<code class="highlight language-python"><span class="n">load_optimum_pipe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Load optimum pipe from file.
As staticmethod, instantiation is thus not required.
Called backend: PhotonModelPersistor.load_optimum_pipe.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file</code></td>
        <td><code>str</code></td>
        <td><p>File path specifying .photon file to load
trained pipeline from zipped file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>password</code></td>
        <td><code>str</code></td>
        <td><p>Passcode for read file.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>PhotonPipeline</code></td>
      <td><p>Returns pipeline with all trained PipelineElements.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">load_optimum_pipe</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhotonPipeline</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load optimum pipe from file.</span>
<span class="sd">    As staticmethod, instantiation is thus not required.</span>
<span class="sd">    Called backend: PhotonModelPersistor.load_optimum_pipe.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        file:</span>
<span class="sd">            File path specifying .photon file to load</span>
<span class="sd">            trained pipeline from zipped file.</span>

<span class="sd">        password:</span>
<span class="sd">            Passcode for read file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Returns pipeline with all trained PipelineElements.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PhotonModelPersistor</span><span class="o">.</span><span class="n">load_optimum_pipe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.predict">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Use the optimum pipe to predict the input data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>ndarray</code></td>
        <td><p>The array-like prediction data with shape=[M, D],
where M is the number of samples and D is the number
of features. D must correspond to the number
of trained dimensions of the fit method.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Keyword arguments, passed to optimum_pipe.predict.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ndarray</code></td>
      <td><p>Predicted targets calculated on input data with trained model.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the optimum pipe to predict the input data.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data:</span>
<span class="sd">            The array-like prediction data with shape=[M, D],</span>
<span class="sd">            where M is the number of samples and D is the number</span>
<span class="sd">            of features. D must correspond to the number</span>
<span class="sd">            of trained dimensions of the fit method.</span>

<span class="sd">        **kwargs:</span>
<span class="sd">            Keyword arguments, passed to optimum_pipe.predict.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Predicted targets calculated on input data with trained model.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Todo: if local_search = true then use optimized pipe here?</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 class="doc doc-heading" id="photonai.base.hyperpipe.Hyperpipe.predict_proba">
<code class="highlight language-python"><span class="n">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Use the optimum pipe to predict the probabilities from the input data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>ndarray</code></td>
        <td><p>The array-like prediction data with shape=[M, D],
where M is the number of samples and D is the number
of features. D must correspond to the number
of trained dimensions of the fit method.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Keyword arguments, passed to optimum_pipe.predict_proba.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ndarray</code></td>
      <td><p>Probabilities calculated from input data on fitted model.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>photonai/base/hyperpipe.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the optimum pipe to predict the probabilities from the input data.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data:</span>
<span class="sd">            The array-like prediction data with shape=[M, D],</span>
<span class="sd">            where M is the number of samples and D is the number</span>
<span class="sd">            of features. D must correspond to the number</span>
<span class="sd">            of trained dimensions of the fit method.</span>

<span class="sd">        **kwargs:</span>
<span class="sd">            Keyword arguments, passed to optimum_pipe.predict_proba.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Probabilities calculated from input data on fitted model.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../branch/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Branch" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Branch
            </div>
          </div>
        </a>
      
      
        
        <a href="../output_settings/" class="md-footer__link md-footer__link--next" aria-label="Next: OutputSettings" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              OutputSettings
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>